---
id: std-20260124-140100-lb42
depthUsed: standard
timestamp: 2026-01-24T14:01:00Z
executed: true
originalPrompt: "We need to review the https://kroam.xyz/leaderboard logic since the calculations here seem to be wrong, and the points seem to not be properly assigned to the models"
---

# Improved Prompt

## Objective
Investigate and fix the leaderboard calculation logic at https://kroam.xyz/leaderboard where model rankings and point totals appear incorrect.

## Context
- Framework: Next.js with TypeScript
- Database: PostgreSQL with Drizzle ORM
- Key files: 
  - `/src/app/leaderboard/page.tsx` (UI)
  - `/src/lib/db/queries.ts` (database queries)
  - `/src/lib/db/schema.ts` (data model)

## Investigation Required

### 1. Verify Point Assignment Logic
- Check how `predictions.totalPoints` is calculated when matches are scored
- Verify points are being saved to database correctly
- Compare expected vs actual point values for specific predictions

### 2. Review Leaderboard Query
- Check `getLeaderboardData()` or equivalent query
- Verify aggregation logic (SUM, AVG, COUNT)
- Ensure only 'scored' predictions are counted
- Check for duplicate counting or missing records

### 3. Data Integrity Checks
- Query a specific model's predictions and manually calculate expected total
- Compare with displayed leaderboard value
- Identify discrepancy pattern (always low? sometimes wrong? specific models?)

## Expected Output
1. Root cause identification with specific code locations
2. Fix implementation for incorrect calculations
3. Verification that leaderboard now displays correct values

## Success Criteria
- Model rankings reflect actual average points per prediction
- Total points match sum of individual prediction points
- No discrepancy between prediction-level and leaderboard-level calculations

## Quality Scores
- **Clarity**: 55% → 85%
- **Efficiency**: 80%
- **Structure**: 60% → 85%
- **Completeness**: 35% → 80%
- **Actionability**: 40% → 85%
- **Specificity**: 30% → 75%
- **Overall**: 50% → 82% (good)

## Original Prompt
```
We need to review the https://kroam.xyz/leaderboard logic since the calculations here seem to be wrong, and the points seem to not be properly assigned to the models
```
