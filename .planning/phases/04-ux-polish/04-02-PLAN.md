---
phase: 04-ux-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/leaderboard/page.tsx
autonomous: true

must_haves:
  truths:
    - "Leaderboard updates visible within 30 seconds of settlement"
    - "Polling only occurs when browser tab is visible"
    - "Last update timestamp displays below leaderboard"
  artifacts:
    - path: "src/app/leaderboard/page.tsx"
      provides: "Auto-refreshing leaderboard page"
      contains: "LiveTabRefresher"
  key_links:
    - from: "src/app/leaderboard/page.tsx"
      to: "src/app/matches/live-refresher.tsx"
      via: "LiveTabRefresher import"
      pattern: "import.*LiveTabRefresher"
---

<objective>
Add LiveTabRefresher to leaderboard page for 30-second auto-refresh, matching the existing pattern used on the matches list page.

Purpose: Satisfy UIUX-02 - leaderboard updates visible within 30 seconds of settlement
Output: Leaderboard page with automatic polling every 30 seconds (when tab is visible)
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-ux-polish/04-RESEARCH.md

# Reference implementation
@src/app/matches/live-refresher.tsx
@src/app/leaderboard/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wrap leaderboard content with LiveTabRefresher</name>
  <files>src/app/leaderboard/page.tsx</files>
  <action>
Modify the LeaderboardPage component to use LiveTabRefresher for auto-refresh:

1. Add import at top of file:
   ```tsx
   import { LiveTabRefresher } from '@/app/matches/live-refresher';
   ```

2. Wrap the main content div with LiveTabRefresher:
   ```tsx
   export default async function LeaderboardPage({ searchParams }: PageProps) {
     const resolvedParams = await searchParams;

     return (
       <LiveTabRefresher refreshInterval={30000}>
         <div className="space-y-8">
           {/* Header */}
           {/* ... existing content ... */}

           {/* FAQ Section */}
           {/* ... */}

           {/* FAQ Schema */}
           {/* ... */}
         </div>
       </LiveTabRefresher>
     );
   }
   ```

3. The LiveTabRefresher component already:
   - Uses router.refresh() for RSC-compatible refresh
   - Checks document.visibilityState before refreshing
   - Shows "Last updated: Xs ago" text below content
   - Refreshes immediately if tab was hidden for >60s

No other changes needed - LiveTabRefresher handles all the logic.
  </action>
  <verify>
    1. `npm run build` completes without TypeScript errors
    2. Run dev server, open `/leaderboard` in browser
    3. Wait 30 seconds - page should refresh (network tab shows new requests)
    4. Check console for no errors
    5. Bottom of page should show "Last updated: Xs ago"
  </verify>
  <done>
    - LiveTabRefresher wraps leaderboard page content
    - Page auto-refreshes every 30 seconds when tab is visible
    - "Last updated" timestamp displays below leaderboard
  </done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build` exits 0
2. Auto-refresh works: Open /leaderboard, wait 30s, observe network request
3. Visibility check: Switch to another tab, wait 30s, switch back - should refresh immediately if >60s elapsed
4. UI indicator: "Last updated: Xs ago" text visible below leaderboard
</verification>

<success_criteria>
- [ ] LiveTabRefresher imported from existing component
- [ ] Leaderboard page wrapped with LiveTabRefresher
- [ ] Refresh interval set to 30000ms (30 seconds)
- [ ] Last updated indicator visible at bottom
- [ ] Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-ux-polish/04-02-SUMMARY.md`
</output>
