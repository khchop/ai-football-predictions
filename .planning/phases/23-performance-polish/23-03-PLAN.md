---
phase: 23-performance-polish
plan: 03
type: execute
wave: 2
depends_on: ["23-01"]
files_modified:
  - next.config.ts
autonomous: false

must_haves:
  truths:
    - "Static page shells render instantly on first load"
    - "Dynamic content streams in via Suspense boundaries"
    - "View Transitions provide smooth page navigation"
    - "No build errors or warnings about uncached data"
  artifacts:
    - path: "next.config.ts"
      provides: "PPR-enabled configuration"
      contains: "cacheComponents: true"
  key_links:
    - from: "next.config.ts"
      to: "all page components"
      via: "cacheComponents flag"
      pattern: "cacheComponents.*true"
---

<objective>
Enable cacheComponents in Next.js config and verify PPR works correctly across the application.

Purpose: With blog page refactored (Plan 01) and route segment configs already removed, the codebase is ready for PPR activation. This enables static shell prerendering for all pages while dynamic content streams in.

Output: Production-ready PPR configuration with verified behavior.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-performance-polish/23-RESEARCH.md

@next.config.ts
@src/app/blog/page.tsx (refactored in Plan 01)
@src/app/leaderboard/page.tsx (already has Suspense)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enable cacheComponents in Next.js config</name>
  <files>next.config.ts</files>
  <action>
Update next.config.ts to enable PPR via cacheComponents:

1. Add `cacheComponents: true` at the top level of nextConfig (NOT inside experimental)

2. Remove or update the TODO comment since we're now enabling it

3. Keep existing experimental.viewTransition: true

Final config should look like:
```typescript
const nextConfig: NextConfig = {
  cacheComponents: true,  // Enables PPR + Cache Components
  experimental: {
    viewTransition: true,
  },
  images: { ... },
  async redirects() { ... },
};
```

Note: cacheComponents is a top-level config in Next.js 16, NOT under experimental.
  </action>
  <verify>
Run `npm run build` and verify:
1. Build completes without errors
2. No warnings about "uncached data accessed outside Suspense"
3. Build output shows static/dynamic page breakdown
  </verify>
  <done>cacheComponents: true is set in next.config.ts</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>PPR (Partial Prerendering) enabled across the application</what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`

2. Test blog page PPR:
   - Open Network tab in browser DevTools
   - Navigate to /blog
   - Observe: Static header should appear instantly
   - Observe: Blog posts should stream in after brief skeleton

3. Test leaderboard page PPR:
   - Navigate to /leaderboard
   - Observe: Header and scoring system should appear instantly
   - Observe: Leaderboard table should stream in with skeleton

4. Test View Transitions:
   - Click between pages (e.g., /blog to /matches to /leaderboard)
   - Observe: Smooth crossfade transitions (150ms)
   - No jarring full-page reloads

5. Test reduced motion:
   - Enable "Reduce motion" in system preferences
   - Navigate between pages
   - Observe: No animations, instant transitions

6. Check for errors:
   - Open browser console
   - Navigate through several pages
   - Verify no React/Next.js errors

Expected behavior:
- Page shells render instantly (header, layout, static text)
- Dynamic sections show skeleton, then content streams in
- Navigation feels snappy with subtle fade transitions
- Console is clean of errors
  </how-to-verify>
  <resume-signal>Type "approved" if PPR and View Transitions work correctly, or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. Build succeeds: `npm run build`
2. No uncached data warnings
3. Static shells render before dynamic content
4. View Transitions work smoothly
5. Reduced motion preference respected
</verification>

<success_criteria>
1. next.config.ts contains `cacheComponents: true`
2. Build succeeds without PPR-related warnings
3. User confirms static shell + streaming behavior
4. User confirms View Transitions work
</success_criteria>

<output>
After completion, create `.planning/phases/23-performance-polish/23-03-SUMMARY.md`
</output>
