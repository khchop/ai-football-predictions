---
phase: 23-performance-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/blog/page.tsx
  - src/components/blog/blog-list-skeleton.tsx
autonomous: true

must_haves:
  truths:
    - "Blog page static header renders before dynamic content loads"
    - "Blog posts list streams in via Suspense boundary"
    - "Skeleton matches blog card grid layout during loading"
  artifacts:
    - path: "src/app/blog/page.tsx"
      provides: "PPR-compatible blog page"
      contains: "<Suspense"
    - path: "src/components/blog/blog-list-skeleton.tsx"
      provides: "Blog list loading skeleton"
      min_lines: 20
  key_links:
    - from: "src/app/blog/page.tsx"
      to: "BlogPostsList async component"
      via: "Suspense boundary"
      pattern: "Suspense.*BlogPostsList"
---

<objective>
Refactor blog page for PPR compatibility by moving searchParams-dependent content into Suspense boundary.

Purpose: With `cacheComponents: true`, awaiting searchParams at page level prevents static shell prerendering. Moving the await into a Suspense-wrapped child component enables the static header/filter pills to prerender while the posts list streams in dynamically.

Output: Blog page with static shell (header, filter pills) and dynamic content (posts list, pagination) wrapped in Suspense with shimmer skeleton.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-performance-polish/23-RESEARCH.md

@src/app/blog/page.tsx
@src/app/leaderboard/page.tsx (reference pattern - already has Suspense)
@src/app/globals.css (shimmer infrastructure lines 496-541)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BlogListSkeleton component</name>
  <files>src/components/blog/blog-list-skeleton.tsx</files>
  <action>
Create a skeleton component that matches the blog posts grid layout:
- 6 skeleton cards in a 3-column grid (matching POSTS_PER_PAGE display)
- Each card has: content type badge placeholder, title placeholder, excerpt placeholder (3 lines), date placeholder
- Use existing skeleton-wrapper and shimmer classes from globals.css
- Match exact padding, rounded corners, and border styling from actual blog cards
- NO 'use client' directive - this is pure render

Structure:
```
<div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
  {Array.from({ length: 6 }).map((_, i) => (
    <div key={i} className="skeleton-wrapper rounded-lg border p-6">
      {/* Badge placeholder */}
      <Skeleton className="h-5 w-24 mb-3" />
      {/* Title placeholder */}
      <Skeleton className="h-6 w-full mb-2" />
      <Skeleton className="h-6 w-3/4 mb-4" />
      {/* Excerpt placeholder - 3 lines */}
      <Skeleton className="h-4 w-full mb-1" />
      <Skeleton className="h-4 w-full mb-1" />
      <Skeleton className="h-4 w-2/3 mb-4" />
      {/* Date placeholder */}
      <Skeleton className="h-3 w-20" />
      <div className="shimmer" />
    </div>
  ))}
</div>
```
  </action>
  <verify>File exists and exports BlogListSkeleton component without 'use client' directive</verify>
  <done>BlogListSkeleton component renders 6-card skeleton grid with shimmer animation</done>
</task>

<task type="auto">
  <name>Task 2: Refactor blog page for PPR compatibility</name>
  <files>src/app/blog/page.tsx</files>
  <action>
Restructure blog page to separate static shell from dynamic content:

1. Create new async BlogPostsList component that:
   - Accepts `searchParams: Promise<{ page?: string; competition?: string }>` as prop
   - Awaits searchParams inside the component
   - Handles all data fetching (getPublishedBlogPosts)
   - Renders posts grid, empty state, and pagination
   - Export at module level (NOT inside BlogPage function)

2. Update BlogPage to:
   - NOT await searchParams at page level
   - Keep static content outside Suspense: header, "Back to matches" link, title, description
   - Move competition filter pills inside BlogPostsList (they depend on competition param)
   - Wrap BlogPostsList in Suspense with BlogListSkeleton fallback
   - Pass searchParams Promise directly to BlogPostsList

Pattern to follow (from research):
```typescript
export default function BlogPage({ searchParams }: PageProps) {
  // NO await here - static shell prerendered
  return (
    <div className="max-w-5xl mx-auto space-y-8">
      {/* Static: prerendered */}
      <div className="space-y-3">
        <Link href="/matches">...</Link>
        <h1>Football Insights</h1>
        <p>Weekly league roundups...</p>
      </div>

      {/* Dynamic: streams with searchParams */}
      <Suspense fallback={<BlogListSkeleton />}>
        <BlogPostsList searchParams={searchParams} />
      </Suspense>
    </div>
  );
}

async function BlogPostsList({
  searchParams
}: {
  searchParams: Promise<{ page?: string; competition?: string }>
}) {
  const { page: pageParam, competition } = await searchParams;
  // ... data fetching and rendering
}
```

Note: Competition filter display and pills should move into BlogPostsList since they depend on the competition param.
  </action>
  <verify>
Run `npm run build` and verify blog page builds without errors.
Navigate to /blog and verify static header appears before content loads.
  </verify>
  <done>Blog page has static header rendering instantly with posts list streaming via Suspense</done>
</task>

</tasks>

<verification>
1. Build succeeds: `npm run build`
2. Blog page renders static header immediately
3. Posts list streams in with skeleton during load
4. Pagination works correctly with Suspense
5. Competition filter still functions correctly
</verification>

<success_criteria>
1. src/app/blog/page.tsx contains Suspense boundary wrapping BlogPostsList
2. searchParams await happens inside BlogPostsList, not at page level
3. BlogListSkeleton shows shimmer animation during loading
4. No regression in blog functionality (pagination, filtering)
</success_criteria>

<output>
After completion, create `.planning/phases/23-performance-polish/23-01-SUMMARY.md`
</output>
