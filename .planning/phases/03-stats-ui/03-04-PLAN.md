---
phase: 03-stats-ui
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/leaderboard-filters.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User can select season from dropdown filter"
    - "User can select specific model from dropdown filter"
    - "Season and model filters sync to URL"
  artifacts:
    - path: "src/components/leaderboard-filters.tsx"
      provides: "Filters with season and model selectors"
      min_lines: 220
  key_links:
    - from: "src/components/leaderboard-filters.tsx"
      to: "leaderboard pages"
      via: "URL searchParams for season and model"
      pattern: "searchParams\\.get\\('(season|model)'\\)"
---

<objective>
Add missing Season and Model selectors to LeaderboardFilters to complete Phase 3 requirements.

Purpose: VERIFICATION.md identified two gaps: no season selector and no model selector. Both APIs accept these params but users can't select them in the UI.

Output: Updated LeaderboardFilters with season dropdown, model dropdown, and URL state sync.
</objective>

<execution_context>
@/Users/pieterbos/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-stats-ui/03-VERIFICATION.md

# Existing filters to reference
@src/components/leaderboard-filters.tsx
</context>

<tasks>

<task type="auto">
  <name>Add season selector dropdown</name>
  <files>src/components/leaderboard-filters.tsx</files>
  <action>
    Add season selector to src/components/leaderboard-filters.tsx:

    1. Add SEASON_OPTIONS constant before component:
    ```typescript
    const SEASON_OPTIONS = [
      { value: 'all', label: 'All Seasons' },
      { value: '2024-2025', label: '2024/25' },
      { value: '2023-2024', label: '2023/24' },
      { value: '2022-2023', label: '2022/23' },
      { value: '2021-2022', label: '2021/22' },
    ];
    ```

    2. Add season state and selector in FiltersInner component:
    - Read currentSeason from searchParams.get('season') || 'all'
    - Add Select component for season (icon: Calendar from lucide-react)
    - Label: "Season"
    - OnChange: updateParams('season', value)
    - Show active filter chip when season !== 'all'

    3. Position: Add between Club selector and Time Range selector (after club, before timeRange)

    4. Handle disabledFilters: If 'season' in disabledFilters, disable the select and don't show active chip
  </action>
  <verify>
    ```bash
    grep -E "(SEASON_OPTIONS|season.*Select)" src/components/leaderboard-filters.tsx
    npm run build 2>&1 | grep -E "(error|Error)" | head -5
    ```
    First command shows season selector code exists.
    Second command shows no build errors.
  </verify>
  <done>LeaderboardFilters includes season selector with dropdown, URL sync, and disabledFilters support.</done>
</task>

<task type="auto">
  <name>Add model selector dropdown</name>
  <files>src/components/leaderboard-filters.tsx</files>
  <action>
    Add model selector to src/components/leaderboard-filters.tsx:

    1. Add MODEL_OPTIONS constant with available LLM models:
    ```typescript
    const MODEL_OPTIONS = [
      { value: 'all', label: 'All Models' },
      { value: 'meta-llama/Meta-Llama-3.1-70B-Instruct-Turbo', label: 'Llama 3.1 70B' },
      { value: 'meta-llama/Meta-Llama-3.1-8B-Instruct-Turbo', label: 'Llama 3.1 8B' },
      { value: 'anthropic/claude-3-5-sonnet-20241022', label: 'Claude 3.5 Sonnet' },
      { value: 'anthropic/claude-3-haiku-20240307', label: 'Claude 3 Haiku' },
      { value: 'openai/gpt-4o-2024-08-06', label: 'GPT-4o' },
      { value: 'openai/gpt-4o-mini-2024-07-18', label: 'GPT-4o Mini' },
      { value: 'google/gemini-1.5-flash-002', label: 'Gemini 1.5 Flash' },
      { value: 'deepseek/deepseek-chat', label: 'DeepSeek Chat' },
    ];
    ```

    2. Add model state and selector in FiltersInner component:
    - Read currentModel from searchParams.get('model') || 'all'
    - Add Select component for model (icon: Cpu or Bot from lucide-react)
    - Label: "Model"
    - OnChange: updateParams('model', value)
    - Show active filter chip when model !== 'all'

    3. Position: Add at the end, after Time Range selector

    4. Handle disabledFilters: If 'model' in disabledFilters, disable the select and don't show active chip
  </action>
  <verify>
    ```bash
    grep -E "(MODEL_OPTIONS|model.*Select)" src/components/leaderboard-filters.tsx
    npm run build 2>&1 | grep -E "(error|Error)" | head -5
    ```
    First command shows model selector code exists.
    Second command shows no build errors.
  </verify>
  <done>LeaderboardFilters includes model selector with dropdown, URL sync, and disabledFilters support.</done>
</task>

<task type="auto">
  <name>Verify URL state sync for new filters</name>
  <files>src/components/leaderboard-filters.tsx</files>
  <action>
    Ensure updateParams function handles new filter params:

    1. Verify updateParams callback includes 'season' and 'model' in switch statement
    2. Ensure when user selects season/model, URL updates with ?season=2024-2025 or ?model=meta-llama/...
    3. Test that selecting "All Seasons" or "All Models" removes param from URL (doesn't show ?season=all)

    Reference existing updateParams structure for competition, club, timeRange patterns.
  </action>
  <verify>
    ```bash
    grep -E "case '(season|model)':" src/components/leaderboard-filters.tsx
    ```
    Shows updateParams handles both new filter params.
  </verify>
  <done>updateParams callback correctly handles season and model filter updates.</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Season selector:**
   ```bash
   grep "SEASON_OPTIONS" src/components/leaderboard-filters.tsx
   grep "Calendar" src/components/leaderboard-filters.tsx
   ```
   Shows season options constant and Calendar icon import.

2. **Model selector:**
   ```bash
   grep "MODEL_OPTIONS" src/components/leaderboard-filters.tsx
   grep -E "(Cpu|Bot)" src/components/leaderboard-filters.tsx
   ```
   Shows model options constant and icon import.

3. **Update params:**
   ```bash
   grep "case 'season':" src/components/leaderboard-filters.tsx
   grep "case 'model':" src/components/leaderboard-filters.tsx
   ```
   Both show updateParams handles the params.

4. **Build check:**
   ```bash
   npm run build 2>&1 | grep -E "(error|Error)" | head -5
   ```
   No TypeScript errors.

5. **File size check:**
   ```bash
   wc -l src/components/leaderboard-filters.tsx
   ```
   Should be 220+ lines (was ~180 before adding 2 selectors).

Manual testing (user can verify in browser):
- Visit /leaderboard
- See "Season" dropdown with 2024/25, 2023/24, etc.
- Select a season - URL updates with ?season=2024-2025
- Table updates to show only that season's data
- See "Model" dropdown with available LLM models
- Select a model - URL updates with ?model=anthropic/...
- Table updates to show only that model's predictions
- Visit /leaderboard/competition/39 - both selectors work
- Visit /leaderboard/club/33 - both selectors work
</verification>

<success_criteria>
- [ ] SEASON_OPTIONS constant with all seasons option
- [ ] Season Select component with Calendar icon
- [ ] MODEL_OPTIONS constant with all models option
- [ ] Model Select component with icon (Cpu or Bot)
- [ ] Both selectors read from searchParams on mount
- [ ] Both selectors update URL via updateParams
- [ ] Both selectors show active filter chips when selected
- [ ] Both selectors respect disabledFilters prop
- [ ] npm run build completes without errors
- [ ] File grows to 220+ lines
</success_criteria>

<output>
After completion, create `.planning/phases/03-stats-ui/03-04-SUMMARY.md` with:
- Files modified
- Season selector structure
- Model selector structure
- URL state sync pattern
- Any edge cases handled
</output>
