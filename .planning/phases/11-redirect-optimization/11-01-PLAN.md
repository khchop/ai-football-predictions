---
phase: 11-redirect-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/matches/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Legacy match URLs (/matches/{uuid}) redirect with 308 permanent status"
    - "Search engines receive permanent redirect signal for PageRank transfer"
    - "No 307 temporary redirects exist in the application"
  artifacts:
    - path: "src/app/matches/[id]/page.tsx"
      provides: "Permanent redirect for legacy match URLs"
      contains: "permanentRedirect"
  key_links:
    - from: "src/app/matches/[id]/page.tsx"
      to: "/leagues/{competition}/{match-slug}"
      via: "permanentRedirect() call"
      pattern: "permanentRedirect.*leagues"
---

<objective>
Fix legacy match page redirect from 307 temporary to 308 permanent status.

Purpose: Ensure search engines transfer PageRank properly when encountering legacy /matches/{uuid} URLs. The current implementation uses RedirectType.replace which returns a 307 temporary redirect, causing search engines to treat the redirect as non-permanent and potentially not consolidating link equity.

Output: Updated match page that uses permanentRedirect() for 308 status code.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-redirect-optimization/11-RESEARCH.md

Key context from research:
- Line 83 of src/app/matches/[id]/page.tsx uses `redirect()` with `RedirectType.replace`
- This returns 307 temporary redirect instead of 308 permanent
- Phase 9 used `permanentRedirect()` correctly in league pages and next.config.ts
- Fix is single line change: replace redirect call with permanentRedirect()
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace redirect with permanentRedirect in legacy match page</name>
  <files>src/app/matches/[id]/page.tsx</files>
  <action>
    1. Update the import statement on line 1:
       - Remove: `redirect, RedirectType` from imports
       - Add: `permanentRedirect` to imports
       Result: `import { notFound, permanentRedirect } from 'next/navigation';`

    2. Replace the redirect call on line 83:
       - Remove: `redirect(\`/leagues/${competition.id}/${match.slug}\`, RedirectType.replace);`
       - Replace with: `permanentRedirect(\`/leagues/${competition.id}/${match.slug}\`);`

    3. Verify no other usages of redirect or RedirectType remain in the file.

    The comment above the redirect (line 80) already says "permanent redirect for SEO" so the intent was correct, just the implementation was wrong.
  </action>
  <verify>
    - `grep "RedirectType" src/app/matches/[id]/page.tsx` returns no matches
    - `grep "permanentRedirect" src/app/matches/[id]/page.tsx` returns the redirect line
    - TypeScript compiles without errors: `npx tsc --noEmit src/app/matches/[id]/page.tsx`
  </verify>
  <done>
    Legacy match page uses permanentRedirect() which returns HTTP 308 status code, ensuring search engines treat the redirect as permanent for PageRank consolidation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify all redirects use permanent status</name>
  <files>No files modified - verification only</files>
  <action>
    1. Search for any remaining uses of `redirect` (not permanentRedirect) in app directory:
       `grep -r "from 'next/navigation'" --include="*.tsx" src/app/ | grep redirect`

    2. Search for any uses of RedirectType (which suggests non-permanent):
       `grep -r "RedirectType" --include="*.tsx" src/`

    3. Verify next.config.ts redirects use permanent: true:
       `grep -A1 "destination:" next.config.ts | grep permanent`

    4. Document findings - all redirects should be either:
       - permanentRedirect() for runtime redirects
       - permanent: true for config redirects
       - If any 307 redirects found, note them for follow-up
  </action>
  <verify>
    - No instances of RedirectType in the codebase
    - No uses of plain `redirect()` without RedirectType (which also defaults to 307)
    - All next.config.ts redirects have `permanent: true`
  </verify>
  <done>
    All application redirects verified to use permanent redirect methods (308 status or config permanent: true).
  </done>
</task>

</tasks>

<verification>
After completing both tasks:

1. **Code verification:**
   - `grep -r "RedirectType" src/` returns no results
   - `grep "permanentRedirect" src/app/matches/[id]/page.tsx` confirms usage

2. **Build verification:**
   - `npm run build` completes without errors

3. **Manual HTTP verification (optional, for production):**
   ```bash
   curl -I https://kroam.xyz/matches/{some-uuid-with-slug}
   # Expected: HTTP/2 308, Location: /leagues/{id}/{slug}
   ```
</verification>

<success_criteria>
- Legacy match page redirect changed from RedirectType.replace to permanentRedirect()
- No instances of RedirectType remain in codebase
- No instances of plain redirect() (307) remain for SEO-critical paths
- Build passes without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/11-redirect-optimization/11-01-SUMMARY.md`
</output>
