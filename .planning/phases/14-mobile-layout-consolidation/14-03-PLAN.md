---
phase: 14-mobile-layout-consolidation
plan: 03
type: execute
wave: 3
depends_on: ["14-01", "14-02"]
files_modified:
  - src/app/leagues/[slug]/[match]/page.tsx
  - src/components/match/roundup-viewer.tsx
autonomous: true

must_haves:
  truths:
    - "User sees match score exactly once in sticky header on mobile (MOBL-01)"
    - "User navigates between tabs without page reload (MOBL-04)"
    - "Mobile layout shows tabs, desktop shows stacked sections"
  artifacts:
    - path: "src/app/leagues/[slug]/[match]/page.tsx"
      provides: "Updated match page with tabbed mobile layout"
      contains: "MatchTabsMobile"
    - path: "src/components/match/roundup-viewer.tsx"
      provides: "Roundup viewer with hidden scoreboard on mobile"
      contains: "md:block"
  key_links:
    - from: "src/app/leagues/[slug]/[match]/page.tsx"
      to: "src/components/match/match-header-sticky.tsx"
      via: "sticky header import"
      pattern: "MatchHeaderSticky"
    - from: "src/app/leagues/[slug]/[match]/page.tsx"
      to: "src/components/match/match-tabs-mobile.tsx"
      via: "tabs component import"
      pattern: "MatchTabsMobile"
---

<objective>
Wire tabbed navigation and sticky header into the main match page, eliminating duplicate score displays.

Purpose: Transform the existing vertical scroll layout into a mobile-optimized tabbed interface while maintaining desktop experience. Score de-duplication removes cognitive overload.

Output: Match page renders differently on mobile (tabs) vs desktop (stacked sections), with score shown exactly once.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-mobile-layout-consolidation/14-RESEARCH.md
@.planning/phases/14-mobile-layout-consolidation/14-01-SUMMARY.md
@.planning/phases/14-mobile-layout-consolidation/14-02-SUMMARY.md

# Files being modified
@src/app/leagues/[slug]/[match]/page.tsx
@src/components/match/roundup-viewer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate tabbed layout into match page</name>
  <files>src/app/leagues/[slug]/[match]/page.tsx</files>
  <action>
Update the leagues match page to use the new mobile tabbed layout with sticky header.

Key changes:

1. **Add imports at top:**
```typescript
import { MatchHeaderSticky } from '@/components/match/match-header-sticky';
import { MatchTabsMobile } from '@/components/match/match-tabs-mobile';
import { SummaryTab } from '@/components/match/tab-content/summary-tab';
import { StatsTab } from '@/components/match/tab-content/stats-tab';
import { PredictionsTab } from '@/components/match/tab-content/predictions-tab';
import { AnalysisTab } from '@/components/match/tab-content/analysis-tab';
```

2. **Replace the existing Card header block (lines ~198-330)** with:
```tsx
{/* Sticky Header - Single source of truth for score (MOBL-01) */}
<MatchHeaderSticky
  match={matchData}
  competition={competition}
  isLive={isLive}
  isFinished={isFinished}
/>
```

3. **Create mobile tabbed layout (md:hidden):**
After the sticky header, add a mobile-only section:
```tsx
{/* Mobile: Tabbed Layout */}
<div className="md:hidden">
  <MatchTabsMobile>
    {{
      summary: (
        <SummaryTab
          match={matchData}
          competition={competition}
          isLive={isLive}
          isFinished={isFinished}
          matchEvents={matchEvents}
        />
      ),
      stats: (
        <StatsTab
          analysis={analysis || null}
          homeStanding={homeStanding}
          awayStanding={awayStanding}
          homeTeam={matchData.homeTeam}
          awayTeam={matchData.awayTeam}
        />
      ),
      predictions: (
        <PredictionsTab
          predictions={predictions}
          homeTeam={matchData.homeTeam}
          awayTeam={matchData.awayTeam}
          isFinished={isFinished}
        />
      ),
      analysis: (
        <AnalysisTab
          matchId={matchData.id}
          matchStatus={matchData.status}
          roundup={roundup}
        />
      ),
    }}
  </MatchTabsMobile>
</div>
```

4. **Keep existing desktop layout (hidden md:block):**
Wrap the existing stacked section layout in:
```tsx
{/* Desktop: Stacked Layout (existing) */}
<div className="hidden md:block space-y-8">
  {/* Keep all existing cards/sections as-is */}
</div>
```

5. **Remove duplicate elements from desktop layout:**
- Remove the large Card header with teams/score (now in MatchHeaderSticky)
- Keep: back link, match events, MatchStats, MatchContentSection, RoundupViewer, PredictionTable, AI Analysis, related matches widgets

6. **Keep schema components outside responsive wrappers:**
SportsEventSchema, WebPageSchema, MatchH1, and the back link should remain outside/above the responsive layouts.
  </action>
  <verify>
Run `npm run build` to verify page compiles.
Run `npm run dev` and visit a match page to verify:
- On mobile viewport: tabs visible, score in sticky header
- On desktop viewport: stacked sections visible
  </verify>
  <done>
Match page has:
- MatchHeaderSticky as single score display
- Mobile: MatchTabsMobile with 4 tabs
- Desktop: Existing stacked layout preserved
- No duplicate score card in mobile view
  </done>
</task>

<task type="auto">
  <name>Task 2: Hide duplicate scoreboard in RoundupViewer on mobile</name>
  <files>src/components/match/roundup-viewer.tsx</files>
  <action>
Update RoundupViewer to hide its scoreboard section on mobile since the sticky header already shows the score.

Key changes:

1. **Find the Scoreboard Header Card (lines ~94-182)** and wrap it with responsive visibility:
```tsx
{/* Scoreboard Header - Hidden on mobile (shown in sticky header) */}
<div className="hidden md:block">
  <Card className="bg-card/80 border-border/60">
    {/* ... existing scoreboard content ... */}
  </Card>
</div>
```

2. **The rest of RoundupViewer remains visible on all screen sizes:**
- Events Timeline (if events exist)
- Stats Grid (this is roundup-specific stats, not MatchStats)
- Model Predictions table
- Top Performers
- Narrative Content

This ensures MOBL-01 (score displays exactly once) while preserving the full roundup content on desktop.

Note: The scoreboard in RoundupViewer is different from MatchStats - it's part of the AI-generated roundup JSON, so hiding it on mobile is appropriate since sticky header shows the real score.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compilation.
Search for "hidden md:block" in roundup-viewer.tsx to confirm scoreboard is wrapped.
  </verify>
  <done>
RoundupViewer scoreboard section:
- Hidden on mobile (md:hidden class on wrapper)
- Visible on desktop (md:block)
- Other sections (events, stats, narrative) visible on all sizes
  </done>
</task>

</tasks>

<verification>
Integration complete:
1. Match page uses MatchHeaderSticky for score display
2. Mobile view shows tabbed navigation
3. Desktop view shows existing stacked layout
4. RoundupViewer scoreboard hidden on mobile
5. `npm run build` succeeds
</verification>

<success_criteria>
- Score displays exactly once on mobile (in sticky header only)
- Tabs work for navigation on mobile (tap to switch)
- Desktop layout unchanged (stacked sections)
- RoundupViewer scoreboard hidden on mobile
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/14-mobile-layout-consolidation/14-03-SUMMARY.md`
</output>
