---
phase: 13-content-pipeline-fixes
plan: 03
type: execute
wave: 2
depends_on: ["13-01", "13-02"]
files_modified:
  - src/components/match/MatchContent.tsx
  - src/app/leagues/[slug]/[match]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Pre-match content displays on scheduled match pages"
    - "Betting (prediction) content displays on live and finished match pages"
    - "Post-match content displays on finished match pages"
    - "Long post-match content shows 'Read More' truncation"
    - "Content section hides when no applicable content exists"
  artifacts:
    - path: "src/components/match/MatchContent.tsx"
      provides: "Updated MatchContentSection with state logic and ReadMoreText"
      min_lines: 60
  key_links:
    - from: "src/components/match/MatchContent.tsx"
      to: "src/lib/content/queries.ts"
      via: "getMatchContent import"
      pattern: "getMatchContent"
    - from: "src/components/match/MatchContent.tsx"
      to: "src/components/match/ReadMoreText.tsx"
      via: "ReadMoreText import for post-match"
      pattern: "ReadMoreText"
---

<objective>
Update MatchContentSection component to use unified content query, add match state logic (show different content based on scheduled/live/finished), and integrate ReadMoreText for long post-match narratives.

Purpose: Fix CONT-01, CONT-02, CONT-03 requirements - content renders correctly based on match state.
Output: Updated MatchContent.tsx with state-aware rendering and ReadMoreText integration.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-content-pipeline-fixes/13-RESEARCH.md

# Key files to modify
@src/components/match/MatchContent.tsx
@src/app/leagues/[slug]/[match]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update MatchContentSection with state logic and ReadMoreText</name>
  <files>src/components/match/MatchContent.tsx</files>
  <action>
Update the existing MatchContentSection component:

1. Add matchStatus prop to control which sections display:
```typescript
interface MatchContentSectionProps {
  matchId: string;
  matchStatus: 'scheduled' | 'live' | 'finished' | string; // Match.status type
}
```

2. Import ReadMoreText component:
```typescript
import { ReadMoreText } from '@/components/match/ReadMoreText';
```

3. Add state-based visibility logic:
- Pre-match section: Show only when `matchStatus === 'scheduled'` AND `content.preMatchContent` exists
- Betting section: Show when `matchStatus === 'live'` OR `matchStatus === 'finished'` AND `content.bettingContent` exists
- Post-match section: Show only when `matchStatus === 'finished'` AND `content.postMatchContent` exists

4. Replace plain paragraph with ReadMoreText for post-match:
```typescript
{showPostMatch && (
  <div>
    <h3 className="text-sm font-semibold text-muted-foreground mb-3 uppercase tracking-wide">
      Match Report
    </h3>
    <ReadMoreText
      text={content.postMatchContent}
      previewLines={6}
      className="text-sm md:text-base"
    />
    {content.postMatchGeneratedAt && (
      <p className="text-xs text-muted-foreground/60 mt-2">
        Generated {new Date(content.postMatchGeneratedAt).toLocaleString()}
      </p>
    )}
  </div>
)}
```

5. Update dividers to only show between visible sections:
```typescript
{showPreMatch && (showBetting || showPostMatch) && (
  <div className="border-t border-border/30" />
)}
{showBetting && showPostMatch && (
  <div className="border-t border-border/30" />
)}
```

6. Hide entire Card if no applicable content:
```typescript
if (!showPreMatch && !showBetting && !showPostMatch) {
  return null;
}
```

Full implementation should match the pattern in 13-RESEARCH.md "Updated MatchContentSection with State Logic" code example.
  </action>
  <verify>
`npm run build` passes without type errors.
Component accepts matchStatus prop.
  </verify>
  <done>
MatchContentSection shows content based on match state. Pre-match for scheduled, betting for live/finished, post-match for finished only. ReadMoreText used for long post-match content.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update match page to pass matchStatus prop</name>
  <files>src/app/leagues/[slug]/[match]/page.tsx</files>
  <action>
Update the MatchContentSection usage in the match page to pass the matchStatus prop:

Find the existing line:
```typescript
<MatchContentSection matchId={matchData.id} />
```

Update to:
```typescript
<MatchContentSection matchId={matchData.id} matchStatus={matchData.status} />
```

The matchData.status is already available from the getMatchBySlug query result. No new data fetching required.

Also verify that MatchContentSection is imported and placed appropriately in the page layout (it should be before the "Match Roundup" section for finished matches, as both may contain post-match content but MatchContentSection shows the short-form summary while RoundupViewer shows the full detailed roundup).

Layout order should be:
1. Match header/score
2. Match events (if live/finished)
3. MatchStats
4. MatchContentSection (pre-match OR betting+post-match summary)
5. Match Roundup (full detailed roundup for finished matches)
6. AI Model Predictions table
7. AI Analysis & Insights
8. Related matches
  </action>
  <verify>
`npm run build` passes.
Manual test: Visit a scheduled match page, a finished match page - verify correct content sections display.
  </verify>
  <done>
Match page passes matchStatus prop to MatchContentSection. Content displays correctly based on match state.
  </done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build`
2. Scheduled match shows pre-match content only (no betting/post-match)
3. Finished match shows betting + post-match content (no pre-match)
4. Long post-match content truncates with "Read More" button
5. Empty content states hide gracefully (no empty cards)
</verification>

<success_criteria>
- MatchContentSection accepts matchStatus prop
- Pre-match content appears on scheduled match pages
- Betting content appears on live/finished match pages
- Post-match content with ReadMoreText appears on finished match pages
- Component hides when no applicable content exists
- Build completes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/13-content-pipeline-fixes/13-03-SUMMARY.md`
</output>
