---
phase: 13-content-pipeline-fixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/match/ReadMoreText.tsx
autonomous: true

must_haves:
  truths:
    - "Long text is truncated to ~6 lines (150-200 words) by default"
    - "User can click 'Read More' to expand full content"
    - "User can click 'Show Less' to collapse back"
    - "Screen readers announce expansion state correctly"
  artifacts:
    - path: "src/components/match/ReadMoreText.tsx"
      provides: "ReadMoreText client component"
      exports: ["ReadMoreText"]
      min_lines: 40
  key_links:
    - from: "src/components/match/ReadMoreText.tsx"
      to: "tailwindcss line-clamp"
      via: "className line-clamp-6"
      pattern: "line-clamp"
---

<objective>
Create the ReadMoreText client component for progressive disclosure of long narrative content, using CSS line-clamp for truncation and React useState for expansion toggle with full accessibility compliance.

Purpose: Fix CONT-05 requirement - "Read More" expansion for long narrative content (150-200 word preview).
Output: `ReadMoreText.tsx` component with aria-expanded accessibility.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-content-pipeline-fixes/13-RESEARCH.md

# Reference existing UI patterns
@src/components/ui/button.tsx
@src/lib/utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ReadMoreText client component</name>
  <files>src/components/match/ReadMoreText.tsx</files>
  <action>
Create new file `src/components/match/ReadMoreText.tsx`:

```typescript
'use client';

import { useState } from 'react';
import { cn } from '@/lib/utils';

interface ReadMoreTextProps {
  /** The text content to display */
  text: string;
  /** Number of lines to show when collapsed (default: 6 for ~150-200 words) */
  previewLines?: number;
  /** Additional CSS classes for the text container */
  className?: string;
  /** Minimum character count to trigger truncation (default: 600) */
  minCharsToTruncate?: number;
}

/**
 * ReadMoreText - Progressive disclosure for long-form content
 *
 * Uses CSS line-clamp for visual truncation and React useState for expansion.
 * Accessibility: aria-expanded, aria-label for screen reader support.
 */
export function ReadMoreText({
  text,
  previewLines = 6,
  className,
  minCharsToTruncate = 600,
}: ReadMoreTextProps) {
  const [expanded, setExpanded] = useState(false);

  // Don't truncate if text is short enough
  const shouldTruncate = text.length > minCharsToTruncate;

  if (!shouldTruncate) {
    return (
      <div className={cn('text-foreground leading-relaxed', className)}>
        {text}
      </div>
    );
  }

  return (
    <div>
      <div
        className={cn(
          'text-foreground leading-relaxed',
          !expanded && 'line-clamp-6',
          className
        )}
      >
        {text}
      </div>
      <button
        onClick={() => setExpanded(!expanded)}
        className="text-primary hover:underline mt-3 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded"
        aria-expanded={expanded}
        aria-label={expanded ? 'Collapse content to preview' : 'Expand to read full content'}
        type="button"
      >
        {expanded ? 'Show Less' : 'Read More'}
      </button>
    </div>
  );
}
```

Notes:
- Use 'use client' directive (component uses useState)
- line-clamp-6 is Tailwind built-in class (no custom CSS needed)
- aria-expanded + aria-label for WCAG 1.3.1 compliance
- Focus ring for keyboard navigation
- type="button" prevents form submission if used in form context
  </action>
  <verify>
1. File exists: `ls src/components/match/ReadMoreText.tsx`
2. Build passes: `npm run build`
3. Component renders: Add temporary test import in any page to confirm no errors
  </verify>
  <done>
ReadMoreText component exists with useState toggle, line-clamp-6 truncation, and aria-expanded accessibility. Build completes without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify Tailwind line-clamp utility exists</name>
  <files>tailwind.config.ts</files>
  <action>
Verify Tailwind CSS has line-clamp utility available. As of Tailwind v3.3+, line-clamp is built-in (no plugin needed).

Check current Tailwind version:
```bash
grep tailwindcss package.json
```

If Tailwind version is 3.3+: No action needed, line-clamp-* utilities are built-in.

If Tailwind version is older (unlikely): Add @tailwindcss/line-clamp plugin:
```bash
npm install -D @tailwindcss/line-clamp
```
And add to tailwind.config.ts plugins array.

Expected: Tailwind is recent enough that no changes needed.
  </action>
  <verify>
Test line-clamp in browser dev tools or with: `grep -r "line-clamp" node_modules/.pnpm/tailwindcss*/`
  </verify>
  <done>
Tailwind line-clamp utility is available (either built-in or plugin installed).
  </done>
</task>

</tasks>

<verification>
1. Component file exists: `ls -la src/components/match/ReadMoreText.tsx`
2. Build passes: `npm run build`
3. TypeScript types correct: No errors in IDE
4. Line-clamp works: Manually verify in browser with long text
</verification>

<success_criteria>
- ReadMoreText.tsx exists in src/components/match/
- Component exports ReadMoreText function
- Uses line-clamp-6 for truncation
- Has aria-expanded and aria-label for accessibility
- Build completes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/13-content-pipeline-fixes/13-02-SUMMARY.md`
</output>
