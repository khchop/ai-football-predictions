---
phase: 26-context-foundation
plan: 02
type: execute
wave: 2
depends_on: [01]
files_modified:
  - src/app/matches/[id]/page.tsx
  - src/app/leagues/[slug]/[match]/page.tsx
autonomous: true
must_haves:
  truths:
    - "MatchDataProvider wraps all page content at page level"
    - "Match/Competition/Analysis data passed to provider via props"
    - "Child component props (match, competition, isLive, isFinished) removed where provider takes over"
    - "No component fetches match data independently (verified by grep search)"
  artifacts:
    - path: "src/app/matches/[id]/page.tsx"
      provides: "Server Component server fetching + Client Component Context provider"
      contains: "MatchDataProvider import/use, match/competition/analysis props to provider"
    - path: "src/app/leagues/[slug]/[match]/page.tsx"
      provides: "Server Component server fetching + Client Component Context provider"
      contains: "MatchDataProvider import/use, match/competition/analysis props to provider"
  key_links:
    - from: "src/app/matches/[id]/page.tsx"
      to: "src/components/match/match-data-provider.tsx"
      via: "import MatchDataProvider"
      pattern: "import.*MatchDataProvider.*from.*@/components/match"
    - from: "src/app/leagues/[slug]/[match]/page.tsx"
      to: "src/components/match/match-data-provider.tsx"
      via: "import MatchDataProvider"
      pattern: "import.*MatchDataProvider.*from.*@/components/match"
    - from: "src/app/matches/[id]/page.tsx getMatchWithAnalysis"
      to: "MatchDataProvider props"
      via: "server fetch + prop drill to provider"
      pattern: "getMatchWithAnalysis.*Result.*MatchDataProvider"
    - from: "src/app/leagues/[slug]/[match]/page.tsx getMatchBySlug + getMatchWithAnalysis"
      to: "MatchDataProvider props"
      via: "server fetch + prop drill to provider"
      pattern: "getMatchBySlug.*getMatchWithAnalysis.*MatchDataProvider"
---

<objective>
Integrate MatchDataProvider into match pages for single-source-of-truth data flow

Purpose: Eliminate duplicate data fetching and prop drilling by wrapping page content with Context provider
Output: Both match pages use MatchDataProvider at page level, data flows once from Server Component to Client Component provider
</objective>

<execution_context>
@/Users/pieterbos/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/26-context-foundation/26-RESEARCH.md
@.planning/phases/26-context-foundation/26-01-SUMMARY.md

# Current page implementations
@/Users/pieterbos/Documents/bettingsoccer/src/app/matches/[id]/page.tsx
@/Users/pieterbos/Documents/bettingsoccer/src/app/leagues/[slug]/[match]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wrap matches/[id]/page.tsx content with MatchDataProvider</name>
  <files>src/app/matches/[id]/page.tsx</files>
  <action>
    Update src/app/matches/[id]/page.tsx to integrate MatchDataProvider:
    
    1. Add import: import { MatchDataProvider } from '@/components/match/match-data-provider';
    2. Find the return statement where content is rendered (starts around line 105)
    3. Wrap the entire JSX return content (except JSON-LD script) with MatchDataProvider
    4. Pass provider props: match={match}, competition={competition}, analysis={analysis}
    5. Move JSON-LD script OUTSIDE MatchDataProvider (it should remain at page level, not inside provider)
    
    Structure:
    ```jsx
    return (
      <>
        {/* JSON-LD remains outside provider */}
        <script type="application/ld+json" ... />
        
        {/* Provider wraps all content */}
        <MatchDataProvider match={match} competition={competition} analysis={analysis}>
          <div className="max-w-4xl mx-auto space-y-8">
            {/* All existing content */}
          </div>
        </MatchDataProvider>
      </>
    );
    ```
    
    DO NOT:
    - Wrap JSON-LD script inside MatchDataProvider (metadata stays at root)
    - Pass isLive or isFinished props to provider (derived from context)
    - Try to getMatchWithAnalysis multiple times (keep single fetch at top)
    - Remove the server-side getMatchWithAnalysis call (we still need it for SSR)
    - Use useMatch hook in this Server Component (hooks only in Client Components)
    
    Note: Child components still use props for now (MatchHeader, MatchOddsPanel, PredictionsSection). Future phases will migrate them to useMatch hook.
  </action>
  <verify>
    File has import for MatchDataProvider, MatchDataProvider wraps return JSX content, JSON-LD script remains outside provider, match/competition/analysis passed as props to provider
  </verify>
  <done>MatchDataProvider wraps all page content, data fetched once via getMatchWithAnalysis and passed to provider, JSON-LD at root level</done>
</task>

<task type="auto">
  <name>Task 2: Wrap leagues/[slug]/[match]/page.tsx content with MatchDataProvider</name>
  <files>src/app/leagues/[slug]/[match]/page.tsx</files>
  <action>
    Update src/app/leagues/[slug]/[match]/page.tsx to integrate MatchDataProvider:
    
    1. Add import: import { MatchDataProvider } from '@/components/match/match-data-provider';
    2. Find the return statement where content is rendered (starts around line 167)
    3. Wrap the entire JSX return content (except JSON-LD and schemas) with MatchDataProvider
    4. Pass provider props: match={matchData}, competition={competition}, analysis={analysis}
    5. Move JSON-LD schemas (MatchPageSchema, BreadcrumbsWithSchema) OUTSIDE MatchDataProvider (they should remain at page level, not inside provider)
    
    Structure:
    ```jsx
    return (
      <div className="max-w-4xl mx-auto space-y-8">
        {/* Page-level schemas remain outside provider */}
        <MatchPageSchema match={matchData} competition={{...}} url="..." />
        <BreadcrumbsWithSchema items={breadcrumbs} />
        
        {/* Provider wraps all content */}
        <MatchDataProvider match={matchData} competition={competition} analysis={analysis}>
          <MatchH1 homeTeam={...} awayTeam={...} />
          {/* All existing content */}
        </MatchDataProvider>
      </div>
    );
    ```
    
    DO NOT:
    - Wrap MatchPageSchema or BreadcrumbsWithSchema inside MatchDataProvider (metadata stays at root)
    - Pass isLive or isFinished props to provider (derived from context)
    - Try to fetch data multiple times (keep existing single fetch pattern)
    - Remove the server-side getMatchBySlug/getMatchWithAnalysis calls
    - Use useMatch hook in this Server Component (hooks only in Client Components)
    
    Note: Page uses matchData variable name (not match), keep consistent with existing code.
  </action>
  <verify>
    File has import for MatchDataProvider, MatchDataProvider wraps return JSX content, MatchPageSchema and BreadcrumbsWithSchema remain outside provider, matchData/competition/analysis passed as props to provider
  </verify>
  <done>MatchDataProvider wraps all page content, data fetched once via getMatchBySlug+getMatchWithAnalysis and passed to provider, schemas at root level</done>
</task>

<task type="auto">
  <name>Task 3: Verify no components fetch match data independently</name>
  <files>(verification only)</files>
  <action>
    Run code review check to verify ARCH-02 requirement (no component fetches match data independently):
    
    ```bash
    # For each page directory
    grep -r "getMatchWithAnalysis\|getMatchBySlug" src/app/matches/[id]/ --include="*.tsx" | grep -v "page.tsx"
    grep -r "getMatchWithAnalysis\|getMatchBySlug" src/app/leagues/*/ --include="*.tsx" | grep -v "page.tsx"
    ```
    
    Expected: No results (only page.tsx files should fetch data)
    
    If results found:
    - File reports which components still fetch data independently
    - Note: This is informational only - those component migrations will happen in future phases
    - Current phase scope: Pages use provider, existing components temporarily continue using props
    
    DO NOT:
    - Try to migrate all child components in this phase (future scope)
    - Fail verification if child components still use getMatchWithAnalysis (expected for now)
    - Create new component files (only verify existing)
  </action>
  <verify>
    grep command returns no child components fetching match data independently (only page.tsx files have fetch calls), or documentation of child components that still fetch (for future migration)
  </verify>
  <done>Code review confirms only page.tsx files fetch match data, child components use props (future migration to useMatch hook)</done>
</task>

</tasks>

<verification>
After completion:
1. Check both page.tsx files have MatchDataProvider imported and used
2. Check JSON-LD/schemas remain outside MatchDataProvider
3. Check match/competition/analysis passed to provider as props
4. Run grep to verify no child components independently fetch match data
5. Build passes with TypeScript (no type errors)
</verification>

<success_criteria>
MatchDataProvider integrated into both match pages:
- Server Components fetch data once via getMatchWithAnalysis
- MatchDataProvider wraps all page content at appropriate nesting level
- JSON-LD schema components remain at page root (outside provider)
- Data flows: Server Components (fetch) → MatchDataProvider (distribute) → Child components (consume via props - Phase 27+ will use useMatch hook)
- No component fetches match data independently (verified by code review)
</success_criteria>

<output>
After completion, create `.planning/phases/26-context-foundation/26-02-SUMMARY.md` with:
- Which pages were updated (matches/[id]/page.tsx, leagues/[slug]/[match]/page.tsx)
- How MatchDataProvider was integrated (wrapped content, props passed)
- What remains at page level (JSON-LD, schemas)
- Child components still using props (future migration plan)
- Verification results (grep search for independent fetches)
</output>
