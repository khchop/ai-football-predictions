---
phase: 07-documentation-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/03-stats-ui/03-VERIFICATION.md
  - src/app/leaderboard/page.tsx
  - src/app/api/stats/models/[id]/route.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Phase 3 verification documentation accurately reflects current state (gaps closed)"
    - "ISR pattern architectural choice is documented in code comments"
    - "Orphaned API routes are marked with JSDoc noting future use"
  artifacts:
    - path: ".planning/phases/03-stats-ui/03-stats-ui-VERIFICATION.md"
      provides: "Current Phase 3 verification state (passed, all gaps closed)"
      min_lines: 150
    - path: "src/app/leaderboard/page.tsx"
      provides: "ISR pattern documentation comment"
      contains: "ISR pattern"
    - path: "src/app/api/stats/models/[id]/route.ts"
      provides: "JSDoc for future use"
      contains: "@deprecated or @todo or future use"
  key_links: []
---

<objective>
Update phase verification docs and address low-priority documentation tech debt

Purpose: Close INT-05 and resolve three documentation/architecture clarity issues identified in the v1.1 milestone audit
Output: Updated VERIFICATION.md, documented ISR pattern, and JSDoc annotations for orphaned API routes
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/v1.1-MILESTONE-AUDIT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Refer to Phase 3 work:
@.planning/phases/03-stats-ui/03-stats-ui-VERIFICATION.md
@.planning/phases/03-stats-ui/03-04-SUMMARY.md
@.planning/phases/03-stats-ui/03-06-SUMMARY.md

Refer to Phase 6 completion:
@.planning/phases/06-roundup-integration/06-VERIFICATION.md
@.planning/phases/06-roundup-integration/06-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove outdated Phase 3 verification file</name>
  <files>.planning/phases/03-stats-ui/03-VERIFICATION.md</files>
  <action>
Delete the outdated `03-VERIFICATION.md` file which shows gaps for season/model selectors that have already been closed.

Gap context: The audit report (v1.1-MILESTONE-AUDIT.md) identifies a "verification state mismatch" - the old VERIFICATION.md shows gaps_found status, but the code has these features implemented (plans 03-04 and 03-06 closed these gaps). The re-verification file `03-stats-ui-VERIFICATION.md` correctly shows passed status with all 5 must-haves verified.

Action steps:
1. Use Bash to delete `.planning/phases/03-stats-ui/03-VERIFICATION.md`
2. Confirm deletion by listing the directory contents
3. The newer `03-stats-ui-VERIFICATION.md` file (created after 03-04 gap closure) accurately reflects the current state

Do NOT:
- Delete `03-stats-ui-VERIFICATION.md` (the current, accurate verification)
- Update or modify any verification content (just remove the outdated file)
</action>
  <verify>ls -la .planning/phases/03-stats-ui/ shows only ONE verification file (03-stats-ui-VERIFICATION.md) and 03-VERIFICATION.md is deleted</verify>
  <done>Outdated 03-VERIFICATION.md deleted, only accurate 03-stats-ui-VERIFICATION.md remains in the directory</done>
</task>

<task type="auto">
  <name>Task 2: Document ISR pattern architectural choice</name>
  <files>src/app/leaderboard/page.tsx</files>
  <action>
Add a code comment explaining the ISR pattern consistency between Phase 3 and Phase 5.

Gap context: The audit report notes "ISR pattern inconsistency - Phase 3 uses fetch-level revalidate: 60, Phase 5 uses page-level export const revalidate = 60 (both valid but inconsistent)". Both patterns are valid Next.js approaches:
- Fetch-level: `next: { revalidate: 60 }` in fetch options (more granular control, Phase 3 pattern)
- Page-level: `export const revalidate = 60` (simpler declarative approach, Phase 5 pattern)

Action steps:
1. Read the current `src/app/leaderboard/page.tsx` file (already loaded - see lines 78-86 with fetch call)
2. Add a JSDoc-style comment ABOVE the `fetchLeaderboard` function (around line 57-58) explaining:
   - Why fetch-level revalidate is used here (Phase 3 pattern)
   - Both fetch-level and page-level are valid Next.js ISR approaches
   - The choice was made for consistency across leaderboard pages
3. Format as:
   ```typescript
   /**
    * Fetch leaderboard data from the API with ISR caching.
    *
    * ISR Pattern: Uses fetch-level `revalidate: 60` option (Phase 3 pattern)
    *
    * Note: Next.js supports two valid ISR patterns:
    * 1. Fetch-level: next: { revalidate: 60 } in fetch options (used here)
    * 2. Page-level: export const revalidate = 60 at module scope (Phase 5 pattern)
    *
    * The fetch-level approach allows more granular control when pages make multiple
    * fetch calls with different revalidation needs. Leaderboard pages were built
    * using this pattern in Phase 3 and remain consistent with the original design.
    */
   async function fetchLeaderboard(filters: Record<string, string>): Promise<...>
   ```

Do NOT:
- Change the ISR implementation (only add documentation comment)
- Modify other files (add comment only to this one file as an example)
- Remove the existing `next: { revalidate: 60 }` from the fetch call (keep the implementation)
</action>
  <verify>grep -A 15 "ISR Pattern" src/app/leaderboard/page.tsx shows the documentation comment above fetchLeaderboard function</verify>
  <done>ISR pattern documented with clear explanation of architectural choice and reference to Phase 5 pattern</done>
</task>

<task type="auto">
  <name>Task 3: Add JSDoc to orphaned API route</name>
  <files>src/app/api/stats/models/[id]/route.ts</files>
  <action>
Add a JSDoc comment noting that this endpoint is currently unused and reserved for future use.

Gap context: INT-05 identifies orphaned API routes. `/api/matches/[id]/roundup` was previously orphaned but is now consumed by Phase 6 (MatchRoundup component). However, `/api/stats/models/[id]` remains without a UI consumer - it's a functional API endpoint for fetching model-specific stats but no leaderboard page or component currently calls it.

Action steps:
1. Read the current route file (already loaded - see full file content)
2. Add a JSDoc comment at the TOP of the file (after imports, before the querySchema constant, around line 11) explaining:
   - The endpoint works correctly (functional, well-implemented)
   - Currently no UI component consumes it (orphaned)
   - Reserved for future model detail pages or similar features
3. Format as:
   ```typescript
   /**
    * GET /api/stats/models/[id] - Model-specific statistics endpoint
    *
    * Returns detailed performance statistics for a specific AI model, including:
    * - Overall stats (points, accuracy, streaks)
    * Competition-scoped stats (if competition filter provided)
    * Club-scoped stats (if club filter provided)
    *
    * @deprecated - No UI consumer currently uses this endpoint
    * @reserved - Endpoint is reserved for future model detail pages or analytical views
    *
    * Note: This endpoint is fully functional and follows the same authentication,
    * caching, and rate limiting patterns as other stats API routes. It was created
    * as part of Phase 2 Stats API work but has not yet been connected to any UI.
    *
    * Future use cases may include:
    * - Model detail pages showing comprehensive performance history
    * - Model comparison tools
    * - Analytical dashboards for model researchers
    */
   import { NextRequest, NextResponse } from 'next/server';
   ```

Do NOT:
- Remove or disable the endpoint (keep it functional)
- Mark it as broken (it works, just unused)
- Create new UI to consume it (that's out of scope for this low-priority cleanup)
</action>
  <verify>grep -A 20 "@deprecated\|@reserved" src/app/api/stats/models/[id]/route.ts shows the JSDoc comment explaining future use</verify>
  <done>Orphaned API route documented with clear JSDoc noting current status (functional but unused) and future reservation</done>
</task>

</tasks>

<verification>
## Overall Verification

1. **Documentation Cleanup:** Verify that only one Phase 3 verification file exists (03-stats-ui-VERIFICATION.md, not the outdated 03-VERIFICATION.md)

2. **ISR Pattern Documentation:** Confirm the comment exists explaining the fetch-level vs page-level architectural choice

3. **Orphaned Route Documentation:** Confirm JSDoc exists explaining the endpoint is reserved for future use

Run verification:
```bash
# Check verification files
ls -la .planning/phases/03-stats-ui/*-VERIFICATION.md  # Should show only 1 file

# Check ISR pattern comment
grep -B 2 -A 20 "ISR Pattern" src/app/leaderboard/page.tsx

# Check JSDoc on orphaned route
grep -B 2 -A 20 "@deprecated\|@reserved" src/app/api/stats/models/[id]/route.ts
```
</verification>

<success_criteria>
1. Outdated 03-VERIFICATION.md deleted, only accurate 03-stats-ui-VERIFICATION.md remains
2. ISR pattern architectural choice documented in leaderboard page with clear explanation
3. Orphaned /api/stats/models/[id] route has JSDoc noting current unused status and future reservation
4. All modifications are documentation-only (no functionality changed)
</success_criteria>

<output>
After completion, create `.planning/phases/07-documentation-cleanup/07-01-SUMMARY.md`
</output>
