---
phase: 07-seo-enhancement
plan: 03
type: execute
wave: 2
depends_on: [07-01, 07-02]
files_modified:
  - src/app/sitemap/static.xml/route.ts
  - src/lib/seo/constants.ts
autonomous: true

must_haves:
  truths:
    - "Sitemap includes /methodology page"
    - "All pages pass Google Rich Results Test without errors"
    - "Meta descriptions are under 160 characters"
    - "Social shares display Prediction Accuracy: X% label"
  artifacts:
    - path: "src/app/sitemap/static.xml/route.ts"
      provides: "Static sitemap including methodology page"
      contains: "methodology"
  key_links:
    - from: "src/app/sitemap.xml/route.ts"
      to: "src/app/sitemap/static.xml/route.ts"
      via: "sitemap index reference"
      pattern: "static.xml"
---

<objective>
Finalize SEO implementation with sitemap updates and validation sweep.

Purpose: Ensure /methodology page (created in Phase 6) is discoverable by search engines and validate that all structured data passes Google's Rich Results Test requirements.

Output: Updated sitemap, validated schemas, and confirmation that all success criteria from roadmap are met.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-seo-enhancement/07-CONTEXT.md
@src/app/sitemap/static.xml/route.ts
@src/app/methodology/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add methodology page to sitemap</name>
  <files>
    src/app/sitemap/static.xml/route.ts
  </files>
  <action>
1. Update `src/app/sitemap/static.xml/route.ts`:
   - Add /methodology to static URLs array with:
     - priority: 0.7 (important reference page)
     - changefreq: 'monthly' (rarely changes)
     - lastmod: current date
   - Verify other static pages are included:
     - / (homepage) - priority 1.0
     - /about - priority 0.6
     - /leaderboard - priority 0.9
     - /matches - priority 0.8
     - /blog - priority 0.7
     - /methodology - priority 0.7 (NEW)

If static sitemap doesn't exist, check sitemap structure and add /methodology wherever static pages are defined.
  </action>
  <verify>
    Build and check sitemap: `npm run build && curl -s http://localhost:3000/sitemap/static.xml | grep methodology`
    Or if using dev: `npm run dev &` then `sleep 5 && curl -s http://localhost:3000/sitemap/static.xml | grep methodology`
  </verify>
  <done>
    /methodology page included in sitemap with appropriate priority
    Sitemap validates as proper XML
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate schema output and fix any issues</name>
  <files>
    src/lib/seo/schema/sports-event.ts
    src/lib/seo/schema/article.ts
    src/lib/seo/schema/competition.ts
    src/lib/seo/schema/graph.ts
  </files>
  <action>
1. Review all schema builders for Google Rich Results requirements:

   SportsEvent (src/lib/seo/schema/sports-event.ts):
   - Required: name, startDate (ISO-8601 with timezone), location.Place
   - Required by Google: eventStatus (https://schema.org/EventScheduled)
   - For finished: Add homeTeamScore, awayTeamScore properties
   - Verify competitor array has @type: "SportsTeam" for each

   Article (src/lib/seo/schema/article.ts):
   - Required: headline, datePublished, author, publisher.logo
   - publisher must have logo.ImageObject with url property
   - image must be array of URLs or ImageObject

   Competition/SportsOrganization:
   - Required: name, url
   - sport should be "Football" (string)

   BreadcrumbList:
   - Required: itemListElement array
   - Each ListItem needs: position (1-indexed), name, item (URL)

2. Ensure all schemas include @context: "https://schema.org" at graph level (not individual items)

3. Fix any missing required properties identified above
  </action>
  <verify>
    Run build: `npm run build`
    No TypeScript errors in schema files
    Manually test one page JSON-LD is valid JSON: `curl -s localhost:3000 | grep -oP '(?<=application/ld\+json">)[^<]+' | head -1 | jq .` (if jq available)
  </verify>
  <done>
    All schema builders include required properties for Rich Results
    JSON-LD output is valid JSON
    No TypeScript errors in schema files
  </done>
</task>

<task type="auto">
  <name>Task 3: Validate metadata length constraints</name>
  <files>
    src/lib/seo/metadata.ts
    src/lib/seo/constants.ts
  </files>
  <action>
1. Add length validation helpers to `src/lib/seo/constants.ts`:
   - MAX_TITLE_LENGTH = 60
   - MAX_META_DESCRIPTION_LENGTH = 155
   - MAX_OG_DESCRIPTION_LENGTH = 200

2. Update `src/lib/seo/metadata.ts`:
   - Add helper function `truncateWithEllipsis(text: string, maxLength: number): string`
   - Apply to all description generators:
     - createDescription() output truncated to 155 chars
     - OG descriptions truncated to 200 chars
     - Titles truncated to 60 chars (but prioritize removing site name suffix over truncating content)

   Truncation strategy:
   - If over limit, truncate at last word boundary before limit
   - Add "..." only if actually truncated
   - Never break mid-word

3. Verify existing metadata functions respect limits:
   - buildMatchMetadata
   - generateCompetitionMetadata
   - generateArticleMetadata
   - generateLeaderboardMetadata
   - generateHomeMetadata

4. Test accuracy label fits: "Prediction Accuracy: X%" = 23 chars, leaves ~130 chars for rest of description
  </action>
  <verify>
    TypeScript compiles: `npx tsc --noEmit`
    Constants exist: `grep "MAX_.*LENGTH" src/lib/seo/constants.ts`
    Truncation helper exists: `grep "truncateWithEllipsis" src/lib/seo/metadata.ts`
  </verify>
  <done>
    Length constants defined in constants.ts
    Truncation helper implemented and used
    All metadata functions respect length limits
    Accuracy label fits within limits
  </done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build`
2. Sitemap includes methodology: Check static.xml for /methodology entry
3. Schema validation: All schema files compile without errors
4. Length constraints: Constants and truncation helper exist
5. Manual spot check: Start dev server, inspect a few pages for valid JSON-LD
</verification>

<success_criteria>
- Sitemap includes /methodology with priority 0.7
- All schema builders have required Google Rich Results properties
- Meta descriptions enforced under 160 characters
- Titles enforced under 60 characters
- OG descriptions under 200 characters
- Build passes without errors
- JSON-LD output is valid on all enhanced pages
</success_criteria>

<output>
After completion, create `.planning/phases/07-seo-enhancement/07-03-SUMMARY.md`
</output>
