---
phase: 07-seo-enhancement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/seo/schema/sports-event.ts
  - src/lib/seo/schema/competition.ts
  - src/lib/seo/schema/breadcrumb.ts
  - src/lib/seo/metadata.ts
  - src/app/matches/[id]/page.tsx
  - src/app/leagues/[slug]/[match]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Match pages render SportsEvent with location.Place property in Rich Results Test"
    - "Match pages include competition context in schema"
    - "Past matches >30 days old have noindex meta tag"
    - "OG descriptions include predicted score for upcoming matches"
  artifacts:
    - path: "src/lib/seo/schema/sports-event.ts"
      provides: "Enhanced SportsEvent builder with location.Place"
      contains: "location.*Place"
    - path: "src/lib/seo/schema/competition.ts"
      provides: "SportsOrganization schema for competitions"
      contains: "SportsOrganization"
    - path: "src/lib/seo/schema/breadcrumb.ts"
      provides: "BreadcrumbList builder for page trails"
      contains: "BreadcrumbList"
  key_links:
    - from: "src/app/matches/[id]/page.tsx"
      to: "src/lib/seo/schema/sports-event.ts"
      via: "buildSportsEventSchema import"
      pattern: "buildSportsEventSchema"
    - from: "src/app/leagues/[slug]/[match]/page.tsx"
      to: "src/lib/seo/metadata.ts"
      via: "buildMatchMetadata import"
      pattern: "buildMatchMetadata"
---

<objective>
Enhance match page structured data and metadata for Google Rich Results eligibility.

Purpose: Match pages are the highest-traffic pages. SportsEvent schema with required properties (location, eventStatus, scores) enables rich snippets in search results.

Output: Enhanced schema builders, updated metadata with dynamic noindex for old matches, OG descriptions with predicted scores.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-seo-enhancement/07-CONTEXT.md
@.planning/phases/07-seo-enhancement/07-RESEARCH.md
@src/lib/seo/schema/sports-event.ts
@src/lib/seo/metadata.ts
@src/lib/seo/types.ts
@src/app/matches/[id]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance SportsEvent schema and create competition schema</name>
  <files>
    src/lib/seo/schema/sports-event.ts
    src/lib/seo/schema/competition.ts
    src/lib/seo/schema/breadcrumb.ts
  </files>
  <action>
1. Update `src/lib/seo/schema/sports-event.ts`:
   - Add `location` property with `Place` type (required by Google Rich Results)
   - Fix eventStatus mapping: Use `EventScheduled` for all (no EventCompleted in schema.org), add `homeTeamScore`/`awayTeamScore` for finished matches to signal completion
   - Add competition reference using `superEvent` property pointing to SportsOrganization
   - Ensure ISO-8601 date format with timezone for startDate

2. Create `src/lib/seo/schema/competition.ts`:
   - Export `buildCompetitionSchema(competition: Competition): SportsOrganization`
   - Include: @type, @id, name, url, sport: "Football"
   - Use existing COMPETITIONS data from `/lib/football/competitions`

3. Create `src/lib/seo/schema/breadcrumb.ts`:
   - Export `buildBreadcrumbSchema(items: BreadcrumbItem[]): BreadcrumbList`
   - Each item: { name: string, url: string }
   - Use schema-dts types for type safety
   - Export helper `buildMatchBreadcrumbs(competition: string, competitionSlug: string, matchName: string, matchSlug: string)`

Use schema-dts types (already installed). Use BASE_URL from constants.
  </action>
  <verify>
    TypeScript compiles: `npx tsc --noEmit`
    Run: `grep -l "SportsOrganization\|BreadcrumbList" src/lib/seo/schema/*.ts` shows new files
  </verify>
  <done>
    SportsEvent has location.Place property
    SportsOrganization schema builder exists for competitions
    BreadcrumbList builder exists with match helper
  </done>
</task>

<task type="auto">
  <name>Task 2: Update match metadata with accuracy label and dynamic noindex</name>
  <files>
    src/lib/seo/metadata.ts
    src/lib/seo/types.ts
  </files>
  <action>
1. Update `src/lib/seo/types.ts`:
   - Add optional `modelAccuracy?: number` field to MatchSeoData
   - Add optional `predictedHomeScore?: number` and `predictedAwayScore?: number` fields

2. Update `src/lib/seo/metadata.ts`:
   - Modify `createDescription()` for upcoming matches to include predicted score:
     `"AI predicts ${predictedHomeScore}-${predictedAwayScore} for ${homeTeam} vs ${awayTeam} on ${date}"`
   - Add accuracy to OG description when available: append ` - Prediction Accuracy: ${accuracy}%`
   - Keep total OG description under 200 chars (truncate team names if needed)
   - Update `buildMatchMetadata()` to return `robots.index: false` for matches where:
     - status === 'finished' AND
     - (Date.now() - new Date(startDate).getTime()) > 30 * 24 * 60 * 60 * 1000
   - Keep `robots.follow: true` always

Meta description formula (max 155 chars):
- Upcoming: "AI predicts 2-1 for Arsenal vs Chelsea. 35 models compete - see who's most accurate."
- Finished: "Arsenal 2-1 Chelsea match analysis. AI predictions from 35 models with accuracy tracking."
  </action>
  <verify>
    TypeScript compiles: `npx tsc --noEmit`
    Grep for noindex logic: `grep -n "30.*days\|index.*false" src/lib/seo/metadata.ts`
  </verify>
  <done>
    OG descriptions include predicted score for upcoming matches
    OG descriptions include accuracy when available
    Matches older than 30 days get noindex robots tag
    Meta descriptions stay under 160 characters
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire enhanced schemas to match pages</name>
  <files>
    src/app/matches/[id]/page.tsx
    src/app/leagues/[slug]/[match]/page.tsx
    src/lib/seo/schema/graph.ts
  </files>
  <action>
1. Update `src/lib/seo/schema/graph.ts`:
   - Import `buildBreadcrumbSchema` from breadcrumb.ts
   - Add breadcrumbs to the @graph array in `buildMatchGraphSchema()`
   - Pass match data through to generate breadcrumb trail: Home > Leagues > {Competition} > {Match}

2. Update `src/app/matches/[id]/page.tsx`:
   - In `generateMetadata()`: Pass modelAccuracy and predicted scores to mapMatchToSeoData when available
   - Get predicted scores from analysis.likelyScores[0] if available
   - Get accuracy from the match's prediction stats if available

3. Update `src/app/leagues/[slug]/[match]/page.tsx` (same pattern):
   - If this file exists and has its own generateMetadata, apply same changes
   - Ensure it uses buildMatchMetadata from lib/seo/metadata.ts

Note: The redirect in matches/[id] to leagues/[slug]/[match] means both pages may need updates.
  </action>
  <verify>
    Start dev server: `npm run dev &`
    Wait 5 seconds, then test:
    `curl -s http://localhost:3000/matches/[any-match-id] | grep -o 'application/ld+json' | head -1`
    Should return "application/ld+json"
    Kill dev server after test
  </verify>
  <done>
    Match pages render SportsEvent with location in JSON-LD
    Match pages include BreadcrumbList in JSON-LD @graph
    OG descriptions show predicted score when available
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. Schema files exist with correct exports:
   - `grep "export.*buildSportsEventSchema" src/lib/seo/schema/sports-event.ts`
   - `grep "export.*buildCompetitionSchema" src/lib/seo/schema/competition.ts`
   - `grep "export.*buildBreadcrumbSchema" src/lib/seo/schema/breadcrumb.ts`
3. Dynamic noindex in metadata: `grep "index.*status\|30.*days" src/lib/seo/metadata.ts`
4. Build passes: `npm run build` (no errors in SEO-related files)
</verification>

<success_criteria>
- Match pages have SportsEvent schema with location.Place property
- Match pages have BreadcrumbList schema in @graph
- OG descriptions include predicted score for upcoming matches
- Meta descriptions stay under 160 characters
- Past matches (>30 days finished) have noindex meta tag
- All TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-seo-enhancement/07-01-SUMMARY.md`
</output>
