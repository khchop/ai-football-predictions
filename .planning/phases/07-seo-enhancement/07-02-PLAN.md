---
phase: 07-seo-enhancement
plan: 02
type: execute
wave: 2
depends_on: ['07-01']
files_modified:
  - src/lib/seo/schema/roundup.ts
  - src/app/blog/[slug]/page.tsx
  - src/app/leagues/[slug]/page.tsx
  - src/app/leaderboard/page.tsx
  - src/app/models/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Blog roundup pages render Article + ItemList schema in Rich Results Test"
    - "Competition pages have SportsOrganization structured data"
    - "Competition pages have complete OG tags (title, description, image)"
    - "All pages have unique titles (no duplicate title patterns)"
    - "Leaderboard page has BreadcrumbList schema"
    - "Model detail pages have BreadcrumbList schema"
  artifacts:
    - path: "src/lib/seo/schema/roundup.ts"
      provides: "Article + ItemList builder for blog roundups"
      contains: "ItemList"
    - path: "src/app/leagues/[slug]/page.tsx"
      provides: "Competition page with SportsOrganization schema"
      contains: "SportsOrganization"
  key_links:
    - from: "src/app/blog/[slug]/page.tsx"
      to: "src/lib/seo/schema/roundup.ts"
      via: "buildRoundupSchema import"
      pattern: "buildRoundupSchema"
    - from: "src/app/leagues/[slug]/page.tsx"
      to: "src/lib/seo/schema/competition.ts"
      via: "buildCompetitionSchema import"
      pattern: "buildCompetitionSchema"
    - from: "src/app/leaderboard/page.tsx"
      to: "src/lib/seo/schema/breadcrumb.ts"
      via: "buildBreadcrumbSchema import"
      pattern: "buildBreadcrumbSchema"
---

<objective>
Add structured data to blog roundups, competition pages, and ensure breadcrumbs on all page types.

Purpose: Blog roundups about matchdays benefit from Article + ItemList schema (list of matches covered). Competition pages need SportsOrganization schema to establish entity recognition in Google's Knowledge Graph. All pages need BreadcrumbList for navigation context.

Output: Enhanced blog and competition pages with appropriate schema markup, breadcrumbs on leaderboard/model pages, and optimized metadata.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-seo-enhancement/07-CONTEXT.md
@.planning/phases/07-seo-enhancement/07-RESEARCH.md
@.planning/phases/07-seo-enhancement/07-01-SUMMARY.md
@src/app/blog/[slug]/page.tsx
@src/app/leagues/[slug]/page.tsx
@src/lib/seo/schemas.ts
@src/lib/seo/schema/breadcrumb.ts
@src/lib/seo/schema/competition.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create roundup schema builder and update blog pages</name>
  <files>
    src/lib/seo/schema/roundup.ts
    src/app/blog/[slug]/page.tsx
  </files>
  <action>
1. Create `src/lib/seo/schema/roundup.ts`:
   - Export `buildRoundupSchema(post: BlogPost, matches?: Match[]): object`
   - Build Article schema with: headline, description, datePublished, author (Organization), publisher with logo
   - Build ItemList schema when matches provided:
     - @type: "ItemList"
     - @id: "{BASE_URL}/blog/{slug}#matches"
     - itemListElement: Array of ListItem with SportsEvent references
   - Return { "@context": "https://schema.org", "@graph": [article, itemList] }
   - Add BreadcrumbList to @graph: Home > Blog > {post.title}

2. Update `src/app/blog/[slug]/page.tsx`:
   - For `contentType === 'league_roundup'`:
     - **Primary path:** Check `post.metadata.matchIds` array first (preferred if available)
     - **Fallback path:** If no matchIds in metadata, parse markdown content for `/matches/` links to extract match slugs
     - Query match data using whichever source is available
     - Use buildRoundupSchema with matches instead of generic generateArticleSchema
   - For other content types: Keep existing Article schema
   - Add BreadcrumbList schema using buildBreadcrumbSchema
   - Update OG description to include "AI predictions" and competition name if roundup

Date format for roundup titles: Use existing title from database (user decision: Claude's discretion).
  </action>
  <verify>
    TypeScript compiles: `npx tsc --noEmit`
    Schema builder exists: `grep "export.*buildRoundupSchema" src/lib/seo/schema/roundup.ts`
  </verify>
  <done>
    Roundup schema builder creates Article + ItemList @graph
    Blog roundup pages use enhanced schema with match list
    BreadcrumbList added to blog pages
  </done>
</task>

<task type="auto">
  <name>Task 2: Add SportsOrganization schema and metadata to competition pages</name>
  <files>
    src/app/leagues/[slug]/page.tsx
    src/lib/seo/metadata.ts
  </files>
  <action>
1. Update `src/app/leagues/[slug]/page.tsx`:
   - Import buildCompetitionSchema from lib/seo/schema/competition.ts (created in Plan 01)
   - Import buildBreadcrumbSchema from lib/seo/schema/breadcrumb.ts
   - Add JSON-LD script to page with @graph containing:
     - SportsOrganization schema for the competition
     - BreadcrumbList: Home > Leagues > {Competition}
   - Update generateMetadata():
     - Improve title format: `{Competition Name} Predictions | AI Models Compete | kroam.xyz`
     - Improve description: `AI predictions for {Competition Name} from 35 models. Track accuracy, compare predictions, and see which AI performs best.` (under 160 chars)
     - Add OG image pointing to league OG endpoint
     - Set robots.index: true (competitions should be indexed, they're navigation hubs)
   - Add keywords: competition name, "football predictions", "AI predictions"

2. Add helper to `src/lib/seo/metadata.ts`:
   - Export `generateCompetitionMetadata(competition: Competition): Metadata`
   - Include: title, description, openGraph, twitter, alternates.canonical, robots
   - OG type: "website" (not article - it's a listing page)
  </action>
  <verify>
    TypeScript compiles: `npx tsc --noEmit`
    Competition schema wired: `grep -n "SportsOrganization\|buildCompetitionSchema" src/app/leagues/*/page.tsx`
  </verify>
  <done>
    Competition pages render SportsOrganization in JSON-LD
    Competition pages have BreadcrumbList schema
    Competition metadata has proper OG tags and title format
    Competition pages set robots.index: true
  </done>
</task>

<task type="auto">
  <name>Task 3: Ensure unique titles and breadcrumbs across all page types</name>
  <files>
    src/lib/seo/metadata.ts
    src/app/leaderboard/page.tsx
    src/app/models/[id]/page.tsx
  </files>
  <action>
1. Audit and fix title patterns in `src/lib/seo/metadata.ts`:
   - Match pages: `{HomeTeam} vs {AwayTeam} | {Competition} | kroam.xyz`
   - Leaderboard: `AI Model Leaderboard | Compare 35 Models | kroam.xyz`
   - Competition leaderboard: `{Competition} Leaderboard | AI Model Rankings | kroam.xyz`

2. Update `src/app/leaderboard/page.tsx`:
   - Import buildBreadcrumbSchema from lib/seo/schema/breadcrumb.ts
   - Add JSON-LD with BreadcrumbList: Home > Leaderboard
   - Check generateMetadata title is unique: `AI Model Leaderboard - Compare 35 Models | kroam.xyz`
   - Description under 155 chars: `Compare AI model accuracy across 17 football competitions. See which models predict best in Champions League, Premier League, and more.`

3. Update `src/app/models/[id]/page.tsx`:
   - Import buildBreadcrumbSchema from lib/seo/schema/breadcrumb.ts
   - Add JSON-LD with BreadcrumbList: Home > Models > {Model Name}
   - Ensure title format: `{Model Name} Predictions | AI Football Model | kroam.xyz`
   - Description: `{Model Name} football predictions and accuracy stats. See performance across competitions with Prediction Accuracy: {X}%.`
   - Include accuracy in OG description per user decision

Title uniqueness rules:
- Every page type has distinct title template
- No two pages share exact same title
- Include site name (kroam.xyz) consistently at end
- Keep under 60 chars for search display
  </action>
  <verify>
    Grep all generateMetadata for title patterns:
    `grep -rn "title:" src/app/**/page.tsx | grep -v node_modules | head -20`
    Check no duplicate patterns exist
    Verify breadcrumbs added: `grep -l "buildBreadcrumbSchema" src/app/leaderboard/page.tsx src/app/models/*/page.tsx`
  </verify>
  <done>
    All page types have unique title templates
    Titles include site name consistently
    Titles stay under 60 characters for search display
    No duplicate title patterns across site
    Leaderboard page has BreadcrumbList in JSON-LD
    Model detail pages have BreadcrumbList in JSON-LD
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. Schema files have correct exports:
   - `grep "export.*buildRoundupSchema" src/lib/seo/schema/roundup.ts`
   - `grep "SportsOrganization" src/app/leagues/*/page.tsx`
3. Breadcrumbs on all page types:
   - `grep "buildBreadcrumbSchema" src/app/leaderboard/page.tsx`
   - `grep "buildBreadcrumbSchema" src/app/models/*/page.tsx`
4. Build passes: `npm run build`
5. Unique titles audit: `grep -rhn "title:" src/app/**/page.tsx | sort | uniq -d` returns empty (no duplicates)
</verification>

<success_criteria>
- Blog roundup pages render Article + ItemList schema
- Competition pages render SportsOrganization schema
- Competition pages have complete metadata (title, description, OG tags)
- All page types have unique, descriptive titles
- Leaderboard page has BreadcrumbList schema
- Model detail pages have BreadcrumbList schema
- Meta descriptions stay under 160 characters
- Titles stay under 60 characters
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-seo-enhancement/07-02-SUMMARY.md`
</output>
