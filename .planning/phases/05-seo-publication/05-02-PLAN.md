---
phase: 05-seo-publication
plan: '02'
type: execute
wave: 2
depends_on:
  - '05-01'
files_modified:
  - src/app/matches/[id]/page.tsx
  - src/app/matches/[id]/opengraph-image.tsx
autonomous: true
user_setup: []
---

<objective>
Add SEO to match detail page at /matches/{id} with dynamic metadata, OG image, and JSON-LD structured data.

Purpose: Complete SEO-01 (dynamic meta titles/descriptions), SEO-02 (Open Graph tags and images), and SEO-03 (JSON-LD structured data) for the primary match page.

Output: Updated match page with full SEO implementation
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/05-seo-publication/05-01-SUMMARY.md
@src/app/leagues/[slug]/[match]/page.tsx
@src/lib/seo/metadata.ts
@src/lib/seo/schema/graph.ts
@src/lib/seo/og/templates.ts
</context>

<tasks>

<task type="auto">
  <name>Add dynamic metadata to match page</name>
  <files>src/app/matches/[id]/page.tsx</files>
  <action>
Update src/app/matches/[id]/page.tsx:
- Import { buildMatchMetadata } from '@/lib/seo/metadata'
- Add export async function generateMetadata({ params }: Props): Promise<Metadata>
- Inside generateMetadata: fetch match data, call buildMatchMetadata, return metadata
- Keep existing revalidate = 60 for ISR (SEO-04)
- Ensure proper params Promise unwrapping for Next.js 16
</action>
  <verify>
grep -n "generateMetadata\|buildMatchMetadata\|revalidate" src/app/matches/[id]/page.tsx | head -5
curl -s http://localhost:3000/matches/test-id 2>/dev/null | grep -o '<title>[^<]*</title>' | head -1</verify>
  <done>
Match page has dynamic metadata based on match state</done>
</task>

<task type="auto">
  <name>Create OG image for match page</name>
  <files>src/app/matches/[id]/opengraph-image.tsx</files>
  <action>
Create src/app/matches/[id]/opengraph-image.tsx:
- Export const alt = 'Match Preview'
- Export const size = { width: 1200, height: 630 }
- Export const contentType = 'image/png'
- Create default async function Image({ params }: Props) that:
  - Fetches match data
  - Gets template via getTemplateForMatch from seo/og/templates
  - Returns ImageResponse with:
    - Flex column layout with template gradient background
    - Header with competition name + status badge (LIVE/FINAL/date)
    - Center section with home team logo + name, score (if finished) or VS, away team logo + name
    - Footer with "Match Analysis & Predictions"
    - BettingSoccer branding in corner
  - Handle 3 templates (upcoming: green, live: purple, finished: blue)
</action>
  <verify>
ls -la src/app/matches/[id]/opengraph-image.tsx
cat src/app/matches/[id]/opengraph-image.tsx | grep "export const\|ImageResponse"
curl -s "http://localhost:3000/matches/test-id/opengraph-image" 2>/dev/null | head -c 100 | grep -q "PNG\|image" && echo "OG image generated" || echo "OG image not generated"</verify>
  <done>
OG image generated for match page with team logos and score</done>
</task>

<task type="auto">
  <name>Add JSON-LD structured data injection</name>
  <files>src/app/matches/[id]/page.tsx</files>
  <action>
Update src/app/matches/[id]/page.tsx:
- Import { buildMatchGraphSchema } from '@/lib/seo/schema/graph'
- In the page component (not in generateMetadata), add:
  ```tsx
  const jsonLd = buildMatchGraphSchema(match)
  return (
    <>
      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{
          __html: sanitizeJsonLd(jsonLd),
        }}
      />
      {/* existing page content */}
    </>
  )
  ```
- Place script tag before main content
- Use sanitizeJsonLd to escape < as \u003c for XSS prevention
</action>
  <verify>
grep -n "application/ld+json\|buildMatchGraphSchema\|sanitizeJsonLd" src/app/matches/[id]/page.tsx
curl -s http://localhost:3000/matches/test-id 2>/dev/null | grep -o '<script type="application/ld+json"[^>]*>[^<]*</script>' | head -1</verify>
  <done>
JSON-LD structured data present in page source with @graph</done>
</task>

</tasks>

<verification>
1. Metadata visible in page source: curl | grep -E '<title>|<meta name="description"|og:title'
2. OG image accessible: curl -I /matches/{id}/opengraph-image returns 200 with Content-Type: image/png
3. JSON-LD valid: Extract script content, validate with Schema.org validator or check structure
4. No duplicate meta tags: Page source shows single title/description
</verification>

<success_criteria>
1. Match page has unique meta title/description per match state (SEO-01)
2. OG image displays score + competition for finished matches (SEO-02)
3. JSON-LD validates with SportsEvent + Article schemas (SEO-03)
4. ISR revalidation at 60 seconds (SEO-04)
5. No conflicts with existing page functionality
</success_criteria>

<output>
After completion, create `.planning/phases/05-seo-publication/05-02-SUMMARY.md`
</output>
