# Plan 37-03: Integrate Synthetic Providers into Registry

## Frontmatter

```yaml
phase: 37
plan: 03
wave: 2
depends_on: [37-02]
files_modified:
  - src/lib/llm/index.ts (update)
autonomous: true
```

## Objective

Update the LLM provider registry (`src/lib/llm/index.ts`) to include Synthetic providers alongside Together providers.

## Context

Current registry:
- Imports only `TOGETHER_PROVIDERS`
- `ALL_PROVIDERS` array contains only Together models
- `getActiveProviders()` checks only `TOGETHER_API_KEY`

Need to:
- Import `SYNTHETIC_PROVIDERS`
- Add to `ALL_PROVIDERS`
- Update `getActiveProviders()` to check both API keys
- Update provider stats to include both

## Tasks

<task id="1">
Update `src/lib/llm/index.ts`:

1. Import `SYNTHETIC_PROVIDERS` and `SyntheticProvider` from `./providers/synthetic`
2. Update `ALL_PROVIDERS` to spread both arrays:
   ```typescript
   export const ALL_PROVIDERS: LLMProvider[] = [
     ...TOGETHER_PROVIDERS,
     ...SYNTHETIC_PROVIDERS,
   ];
   ```
3. Update `getActiveProviders()` to include Synthetic models when `SYNTHETIC_API_KEY` is set
4. Update `getProviderStats()` to count both provider types
5. Export `SYNTHETIC_PROVIDERS` and `SyntheticProvider`
</task>

## Implementation Details

```typescript
import { TOGETHER_PROVIDERS, TogetherProvider } from './providers/together';
import { SYNTHETIC_PROVIDERS, SyntheticProvider } from './providers/synthetic';

// All available providers - Together AI + Synthetic.new
export const ALL_PROVIDERS: LLMProvider[] = [
  ...TOGETHER_PROVIDERS,
  ...SYNTHETIC_PROVIDERS,
];

// Get active providers (checks API keys and filters auto-disabled)
export async function getActiveProviders(): Promise<LLMProvider[]> {
  const disabledIds = await getAutoDisabledModelIds();

  const activeProviders: LLMProvider[] = [];

  // Add Together providers if API key configured
  if (process.env.TOGETHER_API_KEY) {
    activeProviders.push(
      ...TOGETHER_PROVIDERS.filter(p => !disabledIds.has(p.id))
    );
  }

  // Add Synthetic providers if API key configured
  if (process.env.SYNTHETIC_API_KEY) {
    activeProviders.push(
      ...SYNTHETIC_PROVIDERS.filter(p => !disabledIds.has(p.id))
    );
  }

  // ... logging
  return activeProviders;
}
```

## Verification

- [ ] `SYNTHETIC_PROVIDERS` imported from `./providers/synthetic`
- [ ] `ALL_PROVIDERS` includes both Together (29) and Synthetic (14) = 43 total
- [ ] `getActiveProviders()` checks `SYNTHETIC_API_KEY` for Synthetic models
- [ ] Synthetic models only included when `SYNTHETIC_API_KEY` is set
- [ ] `getProviderStats()` counts both provider types correctly
- [ ] `SYNTHETIC_PROVIDERS` and `SyntheticProvider` exported
- [ ] TypeScript compiles without errors

## Must Haves

- MODL-04: Provider registry includes Synthetic providers alongside Together
- ERRH-01: 429 rate limit errors handled (inherits from base class)
- ERRH-03: Model failures trigger auto-disable (uses existing `getAutoDisabledModelIds`)
