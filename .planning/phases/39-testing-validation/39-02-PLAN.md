---
phase: 39-testing-validation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/llm/providers/synthetic.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "6 failing Synthetic models are disabled from production use"
    - "Model configurations remain in code for future re-testing"
    - "sync-models correctly deactivates disabled models in database"
  artifacts:
    - path: "src/lib/llm/providers/synthetic.ts"
      provides: "Synthetic provider with only 7 working models exported"
      contains: "SYNTHETIC_PROVIDERS = ["
  key_links:
    - from: "src/lib/llm/providers/synthetic.ts"
      to: "src/lib/llm/index.ts"
      via: "SYNTHETIC_PROVIDERS import"
      pattern: "import.*SYNTHETIC_PROVIDERS"
---

<objective>
Disable the 6 failing Synthetic models by removing them from the SYNTHETIC_PROVIDERS export array while keeping their definitions in code for future re-testing.

Purpose: Prevent production failures from models that cannot produce valid predictions (timeouts, parse failures, API bugs)
Output: Updated synthetic.ts with only 7 working models in SYNTHETIC_PROVIDERS export
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/39-testing-validation/39-01-SUMMARY.md
@.planning/phases/39-testing-validation/39-VERIFICATION.md

@src/lib/llm/providers/synthetic.ts
@src/lib/llm/index.ts
@src/lib/db/sync-models.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Disable failing Synthetic models</name>
  <files>src/lib/llm/providers/synthetic.ts</files>
  <action>
Modify `src/lib/llm/providers/synthetic.ts` to disable the 6 failing models:

1. **Keep all model definitions** (the const declarations) - these allow future re-testing

2. **Add DISABLED_MODELS section before SYNTHETIC_PROVIDERS export:**
   ```typescript
   // ============================================================================
   // DISABLED MODELS - Kept for future re-testing
   // These models failed validation (2026-02-04) and are excluded from production
   // To re-test: move from here back to SYNTHETIC_PROVIDERS array
   // ============================================================================
   //
   // Qwen3_235BThinking_SynProvider - Parse failure: returns natural language instead of JSON
   // DeepSeekV32_SynProvider - Parse failure: returns natural language instead of JSON
   // KimiK25_SynProvider - Timeout: 30s timeout, needs investigation
   // GLM46_SynProvider - Timeout: 30s timeout, needs investigation
   // GLM47_SynProvider - API bug: SGLang structured output not supported (Synthetic.new confirmed)
   // GPTOSS120B_SynProvider - Invalid response: returns {"type":"object"} instead of predictions
   ```

3. **Update SYNTHETIC_PROVIDERS export to include only 7 working models:**
   ```typescript
   export const SYNTHETIC_PROVIDERS = [
     // Reasoning models (2) - Premium (1 disabled: qwen3-235b-thinking)
     DeepSeekR1_0528_SynProvider,        // 1  - $3.00/$7.00 (premium, reasoning)
     KimiK2Thinking_SynProvider,         // 2  - $2.00/$6.00 (premium, reasoning)

     // DeepSeek family (2) - Budget (1 disabled: deepseek-v3.2)
     DeepSeekV3_0324_SynProvider,        // 3  - $0.60/$1.25
     DeepSeekV31_Terminus_SynProvider,   // 4  - $0.70/$1.40

     // MiniMax (2) - Budget
     MiniMaxM2_SynProvider,              // 5  - $0.50/$1.00
     MiniMaxM21_SynProvider,             // 6  - $0.55/$1.10

     // Qwen Coder (1) - Premium
     Qwen3Coder480B_SynProvider,         // 7  - $3.00/$6.00 (premium)
   ];
   ```

4. **Update the summary comment at the end of the file:**
   ```typescript
   // ============================================================================
   // Summary (February 2026):
   // - 13 Synthetic-exclusive models defined (not all available on Together AI)
   // - 7 models ACTIVE: 2 reasoning + 4 budget + 1 coder premium
   // - 6 models DISABLED: 1 reasoning (parse), 1 budget (parse), 2 timeout, 1 API bug, 1 invalid response
   // - All use hf:org/model format for Synthetic.new API
   // - Pricing: Placeholder estimates (actual pricing TBD)
   // - Disabled models kept in code for future re-testing
   // ============================================================================
   ```

**DO NOT:**
- Delete any model const declarations (keep them all)
- Modify the SyntheticProvider class itself
- Change any pricing or tier information

**WHY this approach:**
The sync-models.ts mechanism reads from `getActiveProviders()` which uses `SYNTHETIC_PROVIDERS`. By removing models from this export, they will be:
1. Not picked up by sync-models.ts
2. Marked as inactive in the database
3. Excluded from prediction cycles
But their definitions remain for easy re-enabling when issues are fixed.
  </action>
  <verify>
1. Verify TypeScript compiles: `npx tsc --noEmit`
2. Verify SYNTHETIC_PROVIDERS has exactly 7 entries:
   ```bash
   grep -A 20 "export const SYNTHETIC_PROVIDERS" src/lib/llm/providers/synthetic.ts | grep "Provider," | wc -l
   ```
   Should output: 7
3. Verify disabled models are still defined (not deleted):
   ```bash
   grep "Qwen3_235BThinking_SynProvider\|GLM47_SynProvider" src/lib/llm/providers/synthetic.ts
   ```
   Should show the const declarations still exist
  </verify>
  <done>
- src/lib/llm/providers/synthetic.ts modified
- SYNTHETIC_PROVIDERS exports exactly 7 working models
- 6 disabled models documented in code with reasons
- All 13 model definitions still present in file
- TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Run sync-models to deactivate disabled models in database</name>
  <files></files>
  <action>
Run the sync-models script to update the database with the new model configuration.

The sync-models mechanism will:
1. See only 7 Synthetic models from `getActiveProviders()`
2. Mark the 6 removed models as `active: false` in database
3. Preserve their historical prediction data

**Steps:**

1. **Run sync-models manually** (if available as standalone script):
   ```bash
   npx tsx scripts/sync-models.ts
   ```

   OR if it only runs on server startup:

2. **Restart the development server:**
   ```bash
   # Kill existing server if running, then start fresh
   npm run dev
   ```
   This triggers `syncModelsToDatabase()` on startup.

3. **Verify database state** (optional, if database access available):
   - 6 Synthetic models should have `active: false`
   - 7 Synthetic models should have `active: true`

**Expected output from sync:**
```
[model-sync] Sync completed: added=0, updated=7, deactivated=6, totalActive=36
```
(Numbers may vary based on Together AI model count)
  </action>
  <verify>
1. Sync script ran without errors
2. Log output shows deactivated models (6 expected from Synthetic)
3. Application starts without errors
  </verify>
  <done>
- Sync script executed successfully
- 6 Synthetic models deactivated in database
- 7 Synthetic models remain active
- No runtime errors on server startup
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes without errors
2. SYNTHETIC_PROVIDERS array contains exactly 7 models
3. All 13 model definitions still exist in code (grep for each provider const)
4. Sync-models deactivates the 6 disabled models
5. Server starts without errors
</verification>

<success_criteria>
1. 6 failing Synthetic models excluded from SYNTHETIC_PROVIDERS export
2. Model definitions preserved in code for future re-testing
3. Disabled models documented with specific failure reasons
4. Database sync marks disabled models as inactive
5. Application continues to function with 7 working Synthetic models
</success_criteria>

<output>
After completion, create `.planning/phases/39-testing-validation/39-02-SUMMARY.md`
</output>
