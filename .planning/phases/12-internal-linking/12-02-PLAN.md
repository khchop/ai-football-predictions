---
phase: 12-internal-linking
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/competition/recent-predictions-widget.tsx
  - src/app/leagues/[slug]/league-hub-content.tsx
autonomous: true

must_haves:
  truths:
    - "Competition hub pages display recent 5 match predictions with links"
    - "Widget shows match details (teams, date, score if finished)"
    - "All links use descriptive anchor text ({homeTeam} vs {awayTeam})"
    - "Widget renders server-side (crawlable by search engines)"
  artifacts:
    - path: "src/components/competition/recent-predictions-widget.tsx"
      provides: "Server component for recent predictions"
      exports: ["RecentPredictionsWidget"]
    - path: "src/app/leagues/[slug]/league-hub-content.tsx"
      provides: "Integration point for widget"
      contains: "RecentPredictionsWidget"
  key_links:
    - from: "src/app/leagues/[slug]/league-hub-content.tsx"
      to: "RecentPredictionsWidget"
      via: "import and render"
      pattern: "RecentPredictionsWidget"
    - from: "RecentPredictionsWidget"
      to: "/leagues/{slug}/{match}"
      via: "Next.js Link"
      pattern: "href=.*leagues"
---

<objective>
Add recent predictions widget to competition hub pages for SEO internal linking.

Purpose: Increase hub page freshness, provide discovery paths to match detail pages, reduce orphan page count (addresses SEO-T13).
Output: New RecentPredictionsWidget server component integrated into league hub content.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-internal-linking/12-RESEARCH.md

# Source files to modify
@src/app/leagues/[slug]/league-hub-content.tsx
@src/lib/db/queries.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RecentPredictionsWidget component</name>
  <files>src/components/competition/recent-predictions-widget.tsx</files>
  <action>
Create src/components/competition/recent-predictions-widget.tsx as a React Server Component:

```typescript
import Link from 'next/link';
import { format, parseISO } from 'date-fns';
import { getMatchesByCompetitionId } from '@/lib/db/queries';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { TrendingUp, Calendar } from 'lucide-react';

interface RecentPredictionsWidgetProps {
  competitionId: string;
}

export async function RecentPredictionsWidget({ competitionId }: RecentPredictionsWidgetProps) {
  // Get recent 5 matches - reuse existing query
  const matchesData = await getMatchesByCompetitionId(competitionId, 5);

  if (matchesData.length === 0) return null;

  return (
    <Card className="bg-card/50 border-border/50">
      <CardHeader>
        <CardTitle className="text-lg flex items-center gap-2">
          <TrendingUp className="h-5 w-5 text-primary" />
          Recent Predictions
        </CardTitle>
      </CardHeader>
      <CardContent>
        <div className="space-y-3">
          {matchesData.map(({ match, competition }) => {
            const kickoff = parseISO(match.kickoffTime);
            const matchUrl = match.slug
              ? `/leagues/${competition.slug || competition.id}/${match.slug}`
              : `/matches/${match.id}`;

            return (
              <Link
                key={match.id}
                href={matchUrl}
                className="block p-3 rounded-lg border border-border/50 hover:bg-accent transition-colors"
              >
                <div className="flex items-start justify-between gap-2">
                  <div className="flex-1 min-w-0">
                    <p className="font-medium text-sm leading-tight">
                      {match.homeTeam} vs {match.awayTeam}
                    </p>
                    <div className="flex items-center gap-1 text-xs text-muted-foreground mt-1">
                      <Calendar className="h-3 w-3" />
                      {format(kickoff, 'MMM d, yyyy')}
                    </div>
                  </div>
                  {match.status === 'finished' && match.homeScore !== null && match.awayScore !== null && (
                    <div className="text-right flex-shrink-0">
                      <p className="text-sm font-mono font-bold">
                        {match.homeScore}-{match.awayScore}
                      </p>
                      <p className="text-xs text-muted-foreground">Final</p>
                    </div>
                  )}
                  {match.status === 'scheduled' && (
                    <div className="text-right flex-shrink-0">
                      <p className="text-xs text-muted-foreground">
                        {format(kickoff, 'HH:mm')}
                      </p>
                    </div>
                  )}
                  {match.status === 'live' && (
                    <div className="text-right flex-shrink-0">
                      <span className="px-2 py-0.5 rounded-full text-xs font-semibold bg-red-500/20 text-red-400">
                        LIVE
                      </span>
                    </div>
                  )}
                </div>
              </Link>
            );
          })}
        </div>
      </CardContent>
    </Card>
  );
}
```

Key design decisions:
- Reuse existing `getMatchesByCompetitionId` query (no new query needed)
- Show match status (finished with score, scheduled with time, live badge)
- Use descriptive anchor text: "{homeTeam} vs {awayTeam}"
- Follow existing Card component styling patterns
- Server component for SEO crawlability
  </action>
  <verify>
TypeScript compiles without errors:
```bash
npx tsc --noEmit
```
  </verify>
  <done>
- RecentPredictionsWidget component created as RSC
- Uses existing getMatchesByCompetitionId query
- Shows match status (score, time, or LIVE badge)
- Uses descriptive anchor text
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate widget into league hub content</name>
  <files>src/app/leagues/[slug]/league-hub-content.tsx</files>
  <action>
Modify src/app/leagues/[slug]/league-hub-content.tsx to include the RecentPredictionsWidget:

1. Add import at top (after existing competition component imports):
   ```typescript
   import { RecentPredictionsWidget } from '@/components/competition/recent-predictions-widget';
   ```

2. Find the LeagueHubContent component's return statement and add the widget.

   The component structure shows: header, tabs (matches/standings), competition stats, top models.

   Add the RecentPredictionsWidget in a sidebar layout alongside CompetitionTopModels.

   Look for where CompetitionTopModels is rendered and create a two-column grid:

   ```typescript
   {/* Stats and Widgets Grid */}
   <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
     <Suspense fallback={<Skeleton className="h-[300px]" />}>
       <CompetitionTopModels competitionId={competitionId} />
     </Suspense>
     <Suspense fallback={<Skeleton className="h-[300px]" />}>
       <RecentPredictionsWidget competitionId={competitionId} />
     </Suspense>
   </div>
   ```

   If CompetitionTopModels is already in a specific layout, add RecentPredictionsWidget next to it in a grid.
   If there's no grid structure, wrap both components in a responsive grid.

3. Ensure Suspense boundaries are in place for loading states.

The widget placement should be:
- After the main matches/standings tabs
- Alongside or near CompetitionTopModels for consistent layout
- Visible without scrolling too far (within first viewport on desktop)
  </action>
  <verify>
1. Build succeeds: `npm run build`
2. Visit a competition page (e.g., /leagues/premier-league) and verify:
   - Recent Predictions widget appears
   - Shows up to 5 recent matches
   - Links work and use descriptive anchor text
   - Widget renders in page source (not client-side only)
  </verify>
  <done>
- RecentPredictionsWidget integrated into league hub content
- Widget shows recent 5 matches with links
- Proper Suspense boundary for loading state
- Widget is server-rendered (visible in page source)
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` succeeds without errors
2. Competition hub pages show "Recent Predictions" widget
3. Widget displays 5 recent matches with team names, dates, and scores
4. All links use descriptive anchor text ("{team} vs {team}")
5. View page source confirms widget renders server-side
6. No console errors in browser
</verification>

<success_criteria>
- [ ] RecentPredictionsWidget component created as RSC
- [ ] Widget integrated into league hub content
- [ ] Shows 5 recent matches with status indicators
- [ ] Links use descriptive anchor text
- [ ] Widget is server-rendered (crawlable)
- [ ] SEO-T13 requirement satisfied (recent predictions widget)
</success_criteria>

<output>
After completion, create `.planning/phases/12-internal-linking/12-02-SUMMARY.md`
</output>
