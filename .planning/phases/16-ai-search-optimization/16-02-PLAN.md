---
phase: 16-ai-search-optimization
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/MatchPageSchema.tsx
  - src/lib/seo/schema/webpage.ts
autonomous: true

must_haves:
  truths:
    - "Schema component renders single JSON-LD script tag"
    - "JSON-LD contains @graph array with multiple entities"
    - "SportsEvent, WebPage, and BreadcrumbList are in same @graph"
    - "Organization entity is referenced by other entities via @id"
  artifacts:
    - path: "src/components/MatchPageSchema.tsx"
      provides: "Consolidated @graph schema component"
      min_lines: 80
    - path: "src/lib/seo/schema/webpage.ts"
      provides: "WebPage schema builder function"
      exports: ["buildWebPageSchema"]
  key_links:
    - from: "MatchPageSchema.tsx"
      to: "schema builders"
      via: "imports buildSportsEventSchema, buildWebPageSchema, buildBreadcrumbSchema"
      pattern: "import.*from.*seo/schema"
    - from: "@graph array"
      to: "entities"
      via: "@id cross-references"
      pattern: "@id.*#organization|@id.*#webpage"
---

<objective>
Create a consolidated Schema.org JSON-LD graph component for match pages that combines SportsEvent, WebPage, and BreadcrumbList into a single @graph array.

Purpose: Eliminate multiple JSON-LD script tags (which cause validation warnings) and establish proper entity relationships via @id cross-references for better rich result eligibility.

Output: New MatchPageSchema component and WebPage schema builder that produce a single consolidated @graph.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/16-ai-search-optimization/16-RESEARCH.md
@src/lib/seo/schema/graph.ts
@src/lib/seo/schema/sports-event.ts
@src/lib/seo/schema/breadcrumb.ts
@src/components/SportsEventSchema.tsx
@src/components/WebPageSchema.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WebPage schema builder function</name>
  <files>src/lib/seo/schema/webpage.ts</files>
  <action>
Create a new WebPage schema builder function in src/lib/seo/schema/webpage.ts:

```typescript
interface WebPageSchemaOptions {
  url: string;
  name: string;
  description: string;
  datePublished?: string;
  dateModified?: string;
}

export function buildWebPageSchema(options: WebPageSchemaOptions): object {
  return {
    '@type': 'WebPage',
    '@id': `${options.url}#webpage`,
    url: options.url,
    name: options.name,
    description: options.description,
    isPartOf: { '@id': 'https://kroam.xyz#website' },
    about: { '@id': options.url }, // Reference to SportsEvent
    ...(options.datePublished && { datePublished: options.datePublished }),
    ...(options.dateModified && { dateModified: options.dateModified }),
  };
}
```

Key design decisions:
- Use `@id` with URL fragment (#webpage) for cross-referencing
- Reference Website via `isPartOf` with @id
- Reference SportsEvent via `about` with @id (the match URL serves as SportsEvent @id)
- Spread operator for optional date fields to keep schema clean
  </action>
  <verify>
File exists at src/lib/seo/schema/webpage.ts with:
- Exported buildWebPageSchema function
- Returns object with @type: 'WebPage'
- Includes @id for cross-referencing
- Includes isPartOf and about references
  </verify>
  <done>
WebPage schema builder function created with @id cross-references for graph integration.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create consolidated MatchPageSchema component</name>
  <files>src/components/MatchPageSchema.tsx</files>
  <action>
Create new src/components/MatchPageSchema.tsx that produces a single JSON-LD @graph:

```typescript
import type { Match } from '@/lib/db/schema';

interface MatchPageSchemaProps {
  match: Match;
  competition: {
    name: string;
    slug: string;
  };
  url: string;
}

export function MatchPageSchema({ match, competition, url }: MatchPageSchemaProps) {
  // Map match status to Schema.org EventStatus
  const eventStatus = match.status === 'finished'
    ? 'https://schema.org/EventCompleted'
    : match.status === 'live'
    ? 'https://schema.org/EventInProgress'
    : 'https://schema.org/EventScheduled';

  const matchName = `${match.homeTeam} vs ${match.awayTeam}`;
  const pageDescription = `AI predictions for ${matchName} (${competition.name}). Compare forecasts from 35+ AI models.`;

  const graph = {
    '@context': 'https://schema.org',
    '@graph': [
      // Organization (root entity, referenced by others)
      {
        '@type': 'Organization',
        '@id': 'https://kroam.xyz#organization',
        name: 'kroam.xyz',
        url: 'https://kroam.xyz',
        logo: 'https://kroam.xyz/logo.png',
      },
      // Website (referenced by WebPage)
      {
        '@type': 'WebSite',
        '@id': 'https://kroam.xyz#website',
        name: 'kroam.xyz',
        url: 'https://kroam.xyz',
        publisher: { '@id': 'https://kroam.xyz#organization' },
      },
      // SportsEvent (the match)
      {
        '@type': 'SportsEvent',
        '@id': url,
        name: matchName,
        startDate: match.kickoffTime,
        eventStatus,
        location: {
          '@type': 'Place',
          name: match.venue || 'Stadium',
        },
        homeTeam: {
          '@type': 'SportsTeam',
          name: match.homeTeam,
          ...(match.homeTeamLogo && { logo: match.homeTeamLogo }),
        },
        awayTeam: {
          '@type': 'SportsTeam',
          name: match.awayTeam,
          ...(match.awayTeamLogo && { logo: match.awayTeamLogo }),
        },
        sport: 'Football',
        ...(match.status === 'finished' && match.homeScore !== null && match.awayScore !== null && {
          homeTeamScore: match.homeScore,
          awayTeamScore: match.awayScore,
        }),
      },
      // WebPage (references SportsEvent and Website)
      {
        '@type': 'WebPage',
        '@id': `${url}#webpage`,
        url,
        name: `${matchName} Prediction`,
        description: pageDescription,
        isPartOf: { '@id': 'https://kroam.xyz#website' },
        about: { '@id': url },
      },
      // BreadcrumbList
      {
        '@type': 'BreadcrumbList',
        itemListElement: [
          { '@type': 'ListItem', position: 1, name: 'Home', item: 'https://kroam.xyz' },
          { '@type': 'ListItem', position: 2, name: 'Leagues', item: 'https://kroam.xyz/leagues' },
          { '@type': 'ListItem', position: 3, name: competition.name, item: `https://kroam.xyz/leagues/${competition.slug}` },
          { '@type': 'ListItem', position: 4, name: matchName, item: url },
        ],
      },
    ],
  };

  return (
    <script
      type="application/ld+json"
      dangerouslySetInnerHTML={{ __html: JSON.stringify(graph) }}
    />
  );
}
```

Key design decisions:
- Single script tag output (not multiple separate ones)
- All entities in @graph array for proper relationships
- @id cross-references between entities (WebPage -> Website -> Organization)
- Conditional fields via spread operator (scores only if finished, logos only if present)
- BreadcrumbList inline since it's page-specific
- TypeScript types imported from db/schema for Match type
  </action>
  <verify>
File exists at src/components/MatchPageSchema.tsx with:
- Single `<script type="application/ld+json">` output
- @graph array containing Organization, WebSite, SportsEvent, WebPage, BreadcrumbList
- @id cross-references between entities
- Correct eventStatus mapping from match.status
  </verify>
  <done>
MatchPageSchema component created producing single consolidated @graph with 5 entities and proper cross-references.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without TypeScript errors
2. MatchPageSchema.tsx produces valid JSON-LD structure
3. @graph array contains all required entities
4. @id references are correctly formatted
</verification>

<success_criteria>
- [ ] src/lib/seo/schema/webpage.ts exists with buildWebPageSchema export
- [ ] src/components/MatchPageSchema.tsx exists and exports MatchPageSchema
- [ ] Component renders single script tag with @graph array
- [ ] @graph contains Organization, WebSite, SportsEvent, WebPage, BreadcrumbList
- [ ] Cross-references use @id pattern correctly
- [ ] Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/16-ai-search-optimization/16-02-SUMMARY.md`
</output>
