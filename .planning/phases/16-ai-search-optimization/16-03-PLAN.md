---
phase: 16-ai-search-optimization
plan: 03
type: execute
wave: 2
depends_on: [16-02]
files_modified:
  - src/app/leagues/[slug]/[match]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Match page renders single JSON-LD script tag"
    - "View Source shows AI-generated content (not hidden behind JS)"
    - "Schema.org validator shows zero errors for match page"
    - "SportsEventSchema and WebPageSchema components removed from page"
  artifacts:
    - path: "src/app/leagues/[slug]/[match]/page.tsx"
      provides: "Match page with consolidated schema"
      contains: "MatchPageSchema"
  key_links:
    - from: "page.tsx"
      to: "MatchPageSchema"
      via: "import and render"
      pattern: "import.*MatchPageSchema.*from"
---

<objective>
Integrate the consolidated MatchPageSchema component into the match page and verify AI-generated content renders server-side.

Purpose: Replace separate SportsEventSchema + WebPageSchema components with single consolidated @graph schema, completing SRCH-03. Verify SRCH-04 (SSR content) is already working.

Output: Updated match page with consolidated schema and verification that AI content is visible in View Source.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/16-ai-search-optimization/16-RESEARCH.md
@.planning/phases/16-ai-search-optimization/16-02-SUMMARY.md
@src/app/leagues/[slug]/[match]/page.tsx
@src/components/MatchPageSchema.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace separate schema components with consolidated MatchPageSchema</name>
  <files>src/app/leagues/[slug]/[match]/page.tsx</files>
  <action>
Update src/app/leagues/[slug]/[match]/page.tsx:

1. Remove imports:
   - Remove: `import { SportsEventSchema } from '@/components/SportsEventSchema';`
   - Remove: `import { WebPageSchema } from '@/components/WebPageSchema';`

2. Add import:
   - Add: `import { MatchPageSchema } from '@/components/MatchPageSchema';`

3. Replace component usage in JSX:
   - Remove: `<SportsEventSchema match={matchData} />`
   - Remove: `<WebPageSchema ... />` (the entire component with all its props)
   - Add in their place (near top of return, before MatchH1):
   ```tsx
   <MatchPageSchema
     match={matchData}
     competition={{ name: competition.name, slug: competitionSlug }}
     url={`https://kroam.xyz/leagues/${competitionSlug}/${matchData.slug}`}
   />
   ```

The new component produces a single script tag with the consolidated @graph, replacing the two separate script tags from SportsEventSchema and WebPageSchema.

Keep all other page content unchanged - the MatchContentSection, RoundupViewer, and other components already render server-side.
  </action>
  <verify>
1. Build: `npm run build` succeeds
2. View page source (dev or prod): Only ONE `<script type="application/ld+json">` tag exists
3. The script tag contains `"@graph":[` array structure
4. No TypeScript errors about missing imports
  </verify>
  <done>
Match page uses single MatchPageSchema component. Separate SportsEventSchema and WebPageSchema imports and usages removed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify AI-generated content renders server-side</name>
  <files>src/app/leagues/[slug]/[match]/page.tsx</files>
  <action>
Verify SRCH-04 requirement (AI content visible to crawlers) is met:

1. Review MatchContentSection component usage:
   - Confirm it's an async server component (no 'use client')
   - Confirm it fetches data via `getMatchContent()` server-side
   - Confirm it renders pre-match, betting, and post-match content directly in JSX

2. Review RoundupViewer component:
   - Check if it's a server component or client component
   - If client component, verify the roundup data is passed as props from server (which means it's pre-rendered)

3. Create verification steps documentation in the SUMMARY file noting:
   - Which components render AI content
   - Whether they're server or client components
   - What content is visible in View Source

Based on Phase 13 work (MatchContentSection is async server component), SRCH-04 should already be satisfied. This task is verification + documentation, not implementation.

If any issues found (unlikely), create a note for follow-up but do not attempt fixes in this plan.
  </action>
  <verify>
Manual verification steps:
1. Start dev server: `npm run dev`
2. Navigate to a finished match page: `/leagues/premier-league/{recent-match-slug}`
3. View Page Source (Ctrl+U / Cmd+Option+U)
4. Search for "Match Report" or "Market Expectations" text
5. Confirm AI-generated narrative text appears in HTML source (not just rendered DOM)

If text appears in View Source: SRCH-04 is satisfied.
If text does NOT appear: Document as gap for follow-up.
  </verify>
  <done>
AI-generated content (pre-match, post-match narratives from MatchContentSection) confirmed visible in View Source HTML, satisfying SRCH-04 requirement for AI crawler indexing.
  </done>
</task>

<task type="auto">
  <name>Task 3: Validate Schema.org structured data</name>
  <files>N/A - validation task</files>
  <action>
Validate the consolidated schema produces valid Schema.org output:

1. Build and run the site locally or on preview deployment
2. Copy the JSON-LD content from a match page's View Source
3. Validate using one of:
   - https://validator.schema.org/ (paste JSON-LD)
   - https://search.google.com/test/rich-results (enter page URL if deployed)

4. Document validation results:
   - Number of detected entities (expect 5: Organization, WebSite, SportsEvent, WebPage, BreadcrumbList)
   - Any errors (should be 0)
   - Any warnings (document if present, not blockers)

5. If validation shows errors:
   - Document specific error messages
   - Create fix if simple (missing required field)
   - Note for follow-up if complex

Common issues to watch for:
- Missing required fields on SportsEvent (name, startDate - should be present)
- Invalid URL formats in @id references
- Incorrect eventStatus enum values
  </action>
  <verify>
Schema.org validator or Google Rich Results Test shows:
- 5 entities detected in @graph
- 0 errors
- SportsEvent eligible for rich results (if using Google tool)
  </verify>
  <done>
Schema.org validator confirms zero errors. @graph contains 5 properly structured entities. SportsEvent recognized for potential rich results.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Match page has single JSON-LD script tag with @graph
3. View Source shows AI-generated content (not client-only)
4. Schema.org validator shows zero errors
</verification>

<success_criteria>
- [ ] SportsEventSchema and WebPageSchema removed from match page imports
- [ ] MatchPageSchema component used instead
- [ ] Single JSON-LD script tag in page source
- [ ] @graph array contains all 5 entity types
- [ ] AI-generated content visible in View Source HTML
- [ ] Schema.org validator shows zero errors
- [ ] Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/16-ai-search-optimization/16-03-SUMMARY.md`
</output>
