---
phase: 30-layout-assembly
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/match/skeletons/hero-skeleton.tsx
  - src/components/match/skeletons/narrative-skeleton.tsx
  - src/components/match/skeletons/full-layout-skeleton.tsx
  - src/app/leagues/[slug]/[match]/loading.tsx
  - src/app/leagues/[slug]/[match]/error.tsx
autonomous: true

must_haves:
  truths:
    - "Full-page skeleton matches final layout structure"
    - "Loading.tsx provides fallback during page load"
    - "Error.tsx provides retry button for failed loads"
    - "Skeleton dimensions prevent layout shift"
  artifacts:
    - path: "src/components/match/skeletons/hero-skeleton.tsx"
      provides: "Hero section skeleton"
      exports: ["HeroSkeleton"]
    - path: "src/components/match/skeletons/narrative-skeleton.tsx"
      provides: "Narrative section skeleton"
      exports: ["NarrativeSkeleton"]
    - path: "src/components/match/skeletons/full-layout-skeleton.tsx"
      provides: "Complete page skeleton"
      exports: ["FullLayoutSkeleton"]
    - path: "src/app/leagues/[slug]/[match]/loading.tsx"
      provides: "Route-level loading state"
      exports: ["default"]
    - path: "src/app/leagues/[slug]/[match]/error.tsx"
      provides: "Route-level error boundary"
      exports: ["default"]
  key_links:
    - from: "src/app/leagues/[slug]/[match]/loading.tsx"
      to: "FullLayoutSkeleton"
      via: "Component import"
      pattern: "import.*FullLayoutSkeleton"
---

<objective>
Create loading skeleton components and error boundary for match pages.

Purpose: Provide visual feedback during page load with skeletons that exactly match final layout dimensions (preventing layout shift), plus error recovery via retry button.
Output: Skeleton components for Hero, Narrative, and full page layout, plus loading.tsx and error.tsx for route-level handling.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/30-layout-assembly/30-CONTEXT.md
@.planning/phases/30-layout-assembly/30-RESEARCH.md
@src/components/match/match-hero.tsx
@src/components/match/match-narrative.tsx
@src/components/match/predictions-skeleton.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create skeleton components</name>
  <files>
    src/components/match/skeletons/hero-skeleton.tsx
    src/components/match/skeletons/narrative-skeleton.tsx
    src/components/match/skeletons/full-layout-skeleton.tsx
  </files>
  <action>
Create skeleton components that EXACTLY match final component dimensions. Reference existing match-hero.tsx and match-narrative.tsx for sizing.

1. **Create directory**: `src/components/match/skeletons/`

2. **HeroSkeleton** (hero-skeleton.tsx):
   Copy structure from match-hero.tsx, replace content with Skeleton elements:
   ```tsx
   // Use existing Skeleton component from ui/skeleton.tsx
   import { Skeleton } from '@/components/ui/skeleton';

   export function HeroSkeleton() {
     return (
       <section className="bg-card border-border border rounded-xl p-6 md:p-8">
         {/* Teams + Score/VS row */}
         <div className="flex items-center justify-between gap-4 md:gap-8">
           {/* Home team placeholder */}
           <div className="flex-1 text-center">
             <Skeleton className="h-20 w-20 md:h-24 md:w-24 mx-auto mb-3 rounded-xl" />
             <Skeleton className="h-6 w-24 mx-auto" />
           </div>

           {/* VS/Score placeholder */}
           <Skeleton className="h-16 w-20" />

           {/* Away team placeholder */}
           <div className="flex-1 text-center">
             <Skeleton className="h-20 w-20 md:h-24 md:w-24 mx-auto mb-3 rounded-xl" />
             <Skeleton className="h-6 w-24 mx-auto" />
           </div>
         </div>

         {/* Meta row placeholder */}
         <div className="flex flex-wrap items-center justify-center gap-3 mt-6 pt-6 border-t border-border/50">
           <Skeleton className="h-4 w-32" />
           <Skeleton className="h-4 w-24" />
           <Skeleton className="h-6 w-16 rounded-full" />
         </div>
       </section>
     );
   }
   ```

3. **NarrativeSkeleton** (narrative-skeleton.tsx):
   Match Card + CardContent structure from match-narrative.tsx:
   ```tsx
   import { Skeleton } from '@/components/ui/skeleton';
   import { Card, CardContent } from '@/components/ui/card';

   export function NarrativeSkeleton() {
     return (
       <Card className="bg-card/50 border-border/50">
         <CardContent className="p-6">
           <Skeleton className="h-6 w-40 mb-4" />
           <div className="space-y-3">
             <Skeleton className="h-4 w-full" />
             <Skeleton className="h-4 w-full" />
             <Skeleton className="h-4 w-3/4" />
           </div>
         </CardContent>
       </Card>
     );
   }
   ```

4. **FullLayoutSkeleton** (full-layout-skeleton.tsx):
   Compose all section skeletons matching MatchLayout structure:
   ```tsx
   import { HeroSkeleton } from './hero-skeleton';
   import { NarrativeSkeleton } from './narrative-skeleton';
   import { PredictionsSkeleton } from '../predictions-skeleton';
   import { Skeleton } from '@/components/ui/skeleton';

   export function FullLayoutSkeleton() {
     return (
       <div className="max-w-[1200px] mx-auto space-y-8 md:space-y-12">
         <HeroSkeleton />

         {/* Narrative section */}
         <section>
           <Skeleton className="h-8 w-40 mb-6" />
           <NarrativeSkeleton />
         </section>

         {/* Predictions section */}
         <section>
           <Skeleton className="h-8 w-32 mb-6" />
           <PredictionsSkeleton />
         </section>

         {/* FAQ section */}
         <section className="mt-16 pt-8 border-t border-border/50">
           <Skeleton className="h-8 w-64 mb-6" />
           <div className="space-y-4">
             {Array.from({ length: 5 }).map((_, i) => (
               <Skeleton key={i} className="h-14 w-full rounded-lg" />
             ))}
           </div>
         </section>
       </div>
     );
   }
   ```

5. **Create barrel export** (index.ts in skeletons/):
   ```tsx
   export { HeroSkeleton } from './hero-skeleton';
   export { NarrativeSkeleton } from './narrative-skeleton';
   export { FullLayoutSkeleton } from './full-layout-skeleton';
   ```
  </action>
  <verify>
1. TypeScript compiles: `npx tsc --noEmit`
2. All skeleton files exist: `ls src/components/match/skeletons/`
3. Exports are correct: `grep -n "export function" src/components/match/skeletons/*.tsx`
  </verify>
  <done>
Three skeleton components created:
- HeroSkeleton matches MatchHero dimensions
- NarrativeSkeleton matches MatchNarrative dimensions
- FullLayoutSkeleton composes all sections
  </done>
</task>

<task type="auto">
  <name>Task 2: Create loading.tsx and error.tsx</name>
  <files>
    src/app/leagues/[slug]/[match]/loading.tsx
    src/app/leagues/[slug]/[match]/error.tsx
  </files>
  <action>
Create route-level loading and error handling following Next.js conventions.

1. **loading.tsx** - Full page skeleton during route transitions:
   ```tsx
   import { FullLayoutSkeleton } from '@/components/match/skeletons';

   export default function Loading() {
     return (
       <div className="max-w-4xl mx-auto py-8">
         <FullLayoutSkeleton />
       </div>
     );
   }
   ```

2. **error.tsx** - Error boundary with retry per CONTEXT.md:
   ```tsx
   'use client';

   import { AlertCircle, RefreshCw } from 'lucide-react';
   import { Button } from '@/components/ui/button';

   export default function Error({
     error,
     reset,
   }: {
     error: Error & { digest?: string };
     reset: () => void;
   }) {
     return (
       <div className="max-w-4xl mx-auto py-16 px-4">
         <div className="text-center space-y-6">
           <AlertCircle className="h-16 w-16 text-destructive mx-auto" />

           <div className="space-y-2">
             <h2 className="text-2xl font-bold">Something went wrong</h2>
             <p className="text-muted-foreground max-w-md mx-auto">
               {error.message || 'Failed to load match data. Please try again.'}
             </p>
           </div>

           <Button onClick={reset} variant="outline" className="gap-2">
             <RefreshCw className="h-4 w-4" />
             Try again
           </Button>
         </div>
       </div>
     );
   }
   ```
  </action>
  <verify>
1. TypeScript compiles: `npx tsc --noEmit`
2. Loading exists: `ls src/app/leagues/[slug]/[match]/loading.tsx`
3. Error exists and has 'use client': `head -1 src/app/leagues/[slug]/[match]/error.tsx`
4. Error has reset function: `grep -n "reset()" src/app/leagues/[slug]/[match]/error.tsx`
  </verify>
  <done>
- loading.tsx renders FullLayoutSkeleton during route load
- error.tsx displays error message with retry button
- Both follow Next.js conventions for route-level handling
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` - TypeScript compiles without errors
2. All skeleton files import correctly
3. loading.tsx and error.tsx are in correct location
</verification>

<success_criteria>
- [ ] HeroSkeleton, NarrativeSkeleton, FullLayoutSkeleton created
- [ ] Skeleton dimensions match final component dimensions
- [ ] loading.tsx uses FullLayoutSkeleton
- [ ] error.tsx has retry button using reset()
- [ ] error.tsx has 'use client' directive
- [ ] TypeScript compiles
</success_criteria>

<output>
After completion, create `.planning/phases/30-layout-assembly/30-02-SUMMARY.md`
</output>
