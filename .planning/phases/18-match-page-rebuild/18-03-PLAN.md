---
phase: 18-match-page-rebuild
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - next.config.ts
  - src/app/globals.css
  - src/components/match/predictions-skeleton.tsx
autonomous: true

must_haves:
  truths:
    - "Static shell renders immediately (hero, navigation visible)"
    - "Dynamic content streams in with shimmer skeleton"
    - "Skeleton matches prediction table visual structure"
  artifacts:
    - path: "next.config.ts"
      provides: "PPR enabled via cacheComponents: true"
      contains: "cacheComponents: true"
    - path: "src/app/globals.css"
      provides: "Shimmer animation CSS"
      contains: "@keyframes shimmer"
    - path: "src/components/match/predictions-skeleton.tsx"
      provides: "Enhanced shimmer skeleton"
      exports: ["PredictionsSkeleton"]
  key_links:
    - from: "src/app/leagues/[slug]/[match]/page.tsx"
      to: "src/components/match/predictions-skeleton.tsx"
      via: "Suspense fallback"
      pattern: "Suspense.*fallback.*PredictionsSkeleton"
---

<objective>
Enable PPR infrastructure with shimmer skeletons for streaming dynamic content

Purpose: Requirement MTCH-05 - User experiences fast initial load with static shell while dynamic content streams in. Next.js 16 Cache Components enables PPR; shimmer skeletons provide visual feedback during streaming.

Output: cacheComponents enabled in next.config.ts, shimmer animation CSS, enhanced PredictionsSkeleton matching table structure
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-match-page-rebuild/18-CONTEXT.md
@.planning/phases/18-match-page-rebuild/18-RESEARCH.md
@next.config.ts
@src/app/globals.css
@src/components/match/predictions-skeleton.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enable PPR via cacheComponents in Next.js config</name>
  <files>next.config.ts</files>
  <action>
Update next.config.ts to enable Partial Prerendering:

Add `cacheComponents: true` to the NextConfig. This is the Next.js 16 way to enable PPR (replaces experimental.ppr from earlier versions).

Current config likely has:
```ts
const nextConfig: NextConfig = {
  experimental: {
    viewTransition: true,  // Added in Phase 17
  },
  // ... other config
}
```

Update to:
```ts
const nextConfig: NextConfig = {
  cacheComponents: true,  // Enable PPR for static shell + dynamic streaming
  experimental: {
    viewTransition: true,  // Already enabled
  },
  // ... rest of existing config unchanged
}
```

Important:
- Place cacheComponents at top level (not inside experimental)
- Keep all existing configuration (images, redirects, etc.)
- This enables automatic static/dynamic split based on Suspense boundaries
  </action>
  <verify>`grep "cacheComponents.*true" next.config.ts` returns match</verify>
  <done>PPR enabled via cacheComponents: true in next.config.ts</done>
</task>

<task type="auto">
  <name>Task 2: Add shimmer animation CSS with dark mode and reduced motion support</name>
  <files>src/app/globals.css</files>
  <action>
Add shimmer animation CSS after existing animations (after view-transition keyframes from Phase 17):

```css
/* Shimmer Loading Animation */
@keyframes shimmer {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

.skeleton-wrapper {
  position: relative;
  overflow: hidden;
}

.shimmer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    oklch(1 0 0 / 0.1),
    transparent
  );
  animation: shimmer 2s infinite;
}

/* Dark mode shimmer - more subtle */
:root.dark .shimmer {
  background: linear-gradient(
    90deg,
    transparent,
    oklch(1 0 0 / 0.05),
    transparent
  );
}

/* Respect reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  .shimmer {
    animation: none !important;
  }
}
```

Notes:
- Uses OKLCH colors for consistency with Phase 17 design tokens
- Dark mode uses more subtle gradient (0.05 vs 0.1 opacity)
- Reduced motion disables animation entirely (Phase 17 pattern)
- 2s animation duration for smooth, non-distracting effect
  </action>
  <verify>`grep -A5 "@keyframes shimmer" src/app/globals.css` shows shimmer animation</verify>
  <done>Shimmer CSS added with dark mode and reduced motion support</done>
</task>

<task type="auto">
  <name>Task 3: Enhance PredictionsSkeleton with shimmer animation matching table structure</name>
  <files>src/components/match/predictions-skeleton.tsx</files>
  <action>
Update the existing PredictionsSkeleton to use shimmer animation and match prediction table structure:

```tsx
export function PredictionsSkeleton() {
  return (
    <div className="space-y-3">
      {/* Header skeleton */}
      <div className="flex items-center gap-2 mb-4">
        <div className="skeleton-wrapper w-5 h-5 rounded bg-muted/50">
          <div className="shimmer" />
        </div>
        <div className="skeleton-wrapper h-6 bg-muted/50 rounded w-48">
          <div className="shimmer" />
        </div>
      </div>

      {/* Prediction rows - 8 rows to fill typical viewport */}
      {Array.from({ length: 8 }).map((_, i) => (
        <div
          key={i}
          className="skeleton-wrapper flex items-center gap-4 p-4 rounded-xl border border-border/50 bg-card/50"
        >
          {/* Shimmer overlay */}
          <div className="shimmer" />

          {/* Model icon placeholder */}
          <div className="w-10 h-10 rounded-lg bg-muted/50 flex-shrink-0" />

          {/* Model name and provider */}
          <div className="flex-1 space-y-2 min-w-0">
            <div className="h-4 bg-muted/50 rounded w-1/3" />
            <div className="h-3 bg-muted/50 rounded w-1/4" />
          </div>

          {/* Score boxes (home - away format) */}
          <div className="flex items-center gap-2 flex-shrink-0">
            <div className="w-8 h-8 bg-muted/50 rounded" />
            <div className="w-3 h-3 bg-muted/30 rounded" />
            <div className="w-8 h-8 bg-muted/50 rounded" />
          </div>

          {/* Points column (visible on finished matches) */}
          <div className="w-12 h-6 bg-muted/50 rounded flex-shrink-0" />
        </div>
      ))}

      {/* Footer skeleton (avg prediction summary) */}
      <div className="skeleton-wrapper grid grid-cols-2 gap-4 pt-4 border-t border-border/50">
        <div className="p-3 rounded-lg bg-muted/30 border border-border/50">
          <div className="shimmer" />
          <div className="space-y-2">
            <div className="h-3 bg-muted/50 rounded w-1/2 mx-auto" />
            <div className="h-5 bg-muted/50 rounded w-2/3 mx-auto" />
          </div>
        </div>
        <div className="p-3 rounded-lg bg-muted/30 border border-border/50">
          <div className="shimmer" />
          <div className="space-y-2">
            <div className="h-3 bg-muted/50 rounded w-1/2 mx-auto" />
            <div className="h-5 bg-muted/50 rounded w-1/3 mx-auto" />
          </div>
        </div>
      </div>
    </div>
  )
}
```

Key improvements:
- Uses skeleton-wrapper and shimmer classes from globals.css
- 8 rows matches typical viewport (research recommendation)
- Structure mirrors actual PredictionTable layout (icon, name, scores, points)
- Includes header and footer summary placeholders
- Maintains existing Card wrapper styling from parent
  </action>
  <verify>`grep "skeleton-wrapper\|shimmer" src/components/match/predictions-skeleton.tsx` shows shimmer usage</verify>
  <done>PredictionsSkeleton enhanced with shimmer animation matching table structure</done>
</task>

</tasks>

<verification>
1. PPR configuration:
   ```bash
   grep "cacheComponents" next.config.ts
   ```

2. Shimmer animation works:
   - Load match page with slow network (DevTools throttling)
   - Skeleton should show shimmer effect
   - Verify dark mode variant works
   - Verify reduced motion disables animation

3. Build verification:
   ```bash
   npm run build
   ```
   Look for PPR indicators in build output

4. Skeleton visual structure:
   - Compare skeleton to actual prediction table
   - Should have similar height and layout
</verification>

<success_criteria>
- cacheComponents: true in next.config.ts
- Shimmer animation CSS with dark mode and reduced motion support
- PredictionsSkeleton shows 8 rows with shimmer effect
- Skeleton layout matches prediction table structure
- Build passes and shows PPR indicators
</success_criteria>

<output>
After completion, create `.planning/phases/18-match-page-rebuild/18-03-SUMMARY.md`
</output>
