---
phase: 18-match-page-rebuild
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/match/match-tldr.tsx
  - src/components/match/narrative-preview.tsx
  - src/components/match/MatchContent.tsx
  - src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "TL;DR summary appears at top of match page (1-2 sentences)"
    - "Upcoming matches show 150-word preview with Read More link"
    - "Read More scrolls to full narrative section (not inline expand)"
    - "Finished matches show roundup summary with link to full analysis"
  artifacts:
    - path: "src/components/match/match-tldr.tsx"
      provides: "TL;DR component with state-aware content"
      exports: ["MatchTLDR"]
    - path: "src/components/match/narrative-preview.tsx"
      provides: "Preview with scroll-to-section link"
      exports: ["NarrativePreview"]
  key_links:
    - from: "src/components/match/narrative-preview.tsx"
      to: "full-narrative section"
      via: "scrollIntoView"
      pattern: "scrollIntoView.*behavior.*smooth"
    - from: "src/components/match/MatchContent.tsx"
      to: "src/components/match/narrative-preview.tsx"
      via: "import NarrativePreview"
      pattern: "NarrativePreview"
---

<objective>
Implement content visibility patterns: TL;DR summary at top, preview + scroll-to-section for narratives

Purpose: Requirements MTCH-02, MTCH-03, MTCH-04 - Content visible by match state. User decisions specify preview with jump-to-section (not inline expand), TL;DR format varies by state.

Output: MatchTLDR component for answer-first GEO, NarrativePreview with smooth scroll to full content section
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-match-page-rebuild/18-CONTEXT.md
@.planning/phases/18-match-page-rebuild/18-RESEARCH.md
@src/components/match/MatchContent.tsx
@src/components/match/ReadMoreText.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MatchTLDR component with state-aware content</name>
  <files>src/components/match/match-tldr.tsx</files>
  <action>
Create server component that displays 1-2 sentence TL;DR summary based on match state:

```tsx
import type { Match, Competition } from '@/lib/db/schema'

interface MatchTLDRProps {
  match: Match
  competition: Competition
}

export function MatchTLDR({ match, competition }: MatchTLDRProps) {
  const isUpcoming = match.status === 'scheduled'
  const isLive = match.status === 'live'
  const isFinished = match.status === 'finished'

  let tldr: string

  if (isFinished && match.homeScore !== null && match.awayScore !== null) {
    // Finished: "[Winner] won [score] in [competition]" or "Match ended [score] in [competition]"
    const homeWon = match.homeScore > match.awayScore
    const awayWon = match.awayScore > match.homeScore
    const isDraw = match.homeScore === match.awayScore

    if (isDraw) {
      tldr = `${match.homeTeam} and ${match.awayTeam} drew ${match.homeScore}-${match.awayScore} in the ${competition.name}.`
    } else {
      const winner = homeWon ? match.homeTeam : match.awayTeam
      const loser = homeWon ? match.awayTeam : match.homeTeam
      const winnerScore = homeWon ? match.homeScore : match.awayScore
      const loserScore = homeWon ? match.awayScore : match.homeScore
      tldr = `${winner} beat ${loser} ${winnerScore}-${loserScore} in the ${competition.name}.`
    }
  } else if (isLive && match.homeScore !== null && match.awayScore !== null) {
    // Live: "[Score] as of now"
    tldr = `${match.homeTeam} ${match.homeScore}-${match.awayScore} ${match.awayTeam}. Match in progress.`
  } else {
    // Upcoming: "AI models predict the outcome of [teams] in [competition]"
    tldr = `AI models predict the outcome of ${match.homeTeam} vs ${match.awayTeam} in the ${competition.name}. View predictions below.`
  }

  return (
    <div className="bg-primary/5 border border-primary/20 rounded-lg p-4 mb-6">
      <p className="text-foreground font-medium text-base md:text-lg leading-relaxed">
        {tldr}
      </p>
    </div>
  )
}
```

Key points:
- Server component (no 'use client')
- Natural sentence format per user's Claude's discretion allowance
- Subtle highlight styling to stand out as TL;DR without being intrusive
- GEO-optimized: leads with the answer
  </action>
  <verify>File exists at src/components/match/match-tldr.tsx and exports MatchTLDR</verify>
  <done>MatchTLDR renders state-aware 1-2 sentence summary</done>
</task>

<task type="auto">
  <name>Task 2: Create NarrativePreview with scroll-to-section</name>
  <files>src/components/match/narrative-preview.tsx</files>
  <action>
Create client component for preview text with "Read More" that scrolls to full section:

```tsx
'use client'

interface NarrativePreviewProps {
  previewText: string
  fullSectionId: string
  previewLines?: number
  className?: string
}

export function NarrativePreview({
  previewText,
  fullSectionId,
  previewLines = 4,
  className = '',
}: NarrativePreviewProps) {
  const scrollToFull = () => {
    const element = document.getElementById(fullSectionId)
    if (element) {
      element.scrollIntoView({
        behavior: 'smooth',
        block: 'start',
      })
    }
  }

  // Truncate to approximate word count for preview (150 words target)
  const words = previewText.split(/\s+/)
  const previewWordCount = 150
  const isLongContent = words.length > previewWordCount
  const preview = isLongContent
    ? words.slice(0, previewWordCount).join(' ') + '...'
    : previewText

  return (
    <div className={`space-y-3 ${className}`}>
      <p className="text-foreground leading-relaxed text-sm md:text-base">
        {preview}
      </p>
      {isLongContent && (
        <button
          onClick={scrollToFull}
          className="text-primary hover:underline font-medium text-sm min-h-[44px] inline-flex items-center gap-1"
          type="button"
        >
          Read Full Analysis
          <span aria-hidden="true">â†’</span>
        </button>
      )}
    </div>
  )
}
```

Key points:
- Client component for scrollIntoView
- 44px min-height for touch target (WCAG 2.5.5 AAA)
- Truncates at ~150 words per user decision
- smooth scroll behavior
  </action>
  <verify>File exists at src/components/match/narrative-preview.tsx with 'use client' directive</verify>
  <done>NarrativePreview truncates and scrolls to full section on click</done>
</task>

<task type="auto">
  <name>Task 3: Update MatchContent to use NarrativePreview and add full section anchors</name>
  <files>src/components/match/MatchContent.tsx, src/app/globals.css</files>
  <action>
Update MatchContentSection to:

1. For pre-match content (scheduled):
   - Show NarrativePreview with scroll to #full-narrative-prematch
   - Add full section below with id="full-narrative-prematch"

2. For post-match content (finished):
   - Show brief summary (2-3 sentences) at preview location
   - Link to #full-narrative-postmatch for full roundup

3. Add scroll-margin-top utility to globals.css for anchor offset:
```css
/* Scroll offset for sticky header */
.scroll-mt-20 {
  scroll-margin-top: 5rem;
}
```

4. Structure update for MatchContentSection:
```tsx
import { NarrativePreview } from './narrative-preview'

// Inside component, for pre-match:
{showPreMatch && content.preMatchContent && (
  <>
    {/* Preview above the fold */}
    <div className="mb-8">
      <h3 className="text-sm font-semibold text-muted-foreground mb-3 uppercase tracking-wide">
        Match Preview
      </h3>
      <NarrativePreview
        previewText={content.preMatchContent}
        fullSectionId="full-narrative-prematch"
      />
    </div>

    {/* Full content section (linked from preview) */}
    <section id="full-narrative-prematch" className="scroll-mt-20 pt-8 border-t border-border/30">
      <h3 className="text-lg font-bold mb-4">Full Match Preview</h3>
      <div className="text-foreground leading-relaxed text-sm md:text-base">
        {content.preMatchContent}
      </div>
    </section>
  </>
)}

// Similar pattern for post-match
```

Note: This replaces the existing ReadMoreText inline expansion with scroll-to-section per user decision.
  </action>
  <verify>
1. `grep "scrollIntoView\|scroll-mt-20\|full-narrative" src/components/match/MatchContent.tsx` shows scroll pattern
2. `grep "scroll-mt-20" src/app/globals.css` shows utility class
  </verify>
  <done>MatchContent uses preview + scroll pattern instead of inline expansion</done>
</task>

</tasks>

<verification>
1. Preview truncation:
   - Load match page with long pre-match content
   - Should show ~150 words with "Read Full Analysis" link

2. Scroll behavior:
   - Click "Read Full Analysis"
   - Page should smooth scroll to full section
   - Full section should be offset for sticky header

3. TL;DR visibility:
   - Upcoming match: Shows prediction preview text
   - Finished match: Shows final score summary
   - Live match: Shows current score

4. Build passes:
   ```bash
   npm run build
   ```
</verification>

<success_criteria>
- TL;DR appears at top with 1-2 sentence summary varying by match state
- Upcoming matches show ~150 word preview above fold
- "Read More" scrolls to full content section (not inline expand)
- Finished matches show summary with link to full roundup
- All interactive elements have 44px min touch targets
- Smooth scroll respects prefers-reduced-motion (native behavior)
</success_criteria>

<output>
After completion, create `.planning/phases/18-match-page-rebuild/18-02-SUMMARY.md`
</output>
