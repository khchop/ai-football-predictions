---
phase: 18-match-page-rebuild
plan: 05
type: execute
wave: 2
depends_on: ["18-01", "18-02", "18-03"]
files_modified:
  - src/app/leagues/[slug]/[match]/page.tsx
autonomous: false

must_haves:
  truths:
    - "Match page integrates all Phase 18 components correctly"
    - "Score appears exactly twice (hero + sticky header)"
    - "TL;DR visible at top, FAQ at bottom"
    - "PPR streams predictions with shimmer skeleton"
    - "Content visibility correct for upcoming/live/finished states"
  artifacts:
    - path: "src/app/leagues/[slug]/[match]/page.tsx"
      provides: "Fully integrated match page with Phase 18 features"
      contains: "MatchPageHeader"
  key_links:
    - from: "src/app/leagues/[slug]/[match]/page.tsx"
      to: "All Phase 18 components"
      via: "imports and usage"
      pattern: "MatchTLDR.*MatchPageHeader.*MatchFAQ"
---

<objective>
Final integration of all Phase 18 components and human verification of complete match page rebuild

Purpose: Validate all requirements (MTCH-01 through MTCH-06) work together. User verifies visual results, content visibility by state, and overall UX quality.

Output: Fully integrated match page, human-verified across upcoming/live/finished states
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-match-page-rebuild/18-CONTEXT.md
@.planning/phases/18-match-page-rebuild/18-01-SUMMARY.md
@.planning/phases/18-match-page-rebuild/18-02-SUMMARY.md
@.planning/phases/18-match-page-rebuild/18-03-SUMMARY.md
@.planning/phases/18-match-page-rebuild/18-04-SUMMARY.md
@src/app/leagues/[slug]/[match]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Final integration of Phase 18 components into match page</name>
  <files>src/app/leagues/[slug]/[match]/page.tsx</files>
  <action>
Ensure all Phase 18 components are properly integrated:

1. Verify imports:
```tsx
import { MatchPageHeader } from '@/components/match/match-page-header'
import { MatchTLDR } from '@/components/match/match-tldr'
import { MatchFAQ } from '@/components/match/match-faq'
import { NarrativePreview } from '@/components/match/narrative-preview'
```

2. Page structure order (top to bottom):
   - MatchPageSchema (JSON-LD, already exists)
   - MatchH1 (sr-only, already exists)
   - Back link (already exists)
   - **MatchTLDR** (NEW - TL;DR summary)
   - **MatchPageHeader** (NEW - hero + observer-triggered sticky)
   - Content sections (predictions, stats, etc.)
   - RelatedMatchesWidget (already exists)
   - **MatchFAQ** (NEW - FAQ at bottom)

3. Remove any duplicate score displays outside hero/sticky:
   - Check MatchStats component usage
   - Check mobile tab content for score duplication

4. Verify Suspense boundary wraps dynamic content:
```tsx
<Suspense fallback={<PredictionsSkeleton />}>
  <PredictionsSection ... />
</Suspense>
```

5. Ensure desktop layout (`hidden md:block`) and mobile layout (`md:hidden`) both use consistent patterns:
   - MatchPageHeader works for both (handles mobile sticky internally)
   - MatchTLDR appears on both
   - MatchFAQ appears on both (or desktop-only if preferred for simplicity)
  </action>
  <verify>
1. `npm run build` passes
2. `grep -E "MatchTLDR|MatchPageHeader|MatchFAQ" src/app/leagues/[slug]/[match]/page.tsx` shows all imports used
  </verify>
  <done>Match page fully integrates all Phase 18 components</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 18 Match Page Rebuild:
- Score deduplication (hero + sticky only)
- TL;DR summary at top (state-aware)
- Content visibility by match state
- PPR with shimmer skeletons
- FAQ section at bottom with JSON-LD
  </what-built>
  <how-to-verify>
**Test with 3 different match states:**

1. **Upcoming Match** (find a scheduled match)
   - URL: /leagues/[league]/[upcoming-match-slug]
   - [ ] TL;DR shows "AI models predict..." text
   - [ ] Hero shows teams, competition, kickoff time (NO score yet)
   - [ ] Scroll down - sticky header appears ONLY when hero exits viewport
   - [ ] Predictions section shows shimmer skeleton briefly, then loads
   - [ ] Pre-match narrative preview visible (if content exists)
   - [ ] FAQ section at bottom with "Who is predicted to win?" question

2. **Finished Match** (find a completed match)
   - URL: /leagues/[league]/[finished-match-slug]
   - [ ] TL;DR shows "[Winner] beat [Loser] [score]" or draw text
   - [ ] Hero shows final score in large format
   - [ ] Sticky header shows compact score when scrolled
   - [ ] Score appears ONLY in hero + sticky (not in stats, roundup, etc.)
   - [ ] Post-match roundup summary visible (if content exists)
   - [ ] FAQ section with "What was the final score?" question

3. **General Checks**
   - [ ] View page source (Ctrl+U): FAQPage JSON-LD schema present
   - [ ] Dark mode: All components render correctly
   - [ ] Mobile: Layout responsive, sticky header works
   - [ ] Reduced motion: Shimmer animation disabled (if testable)

**Performance Check:**
   - DevTools Network tab: Static shell renders before predictions
   - Lighthouse Performance score: >= 80

**Issue reporting:** Describe any issues found and their severity.
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
Pre-checkpoint automated verification:
```bash
# Build passes
npm run build

# All Phase 18 components integrated
grep -E "MatchTLDR|MatchPageHeader|MatchFAQ" src/app/leagues/[slug]/[match]/page.tsx

# Score deduplication check (should only be in header components)
grep -rn "homeScore" src/app/leagues/[slug]/[match]/page.tsx | wc -l
# Expected: 0 (scores should only render in components, not page.tsx directly)

# PPR config present
grep "cacheComponents" next.config.ts
```
</verification>

<success_criteria>
Human verification confirms:
- MTCH-01: Score appears exactly twice (hero + sticky header)
- MTCH-02: Pre-match narrative visible on upcoming matches
- MTCH-03: Prediction explanations visible on match pages
- MTCH-04: Post-match roundup visible on finished matches
- MTCH-05: Static shell renders instantly, predictions stream in
- MTCH-06: FAQ with JSON-LD schema at bottom

All 3 match states (upcoming/live/finished) display correctly.
</success_criteria>

<output>
After completion, create `.planning/phases/18-match-page-rebuild/18-05-SUMMARY.md`
</output>
