---
phase: 17-design-system-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/globals.css
  - src/app/layout.tsx
  - src/app/providers.tsx
  - src/components/theme-toggle.tsx
autonomous: true

must_haves:
  truths:
    - "User sees neutral gray base colors instead of purple theme"
    - "User toggles dark mode and all UI elements reflect change immediately"
    - "User's theme preference persists across browser sessions"
    - "Match outcome colors (win/loss/draw) are consistent across app"
  artifacts:
    - path: "src/app/globals.css"
      provides: "Semantic OKLCH color tokens for match states"
      contains: "--color-win"
    - path: "src/app/providers.tsx"
      provides: "ThemeProvider wrapper for dark mode"
      contains: "ThemeProvider"
    - path: "src/components/theme-toggle.tsx"
      provides: "Dark mode toggle button"
      exports: ["ThemeToggle"]
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/app/providers.tsx"
      via: "Providers component wrapper"
      pattern: "<Providers>"
    - from: "src/components/theme-toggle.tsx"
      to: "next-themes"
      via: "useTheme hook"
      pattern: "useTheme"
---

<objective>
Establish semantic color tokens using OKLCH color space and implement dark mode infrastructure with next-themes.

Purpose: Create the color foundation that all subsequent Phase 17-23 work will use. Replace current purple gradient theme with neutral grays that let data colors pop, and enable user-controlled dark/light mode switching.

Output: Refactored globals.css with semantic tokens, ThemeProvider setup, and working ThemeToggle component.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-design-system-foundation/17-CONTEXT.md
@.planning/phases/17-design-system-foundation/17-RESEARCH.md
@src/app/globals.css
@src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor globals.css with semantic OKLCH color tokens</name>
  <files>src/app/globals.css</files>
  <action>
Refactor globals.css to replace current purple/gradient theme with semantic OKLCH color tokens:

1. Keep existing @import statements and @custom-variant dark

2. Replace @theme inline block with new @theme block containing:
   - Neutral gray palette (background, foreground, card, muted, etc.) using OKLCH
   - Semantic match state colors: --color-win (green), --color-draw (amber), --color-loss (red)
   - Accuracy gradient colors: --color-accuracy-low/mid/high
   - Keep existing radius, font, and chart variables

3. Update :root CSS variables for light mode defaults:
   - Use OKLCH values: oklch(0.98 0.002 264) for light backgrounds
   - Keep --radius: 0.75rem

4. Add .dark class overrides (replaces current .light override):
   - Dark backgrounds: oklch(0.14 0.012 264) NOT pure black
   - Adjust semantic colors for dark mode WCAG contrast
   - win: oklch(0.72 0.17 162.5), loss: oklch(0.67 0.24 25.3), draw: oklch(0.80 0.19 70.1)

5. Preserve existing utility classes (gradient-primary, gradient-text, glass, glow-*, status-*, animate-*)
   - Update color values to use new semantic tokens where applicable

6. Keep scrollbar and selection styles

User decisions (LOCKED):
- Neutral gray palette for base theme
- Traditional green/red/amber for match outcomes
- Instant switch, no animation on theme toggle
- Default to system preference (handled by next-themes in Task 2)
  </action>
  <verify>
Build passes: `npm run build` completes without CSS errors.
Grep for OKLCH: `grep -c "oklch" src/app/globals.css` shows multiple matches.
  </verify>
  <done>globals.css contains OKLCH semantic color tokens for win/loss/draw/accuracy, neutral gray palette, and dark mode overrides.</done>
</task>

<task type="auto">
  <name>Task 2: Install next-themes and wire up ThemeProvider</name>
  <files>src/app/providers.tsx, src/app/layout.tsx</files>
  <action>
1. Install next-themes: `npm install next-themes`

2. Create src/app/providers.tsx:
   - 'use client' directive at top
   - Import ThemeProvider from next-themes
   - Export Providers component that wraps children with:
     - ThemeProvider with attribute="class"
     - defaultTheme="system" (user decision: default to system preference)
     - enableSystem={true}
     - disableTransitionOnChange={true} (user decision: instant switch)

3. Update src/app/layout.tsx:
   - Import Providers from './providers'
   - Add suppressHydrationWarning to html tag (required for next-themes SSR)
   - Remove hardcoded className="dark" from html tag
   - Wrap body content with Providers component
   - Keep existing schema scripts, Analytics, Navigation, Footer, etc.

Note: Do NOT change font configuration (Inter stays) or remove any existing functionality.
  </action>
  <verify>
Package installed: `grep "next-themes" package.json` returns match.
Dev server starts: `npm run dev` shows no hydration errors.
  </verify>
  <done>ThemeProvider is configured with system preference default, instant switching, and localStorage persistence.</done>
</task>

<task type="auto">
  <name>Task 3: Create ThemeToggle component</name>
  <files>src/components/theme-toggle.tsx</files>
  <action>
Create src/components/theme-toggle.tsx:

1. 'use client' directive (required for useTheme hook)

2. Import:
   - useTheme from 'next-themes'
   - Moon, Sun icons from 'lucide-react'
   - Button from '@/components/ui/button'

3. Export ThemeToggle component:
   - Use useTheme() hook to get theme and setTheme
   - Button with variant="ghost" and size="icon"
   - onClick toggles between 'dark' and 'light'
   - Show Sun icon with rotate/scale transition that hides in dark mode
   - Show Moon icon with rotate/scale transition that hides in light mode
   - Include aria-label="Toggle theme" for accessibility

4. Handle hydration:
   - Add mounted state with useEffect to prevent hydration mismatch
   - Return null or skeleton during SSR

Note: Do NOT integrate into navigation yet - that's Phase 22 scope per user decision "Dark mode toggle placement depends on mobile navigation structure from Phase 22".
  </action>
  <verify>
Component exists: `test -f src/components/theme-toggle.tsx && echo "exists"`.
Exports correct: `grep "export.*ThemeToggle" src/components/theme-toggle.tsx` returns match.
  </verify>
  <done>ThemeToggle component is ready for integration, handles hydration correctly, and follows existing Button patterns.</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `npm run dev` starts without hydration warnings
3. Browser respects system color scheme preference on first load (no FOUC)
4. Manual theme toggle works (can test by temporarily adding ThemeToggle to Navigation)
5. Theme persists after page refresh (check localStorage for 'theme' key)
6. Win/loss/draw colors visible in globals.css as OKLCH values
</verification>

<success_criteria>
1. globals.css has semantic OKLCH color tokens (--color-win, --color-loss, --color-draw, --color-accuracy-*)
2. next-themes ThemeProvider wraps app with system preference default
3. ThemeToggle component exists and handles hydration correctly
4. Build passes with no CSS or hydration errors
5. Dark mode variables use dark grays (not pure black) for eye comfort
</success_criteria>

<output>
After completion, create `.planning/phases/17-design-system-foundation/17-01-SUMMARY.md`
</output>
