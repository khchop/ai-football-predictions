---
phase: 17-design-system-foundation
plan: 04
type: execute
wave: 2
depends_on: ["17-01"]
files_modified:
  - next.config.ts
  - src/app/globals.css
  - src/app/layout.tsx
autonomous: false

must_haves:
  truths:
    - "User navigates between pages with smooth visual transitions"
    - "User with prefers-reduced-motion sees instant navigation (no animations)"
    - "Unsupported browsers fall back to instant navigation gracefully"
    - "Transitions are snappy (150ms duration)"
  artifacts:
    - path: "next.config.ts"
      provides: "View Transitions API experimental flag"
      contains: "viewTransition"
    - path: "src/app/globals.css"
      provides: "View transition CSS with accessibility handling"
      contains: "view-transition"
    - path: "src/app/layout.tsx"
      provides: "ViewTransition wrapper component"
      contains: "ViewTransition"
  key_links:
    - from: "next.config.ts"
      to: "src/app/layout.tsx"
      via: "experimental feature enables ViewTransition"
      pattern: "viewTransition.*true"
    - from: "src/app/globals.css"
      to: "prefers-reduced-motion"
      via: "accessibility media query"
      pattern: "prefers-reduced-motion"
---

<objective>
Enable View Transitions API for smooth page navigation with proper accessibility handling.

Purpose: Provide polished navigation transitions that enhance user experience while respecting accessibility preferences. This is infrastructure that all subsequent phases will benefit from.

Output: Enabled View Transitions in next.config.ts, CSS transition styles with prefers-reduced-motion handling, and ViewTransition wrapper in layout.tsx.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-design-system-foundation/17-CONTEXT.md
@.planning/phases/17-design-system-foundation/17-RESEARCH.md
@.planning/phases/17-design-system-foundation/17-01-SUMMARY.md
@next.config.ts
@src/app/layout.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enable View Transitions in next.config.ts</name>
  <files>next.config.ts</files>
  <action>
Update next.config.ts to enable the experimental View Transitions API:

Add experimental.viewTransition to the nextConfig object:

```typescript
const nextConfig: NextConfig = {
  experimental: {
    viewTransition: true,
  },
  images: {
    // ... existing image config
  },
  async redirects() {
    // ... existing redirects
  },
};
```

Important:
- Place experimental block before images block for clarity
- Keep all existing configuration (images, redirects, Sentry wrapper)
- This enables Next.js integration with the View Transitions API

Note: View Transitions API has ~93% browser support. Unsupported browsers will get instant navigation (no transition) which is acceptable per user decision: "No fallback for unsupported browsers - instant navigation instead".
  </action>
  <verify>
Config updated: `grep "viewTransition.*true" next.config.ts` returns match.
Build passes: `npm run build` completes without errors.
  </verify>
  <done>View Transitions API enabled in next.config.ts experimental configuration.</done>
</task>

<task type="auto">
  <name>Task 2: Add View Transitions CSS with accessibility handling</name>
  <files>src/app/globals.css</files>
  <action>
Add View Transitions CSS rules to globals.css:

Add after the @layer utilities block:

```css
/* View Transitions API - Page navigation */

/* Default crossfade transition - 150ms (user decision: snappy) */
::view-transition-old(root),
::view-transition-new(root) {
  animation-duration: 150ms;
  animation-timing-function: ease-out;
}

/* Crossfade animation (user decision: simple, universally understood) */
::view-transition-old(root) {
  animation-name: fade-out;
}

::view-transition-new(root) {
  animation-name: fade-in;
}

@keyframes fade-out {
  from { opacity: 1; }
  to { opacity: 0; }
}

@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Accessibility: Disable transitions for users who prefer reduced motion */
/* User decision: Disable transitions entirely for prefers-reduced-motion users */
@media (prefers-reduced-motion: reduce) {
  ::view-transition-group(*),
  ::view-transition-old(*),
  ::view-transition-new(*) {
    animation: none !important;
    animation-duration: 0s !important;
  }
}
```

Key points:
- 150ms duration per user decision (snappy)
- Crossfade style per user decision (simple, universally understood)
- prefers-reduced-motion completely disables animation per user decision
- Uses !important to ensure override even if other styles try to animate
  </action>
  <verify>
View transition styles exist: `grep "view-transition" src/app/globals.css` returns matches.
Reduced motion handling: `grep "prefers-reduced-motion" src/app/globals.css` returns match.
Duration set: `grep "150ms" src/app/globals.css` returns match.
  </verify>
  <done>View Transitions CSS added with 150ms crossfade and prefers-reduced-motion accessibility handling.</done>
</task>

<task type="auto">
  <name>Task 3: Add ViewTransition wrapper to layout.tsx</name>
  <files>src/app/layout.tsx</files>
  <action>
Update src/app/layout.tsx to wrap content with ViewTransition:

1. Add import at top of file:
   ```typescript
   import { ViewTransition } from 'react'
   ```

2. Wrap the main content (inside body, after Providers) with ViewTransition:

The structure should be:
```tsx
<body className={...}>
  {/* Schema scripts - keep as is */}
  <Analytics />
  {/* Background gradient - keep as is */}

  <Providers>
    <TooltipProvider delayDuration={300} skipDelayDuration={100}>
      <Navigation />

      <ViewTransition>
        <main className="flex-1 container mx-auto px-4 py-6 max-w-7xl">
          <ErrorBoundaryProvider>
            {children}
          </ErrorBoundaryProvider>
        </main>
      </ViewTransition>

      <Footer />
    </TooltipProvider>
  </Providers>
</body>
```

Notes:
- ViewTransition wraps main content, NOT navigation or footer (they stay static)
- This enables smooth content transitions while nav/footer remain stable
- Keep all existing functionality (ErrorBoundaryProvider, TooltipProvider, etc.)
- Providers wrapper (from Plan 01) must be in place before ViewTransition

Important: ViewTransition from 'react' is React 19's built-in component that integrates with Next.js View Transitions. It handles the startViewTransition call automatically during navigation.
  </action>
  <verify>
Import exists: `grep "import.*ViewTransition.*from.*react" src/app/layout.tsx` returns match.
Component used: `grep "<ViewTransition>" src/app/layout.tsx` returns match.
  </verify>
  <done>ViewTransition wrapper added to layout.tsx, wrapping main content for page transitions.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 4: Verify design system foundation</name>
  <what-built>
Complete design system foundation:
- Semantic OKLCH color tokens (Plan 01)
- Dark mode with next-themes (Plan 01)
- Typography scale 1.2 ratio (Plan 02)
- Spacing system 4px/8px rhythm (Plan 02)
- MatchBadge and AccuracyBadge components (Plan 03)
- View Transitions with accessibility (Plan 04)
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Open http://localhost:3000 in browser

**Color & Dark Mode:**
3. Page should load respecting system preference (dark/light)
4. Colors should be neutral grays (not purple gradient theme)
5. If ThemeToggle was temporarily added to Navigation, toggle dark/light mode:
   - Should switch instantly (no animation)
   - Should persist after page refresh

**Typography & Spacing:**
6. Text should use system fonts (-apple-system, etc.)
7. Type hierarchy should be visible (headings larger than body text)

**Match Components (test in DevTools console):**
8. Import and render MatchBadge:
   ```javascript
   // In React DevTools or test page
   <MatchBadge outcome="win">Home Win</MatchBadge>
   <MatchBadge status="live">LIVE</MatchBadge>
   <AccuracyBadge percentage={75} />
   <AccuracyBadge percentage={45} />
   <AccuracyBadge percentage={30} />
   ```
9. Should see green/amber/red colors for accuracy thresholds

**View Transitions:**
10. Navigate between pages (e.g., / to /matches)
11. Should see subtle crossfade (150ms)
12. Open System Preferences > Accessibility > Reduce Motion
13. Navigate again - should be instant (no animation)

**Accessibility:**
14. Open Chrome DevTools > Lighthouse > Accessibility
15. Run audit - should have no critical color contrast issues
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. View Transitions enabled: `grep "viewTransition" next.config.ts`
3. CSS transitions: `grep "view-transition" src/app/globals.css`
4. Reduced motion handling: `grep "prefers-reduced-motion" src/app/globals.css`
5. ViewTransition wrapper: `grep "ViewTransition" src/app/layout.tsx`
6. Human verification of visual behavior
</verification>

<success_criteria>
1. View Transitions API enabled in next.config.ts
2. 150ms crossfade animation defined in CSS
3. prefers-reduced-motion disables all view transitions
4. ViewTransition wrapper in layout.tsx around main content
5. Human verification confirms smooth transitions and accessibility
</success_criteria>

<output>
After completion, create `.planning/phases/17-design-system-foundation/17-04-SUMMARY.md`
</output>
