---
phase: 47-structured-data-validation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/seo/schema/sports-event.ts
  - src/lib/seo/schema/article.ts
  - src/lib/seo/schemas.ts
  - src/lib/seo/schema/roundup.ts
autonomous: true

must_haves:
  truths:
    - "SportsEvent schema has correct EventStatus for finished/live/postponed/cancelled matches"
    - "SportsEvent schema includes location.address property for Google Rich Results"
    - "Article schema publisher has logo as ImageObject (not string)"
    - "FAQPage schema only renders when 2+ questions exist"
  artifacts:
    - path: "src/lib/seo/schema/sports-event.ts"
      provides: "SportsEvent builder with correct EventStatus mapping and location.address"
      contains: "EventCompleted"
    - path: "src/lib/seo/schema/article.ts"
      provides: "Article builder with ImageObject publisher logo"
      contains: "ImageObject"
    - path: "src/lib/seo/schemas.ts"
      provides: "Updated schema generators with fixed validation"
      contains: "ImageObject"
    - path: "src/lib/seo/schema/roundup.ts"
      provides: "Roundup schema with @id publisher reference"
      contains: "ORGANIZATION_ID"
  key_links:
    - from: "src/lib/seo/schema/sports-event.ts"
      to: "Google Rich Results"
      via: "EventStatus mapping and location.address"
      pattern: "EventCompleted|EventInProgress|EventPostponed"
    - from: "src/lib/seo/schema/article.ts"
      to: "Google Rich Results"
      via: "publisher.logo ImageObject"
      pattern: "ImageObject.*logo"
---

<objective>
Fix SportsEvent, Article, and FAQ schema validation errors to pass Google Rich Results Test.

Purpose: SCHEMA-02 requires SportsEvent to pass Rich Results validation (needs correct EventStatus and location.address). SCHEMA-03 requires Article/FAQPage to pass validation (needs ImageObject publisher.logo, minimum 2 questions). These are the individual schema builder modules that all page-level components consume.

Output: Fixed sports-event.ts with correct status mapping and location.address, fixed article.ts with ImageObject logo, fixed schemas.ts with consistent patterns, fixed roundup.ts with @id publisher references.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/47-structured-data-validation/47-RESEARCH.md
@src/lib/seo/schema/sports-event.ts
@src/lib/seo/schema/article.ts
@src/lib/seo/schemas.ts
@src/lib/seo/schema/roundup.ts
@src/lib/seo/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix SportsEvent EventStatus mapping and location.address</name>
  <files>src/lib/seo/schema/sports-event.ts, src/lib/seo/schemas.ts</files>
  <action>
**sports-event.ts changes:**

1. Fix `mapEventStatus()` function (currently always returns EventScheduled):
   ```typescript
   function mapEventStatus(status: MatchStatus): string {
     switch (status) {
       case 'finished':
         return 'https://schema.org/EventCompleted';
       case 'live':
         return 'https://schema.org/EventInProgress';
       case 'postponed':
         return 'https://schema.org/EventPostponed';
       case 'cancelled':
         return 'https://schema.org/EventCancelled';
       default:
         return 'https://schema.org/EventScheduled';
     }
   }
   ```
   Update the return type from the narrow literal `'https://schema.org/EventScheduled'` to `string`.

2. Fix `location` in `buildSportsEventSchema()`:
   The current `location` has `address: match.venue ?? 'Unknown Venue'` which is OK for Google (string address is accepted). Keep this.
   BUT: also add `@type: 'Place'` explicitly (already there, verify it stays).

3. Remove the `// Note: schema.org only has EventScheduled for all events - no EventCompleted` comment - it's wrong. EventCompleted, EventInProgress, EventPostponed, EventCancelled are all valid schema.org EventStatusType values.

4. Fix `superEvent` - currently uses `SportsOrganization` but `superEvent` expects an Event type per schema.org spec. Change to reference a generic event:
   ```typescript
   if (competitionId) {
     (event as Record<string, unknown>).superEvent = {
       '@type': 'Event',
       '@id': `${BASE_URL}/leagues/${competitionId}`,
       name: competitionId, // Will be enhanced by competition schema on league page
     };
   }
   ```
   Or simply remove the superEvent if it's not adding value (league pages have their own schema). The @ts-expect-error is a code smell. Decision: remove superEvent entirely - the competition relationship is already expressed via BreadcrumbList hierarchy and league page schemas. This is cleaner.

**schemas.ts changes:**

1. Fix `generateSportsEventSchema()`:
   - Fix the EventStatus logic (line 41): currently `data.status === 'finished' ? 'EventScheduled' : 'EventScheduled'` - both branches return the same value. Fix to use proper status mapping matching the pattern in sports-event.ts.
   - Add `location.address` when venue is present (currently only sets `location.name`)
   - Add `@type: 'Place'` to location

2. Fix `generateOrganizationSchema()`:
   - Update description from "30 AI models" to "42 AI models"
   - Add `@id: 'https://kroam.xyz#organization'` for consistency with root.ts constants (import from root.ts once Plan 01 creates it, or use string literal since this runs in parallel)
   - For now, use string literal `'https://kroam.xyz#organization'` since Plan 01 runs in parallel

3. Fix `generateArticleSchema()`:
   - Publisher logo is already ImageObject (line 130-131) - verify and keep
   - Add `@id` to the article for cross-referencing: `'@id': data.url + '#article'`
  </action>
  <verify>
1. `npx tsc --noEmit src/lib/seo/schema/sports-event.ts` compiles
2. `npx tsc --noEmit src/lib/seo/schemas.ts` compiles
3. `grep 'EventCompleted' src/lib/seo/schema/sports-event.ts` returns a match
4. `grep 'EventCompleted' src/lib/seo/schemas.ts` returns a match
5. `grep '30 AI models' src/lib/seo/schemas.ts` returns no matches (old count removed)
  </verify>
  <done>sports-event.ts returns correct EventStatus per match status. schemas.ts generateSportsEventSchema uses correct EventStatus. Organization description says "42 AI models". No @ts-expect-error for superEvent.</done>
</task>

<task type="auto">
  <name>Task 2: Fix Article publisher.logo and roundup.ts @id references</name>
  <files>src/lib/seo/schema/article.ts, src/lib/seo/schema/roundup.ts</files>
  <action>
**article.ts changes:**

1. The publisher.logo is already an ImageObject (line 24-27) - good. But verify it uses absolute URL `https://kroam.xyz/logo.png` not relative.

2. Fix author to use @id reference pattern for consistency:
   ```typescript
   author: {
     '@type': 'Organization',
     '@id': 'https://kroam.xyz#organization',
     name: SITE_NAME,
     url: BASE_URL,
   },
   ```
   (Keep name/url as fallback properties alongside @id for standalone contexts)

3. Fix publisher to include @id:
   ```typescript
   publisher: {
     '@type': 'Organization',
     '@id': 'https://kroam.xyz#organization',
     name: SITE_NAME,
     logo: {
       '@type': 'ImageObject',
       url: `${BASE_URL}/logo.png`,
     },
   },
   ```

4. Fix `matchUrl` on line 6: Currently uses `${BASE_URL}/matches/${match.id}` which is the OLD URL pattern (UUID-based). This URL gets 410 Gone from middleware. The article.ts doesn't actually use matchUrl for the article URL - it uses it for the SportsEvent @id cross-reference (`about.@id`). Since the SportsEvent @id in MatchPageSchema uses the canonical URL, this cross-reference points to the wrong entity. Fix: accept an optional `canonicalUrl` parameter. If not provided, fall back to the match ID pattern.

5. Fix `createOgImageUrl` - currently returns `${BASE_URL}/matches/${match.id}/opengraph-image` which is the OLD route. This is used in `image` array. Since article.ts is called from graph.ts which is only used by `/matches/[id]/stats/page.tsx` (a legacy route), leave this as-is but add a note that this is for the legacy stats route only.

**roundup.ts changes:**

1. Add @id to article publisher:
   ```typescript
   publisher: {
     '@type': 'Organization',
     '@id': 'https://kroam.xyz#organization',
     name: 'Kroam',  // Update from 'kroam.xyz' to 'Kroam'
     logo: {
       '@type': 'ImageObject',
       url: `${BASE_URL}/logo.png`,
     },
   },
   ```

2. Update author from `post.generatedBy || 'kroam.xyz'` to `post.generatedBy || 'Kroam'` (consistent branding per Phase 46 decisions).

3. Add @id to article: `'@id': postUrl + '#article'`

4. Ensure publisher.logo is ImageObject (already is on line 38-40, verify).
  </action>
  <verify>
1. `npx tsc --noEmit src/lib/seo/schema/article.ts` compiles
2. `npx tsc --noEmit src/lib/seo/schema/roundup.ts` compiles
3. `grep 'ImageObject' src/lib/seo/schema/article.ts` returns matches (publisher.logo)
4. `grep 'ImageObject' src/lib/seo/schema/roundup.ts` returns matches (publisher.logo)
5. `grep 'kroam.xyz#organization' src/lib/seo/schema/article.ts` returns matches (@id reference)
6. `grep "'kroam.xyz'" src/lib/seo/schema/roundup.ts` returns no matches (updated to 'Kroam')
  </verify>
  <done>article.ts publisher has @id and ImageObject logo. roundup.ts publisher has @id, ImageObject logo, and 'Kroam' branding. Both have consistent @id patterns matching root.ts constants.</done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build` (or webpack fallback)
2. SportsEvent schemas use EventCompleted for finished matches (not always EventScheduled)
3. Article publisher.logo is ImageObject in all schema builders
4. Organization @id is consistent ('https://kroam.xyz#organization') across all files
5. No "bettingsoccer" or "30 AI models" strings in schema files
6. roundup.ts uses 'Kroam' branding (not 'kroam.xyz')
</verification>

<success_criteria>
- SCHEMA-02 addressed: SportsEvent has correct EventStatus mapping and location with address
- SCHEMA-03 addressed: Article has ImageObject publisher.logo, FAQ minimum 2 questions (already handled by generators)
- All schema builders use consistent @id patterns
- No validation-failing patterns remain in builder modules
</success_criteria>

<output>
After completion, create `.planning/phases/47-structured-data-validation/47-02-SUMMARY.md`
</output>
