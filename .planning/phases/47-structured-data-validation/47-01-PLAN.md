---
phase: 47-structured-data-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/seo/schema/root.ts
  - src/app/layout.tsx
  - src/components/MatchPageSchema.tsx
  - src/lib/seo/schema/graph.ts
autonomous: true

must_haves:
  truths:
    - "Root layout renders Organization and WebSite schemas exactly once with @id values"
    - "Match pages do not duplicate Organization or WebSite schemas"
    - "All page-level schemas can reference root entities via @id constants"
  artifacts:
    - path: "src/lib/seo/schema/root.ts"
      provides: "Organization/WebSite @id constants and builder functions"
      exports: ["ORGANIZATION_ID", "WEBSITE_ID", "buildRootOrganizationSchema", "buildRootWebSiteSchema"]
    - path: "src/app/layout.tsx"
      provides: "Single root @graph with Organization, WebSite, SoftwareApplication"
      contains: "@graph"
    - path: "src/components/MatchPageSchema.tsx"
      provides: "Match page @graph without duplicated Organization/WebSite"
      contains: "ORGANIZATION_ID"
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/lib/seo/schema/root.ts"
      via: "import buildRootOrganizationSchema, buildRootWebSiteSchema"
      pattern: "import.*from.*schema/root"
    - from: "src/components/MatchPageSchema.tsx"
      to: "src/lib/seo/schema/root.ts"
      via: "import ORGANIZATION_ID, WEBSITE_ID"
      pattern: "import.*ORGANIZATION_ID.*from.*schema/root"
---

<objective>
Create root schema single source of truth and eliminate Organization/WebSite duplication from root layout and match pages.

Purpose: SCHEMA-01 requires no duplicate Organization or WebSite schemas on any page. Currently root layout renders 3 separate JSON-LD scripts, and MatchPageSchema duplicates Organization/WebSite in its @graph. This plan creates the canonical @id constants and consolidates root layout into a single @graph.

Output: root.ts module with @id constants and builders, refactored layout.tsx with single @graph, refactored MatchPageSchema.tsx using @id references, fixed graph.ts with correct branding.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/47-structured-data-validation/47-RESEARCH.md
@src/app/layout.tsx
@src/components/MatchPageSchema.tsx
@src/lib/seo/schema/graph.ts
@src/lib/seo/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create root schema module with @id constants and builders</name>
  <files>src/lib/seo/schema/root.ts</files>
  <action>
Create `src/lib/seo/schema/root.ts` with:

1. Export stable @id constants:
   ```typescript
   export const ORGANIZATION_ID = 'https://kroam.xyz#organization';
   export const WEBSITE_ID = 'https://kroam.xyz#website';
   ```

2. Export `buildRootOrganizationSchema()` that returns:
   - `@type`: 'Organization'
   - `@id`: ORGANIZATION_ID
   - `name`: 'Kroam'
   - `url`: 'https://kroam.xyz'
   - `logo`: ImageObject with `@type: 'ImageObject'` and `url: 'https://kroam.xyz/logo.png'` (NOT a plain string - Google requires ImageObject for Article publisher.logo validation)
   - `description`: 'AI football prediction platform comparing 42 AI models on match predictions across 17 competitions'

3. Export `buildRootWebSiteSchema()` that returns:
   - `@type`: 'WebSite'
   - `@id`: WEBSITE_ID
   - `name`: 'Kroam - AI Football Predictions'
   - `url`: 'https://kroam.xyz'
   - `publisher`: `{ '@id': ORGANIZATION_ID }` (reference, not duplicate)
   - `potentialAction`: SearchAction with EntryPoint urlTemplate
   - `inLanguage`: 'en-US'

4. Export `buildSoftwareApplicationSchema()` that returns the existing SoftwareApplication object from layout.tsx (move it here for colocation).

Use plain TypeScript objects (not schema-dts types) to match the pattern used in MatchPageSchema.tsx and layout.tsx. This keeps it simple and avoids @ts-expect-error workarounds.
  </action>
  <verify>
`npx tsc --noEmit src/lib/seo/schema/root.ts` compiles without errors. The file exports ORGANIZATION_ID, WEBSITE_ID, buildRootOrganizationSchema, buildRootWebSiteSchema, buildSoftwareApplicationSchema.
  </verify>
  <done>root.ts exists with all 5 exports. ORGANIZATION_ID = 'https://kroam.xyz#organization'. WEBSITE_ID = 'https://kroam.xyz#website'. Organization logo is ImageObject (not string).</done>
</task>

<task type="auto">
  <name>Task 2: Consolidate root layout to single @graph and fix MatchPageSchema + graph.ts</name>
  <files>src/app/layout.tsx, src/components/MatchPageSchema.tsx, src/lib/seo/schema/graph.ts</files>
  <action>
**layout.tsx changes:**
1. Import `buildRootOrganizationSchema`, `buildRootWebSiteSchema`, `buildSoftwareApplicationSchema` from `@/lib/seo/schema/root`
2. Replace the 3 separate inline schema objects (organizationSchema, websiteSchema, softwareApplicationSchema) with a single `rootGraph`:
   ```typescript
   const rootGraph = {
     '@context': 'https://schema.org',
     '@graph': [
       buildRootOrganizationSchema(),
       buildRootWebSiteSchema(),
       buildSoftwareApplicationSchema(),
     ],
   };
   ```
3. Replace the 3 separate `<script type="application/ld+json">` tags with a single one rendering `rootGraph`.

**MatchPageSchema.tsx changes:**
1. Import `ORGANIZATION_ID`, `WEBSITE_ID` from `@/lib/seo/schema/root`
2. Remove the inline Organization object (lines 60-67) from the @graph array
3. Remove the inline WebSite object (lines 68-75) from the @graph array
4. Update Article author/publisher to use @id reference only:
   ```typescript
   author: { '@id': ORGANIZATION_ID },
   publisher: { '@id': ORGANIZATION_ID },
   ```
   (Remove the redundant `'@type': 'Organization'` from author and publisher since the root @graph already defines it)
5. Update WebPage `isPartOf` to use: `{ '@id': WEBSITE_ID }` (already correct, just verify)
6. The @graph should now contain only: SportsEvent, WebPage, Article, FAQPage, BreadcrumbList (5 items, not 7)

**graph.ts changes:**
1. Import `ORGANIZATION_ID` from `@/lib/seo/schema/root`
2. Replace the inline organizationSchema object (which has OLD "bettingsoccer.com" branding) with an @id reference: `{ '@id': ORGANIZATION_ID }`
3. The graphItems array should start with the @id reference stub, then eventSchema, articleSchema, and optional breadcrumbs
4. Note: graph.ts is used by `/matches/[id]/stats/page.tsx` - a legacy route. The Organization will come from root layout's @graph, so the stub reference is sufficient.
  </action>
  <verify>
1. `npm run build` succeeds (or `npx next build --webpack` as fallback)
2. `grep -c 'application/ld+json' src/app/layout.tsx` returns 1 (single script tag)
3. `grep 'Organization' src/components/MatchPageSchema.tsx` shows only @id references, no full Organization objects
4. `grep 'bettingsoccer' src/lib/seo/schema/graph.ts` returns no matches
  </verify>
  <done>Root layout renders single @graph with Organization+WebSite+SoftwareApplication. MatchPageSchema no longer includes Organization or WebSite in its @graph. graph.ts uses ORGANIZATION_ID reference instead of inline Organization with old branding.</done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build` (or webpack fallback)
2. Root layout has exactly 1 JSON-LD script tag (not 3)
3. MatchPageSchema @graph has 5 entities (SportsEvent, WebPage, Article, FAQPage, BreadcrumbList) - no Organization or WebSite
4. graph.ts references ORGANIZATION_ID constant, not inline Organization
5. No "bettingsoccer" string appears in any schema file
</verification>

<success_criteria>
- SCHEMA-01 addressed: Organization/WebSite rendered once in root layout, referenced by @id elsewhere
- Root layout: 3 scripts → 1 @graph script
- MatchPageSchema: 7 @graph items → 5 @graph items
- graph.ts: "bettingsoccer.com" → ORGANIZATION_ID reference
- All exported @id constants match across files
</success_criteria>

<output>
After completion, create `.planning/phases/47-structured-data-validation/47-01-SUMMARY.md`
</output>
