---
phase: 15-performance-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/leagues/[slug]/[match]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Match page serves cached HTML from edge/CDN on repeat requests"
    - "ISR revalidates page in background after 60 seconds"
    - "Page no longer renders dynamically on every request (TTFB drops from ~800ms to <200ms cached)"
  artifacts:
    - path: "src/app/leagues/[slug]/[match]/page.tsx"
      provides: "ISR-enabled match page"
      contains: "export const revalidate = 60"
      not_contains: "force-dynamic"
  key_links:
    - from: "page.tsx"
      to: "Next.js Data Cache"
      via: "revalidate export"
      pattern: "export const revalidate"
---

<objective>
Enable ISR (Incremental Static Regeneration) on match pages by removing the `force-dynamic` export that blocks all caching.

Purpose: The research identified that `export const dynamic = 'force-dynamic'` combined with `export const revalidate = 60` creates a conflict where force-dynamic wins, disabling ISR entirely. This causes every request to trigger full SSR (~800ms TTFB). Removing force-dynamic enables Next.js to cache the page and serve from edge/CDN, reducing TTFB to <200ms for cached requests.

Output: Match page with ISR enabled (60s revalidation interval)
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-performance-optimization/15-RESEARCH.md

Primary reference:
@src/app/leagues/[slug]/[match]/page.tsx (lines 32-33)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove force-dynamic export and verify ISR configuration</name>
  <files>src/app/leagues/[slug]/[match]/page.tsx</files>
  <action>
    1. Remove line 32: `export const dynamic = 'force-dynamic';`
    2. Add line at same location: `export const revalidate = 60; // ISR: 60s for scheduled/live matches`
    3. Verify no other conflicting exports exist (e.g., no `dynamic = 'error'` or similar)

    The page currently has:
    ```typescript
    export const dynamic = 'force-dynamic';
    ```

    Replace with:
    ```typescript
    export const revalidate = 60; // ISR: 60s for scheduled/live matches
    ```

    WHY: force-dynamic tells Next.js to render the page dynamically on every request, ignoring any revalidate setting. Removing it allows ISR to cache the page HTML and serve from edge, dramatically reducing TTFB.
  </action>
  <verify>
    1. `grep -n "force-dynamic" src/app/leagues/[slug]/[match]/page.tsx` returns no matches
    2. `grep -n "export const revalidate" src/app/leagues/[slug]/[match]/page.tsx` shows line with `= 60`
    3. `npm run build` succeeds without errors
  </verify>
  <done>
    - Line `export const dynamic = 'force-dynamic'` removed from match page
    - Line `export const revalidate = 60` present in match page
    - Build passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify ISR behavior in production build</name>
  <files>src/app/leagues/[slug]/[match]/page.tsx</files>
  <action>
    1. Run production build: `npm run build`
    2. Examine build output for match page route - should show ISR/SSG indicator, not "Dynamic page"
    3. Check that no runtime errors occur related to caching

    Expected build output should show the route as ISR-capable (not "lambda" or "dynamic"):
    ```
    /leagues/[slug]/[match]    ISR: 60s
    ```

    If output shows "Dynamic" or "lambda", there may be other code paths forcing dynamic rendering (e.g., cookies(), headers(), or other dynamic functions). In that case, investigate and document.
  </action>
  <verify>
    1. `npm run build` completes successfully
    2. Build output for `/leagues/[slug]/[match]` route indicates ISR (not dynamic/lambda)
    3. No new TypeScript or build errors
  </verify>
  <done>
    - Production build succeeds
    - Build output confirms ISR enabled for match pages
    - No regression in build process
  </done>
</task>

</tasks>

<verification>
1. `grep "force-dynamic" src/app/leagues/[slug]/[match]/page.tsx` returns nothing
2. `grep "revalidate = 60" src/app/leagues/[slug]/[match]/page.tsx` returns match
3. `npm run build` succeeds and shows ISR indicator for match route
</verification>

<success_criteria>
- force-dynamic export removed from match page
- revalidate = 60 export present
- Build passes with ISR indicator for /leagues/[slug]/[match] route
</success_criteria>

<output>
After completion, create `.planning/phases/15-performance-optimization/15-01-SUMMARY.md`
</output>
