---
phase: 09-critical-seo-errors
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/football/competitions.ts
  - src/app/leagues/[slug]/page.tsx
  - src/app/leagues/[slug]/[match]/page.tsx
  - src/lib/db/queries.ts
autonomous: true

must_haves:
  truths:
    - "/leagues/epl returns 200 with Premier League content"
    - "/leagues/premier-league redirects to /leagues/epl with 301"
    - "/leagues/ucl returns 200 with Champions League content"
    - "/leagues/champions-league redirects to /leagues/ucl with 301"
    - "Match pages under alias slugs redirect to canonical URLs"
  artifacts:
    - path: "src/lib/football/competitions.ts"
      provides: "Alias lookup function and aliases field"
      exports: ["getCompetitionByIdOrAlias"]
      contains: "aliases"
    - path: "src/app/leagues/[slug]/page.tsx"
      provides: "League page with alias support and canonical redirect"
      contains: "getCompetitionByIdOrAlias"
    - path: "src/app/leagues/[slug]/[match]/page.tsx"
      provides: "Match page with alias support"
      contains: "getCompetitionByIdOrAlias"
  key_links:
    - from: "src/app/leagues/[slug]/page.tsx"
      to: "getCompetitionByIdOrAlias"
      via: "import and call"
      pattern: "getCompetitionByIdOrAlias\\(slug\\)"
---

<objective>
Add slug alias system to competition config enabling both short IDs (epl, ucl) and long-form slugs (premier-league, champions-league) to resolve to the same competition.

Purpose: Eliminates 7 404 errors in sitemap by making long-form slugs work as aliases, while maintaining short IDs as canonical URLs for SEO.
Output: Working alias lookup system with 301 redirects from aliases to canonical URLs.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-critical-seo-errors/09-CONTEXT.md
@.planning/phases/09-critical-seo-errors/09-RESEARCH.md

@src/lib/football/competitions.ts
@src/app/leagues/[slug]/page.tsx
@src/app/leagues/[slug]/[match]/page.tsx
@src/lib/db/queries.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add aliases field and getCompetitionByIdOrAlias function</name>
  <files>src/lib/football/competitions.ts</files>
  <action>
1. Add `aliases?: string[]` field to `CompetitionConfig` interface

2. Add aliases to each competition that has a mismatch between ID and common SEO slug:
   - ucl: ['champions-league']
   - uel: ['europa-league']
   - epl: ['premier-league']
   - laliga: ['la-liga']
   - seriea: ['serie-a']
   - ligue1: ['ligue-1']
   Note: bundesliga, eredivisie, superlig don't need aliases (ID matches slug)

3. Add new lookup function `getCompetitionByIdOrAlias(slug: string)`:
   - First try exact ID match via existing find
   - If not found, search aliases array
   - Return undefined if neither matches
  </action>
  <verify>
Run TypeScript check: `npx tsc --noEmit src/lib/football/competitions.ts`
Grep for function export: `grep -n "getCompetitionByIdOrAlias" src/lib/football/competitions.ts`
  </verify>
  <done>
CompetitionConfig interface has aliases field.
All 6 competitions with slug mismatches have aliases defined.
getCompetitionByIdOrAlias function exported and handles both ID and alias lookup.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update league page to use alias lookup with canonical redirect</name>
  <files>src/app/leagues/[slug]/page.tsx</files>
  <action>
1. Import `getCompetitionByIdOrAlias` instead of (or alongside) `getCompetitionById`

2. In `generateMetadata`:
   - Replace `getCompetitionById(slug)` with `getCompetitionByIdOrAlias(slug)`
   - If competition found AND slug !== competition.id, use competition.id in canonical URL

3. In `LeaguePage` component:
   - Replace `getCompetitionById(slug)` with `getCompetitionByIdOrAlias(slug)`
   - After finding competition, check if `slug !== competition.id`
   - If alias was used, call `redirect(\`/leagues/\${competition.id}\`, RedirectType.permanent)` from next/navigation
   - Pass `competition.id` (not slug) to LeagueHubContent and structured data

Import RedirectType from 'next/navigation' if needed for permanent (301) redirect.
  </action>
  <verify>
Run TypeScript check: `npx tsc --noEmit src/app/leagues/[slug]/page.tsx`
Start dev server and verify:
- `curl -I http://localhost:3000/leagues/epl` returns 200
- `curl -I http://localhost:3000/leagues/premier-league` returns 308 redirect to /leagues/epl
  </verify>
  <done>
League page uses getCompetitionByIdOrAlias for lookup.
Accessing /leagues/premier-league redirects to /leagues/epl with permanent redirect.
Canonical URLs in metadata use competition.id not alias.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update match page and query to support alias lookups</name>
  <files>src/app/leagues/[slug]/[match]/page.tsx, src/lib/db/queries.ts</files>
  <action>
1. In `src/lib/db/queries.ts`, create a new function `getMatchByCompetitionIdOrSlug`:
   - Accept (competitionIdOrSlug: string, matchSlug: string)
   - First try to match competitions.id (static config ID)
   - If no result, fall back to matching competitions.slug (database slug)
   - Return same shape as getMatchBySlug

2. In `src/app/leagues/[slug]/[match]/page.tsx`:
   - Import getCompetitionByIdOrAlias from competitions.ts
   - In both generateMetadata and MatchPage:
     - First resolve competition via getCompetitionByIdOrAlias(slug)
     - If competition found AND slug !== competition.id:
       - Redirect to `/leagues/${competition.id}/${match}` with permanent redirect
     - Use the new query function or adjust existing query to work with competition.id

3. Update internal links in the match page that use `competition.slug`:
   - Lines referencing `/leagues/${competition.slug}` should use `competition.id` from static config
   - Since we have the competition from config after lookup, use competition.id for all link generation
  </action>
  <verify>
Run TypeScript check: `npx tsc --noEmit src/app/leagues/[slug]/[match]/page.tsx src/lib/db/queries.ts`
Verify match page loads: test with a known match slug in dev
  </verify>
  <done>
Match pages under alias slugs redirect to canonical competition ID URLs.
Links within match page use competition.id not database slug.
Query function supports both competition ID and database slug lookups.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `curl -I http://localhost:3000/leagues/epl` - expect 200
2. `curl -I http://localhost:3000/leagues/premier-league` - expect 308/301 redirect to /leagues/epl
3. `curl -I http://localhost:3000/leagues/ucl` - expect 200
4. `curl -I http://localhost:3000/leagues/champions-league` - expect 308/301 redirect to /leagues/ucl
5. Verify in browser that league content loads correctly after redirect
</verification>

<success_criteria>
- All 7 long-form slug URLs redirect to their canonical short-form equivalents
- No 404 errors when accessing long-form URLs
- Canonical URLs in metadata and structured data use short IDs
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-critical-seo-errors/09-01-SUMMARY.md`
</output>
