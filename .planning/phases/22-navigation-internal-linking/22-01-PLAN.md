---
phase: 22-navigation-internal-linking
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/navigation/hover-prefetch-link.tsx
  - src/components/navigation/bottom-nav.tsx
  - src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "Mobile user sees bottom navigation bar with 4 primary destinations"
    - "Navigation links prefetch only on hover/touch, not on viewport entry"
    - "Touch targets meet 44px minimum height"
  artifacts:
    - path: "src/components/navigation/hover-prefetch-link.tsx"
      provides: "Intent-based prefetch wrapper"
      exports: ["HoverPrefetchLink"]
    - path: "src/components/navigation/bottom-nav.tsx"
      provides: "Mobile bottom navigation"
      exports: ["BottomNav"]
    - path: "src/app/globals.css"
      provides: "Safe area padding utility"
      contains: "safe-area-pb"
  key_links:
    - from: "src/components/navigation/bottom-nav.tsx"
      to: "Next.js Link"
      via: "HoverPrefetchLink wrapper"
      pattern: "HoverPrefetchLink"
---

<objective>
Create the core navigation infrastructure components: HoverPrefetchLink for intent-based prefetching and BottomNav for mobile-first navigation.

Purpose: Establishes reusable navigation components that will be deployed across all pages. HoverPrefetchLink reduces unnecessary prefetch requests (research shows default viewport prefetching can trigger 1MB+ on scroll). BottomNav provides thumb-friendly mobile navigation (21% faster task completion per research).

Output: Two reusable components ready for integration in Plan 04.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-navigation-internal-linking/22-RESEARCH.md

# Existing patterns to follow
@src/components/navigation.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create HoverPrefetchLink component</name>
  <files>src/components/navigation/hover-prefetch-link.tsx</files>
  <action>
Create a client component that wraps Next.js Link with intent-based prefetching:

1. Create new file at src/components/navigation/hover-prefetch-link.tsx
2. Mark as 'use client' (requires useState for prefetch state)
3. Accept all Link props via ComponentProps<typeof Link>
4. Default prefetch={false}, enable on mouseEnter or touchStart
5. Use useState to track shouldPrefetch boolean
6. When shouldPrefetch is true, pass prefetch={undefined} to use Next.js default
7. Forward onMouseEnter and onTouchStart handlers to allow custom handlers

Pattern from research:
```typescript
'use client';

import Link from 'next/link';
import { useState, type ComponentProps } from 'react';

type HoverPrefetchLinkProps = ComponentProps<typeof Link>;

export function HoverPrefetchLink({
  children,
  onMouseEnter,
  onTouchStart,
  ...props
}: HoverPrefetchLinkProps) {
  const [shouldPrefetch, setShouldPrefetch] = useState(false);

  const handleInteraction = () => {
    if (!shouldPrefetch) {
      setShouldPrefetch(true);
    }
  };

  return (
    <Link
      {...props}
      prefetch={shouldPrefetch ? undefined : false}
      onMouseEnter={(e) => {
        handleInteraction();
        onMouseEnter?.(e);
      }}
      onTouchStart={(e) => {
        handleInteraction();
        onTouchStart?.(e);
      }}
    >
      {children}
    </Link>
  );
}
```
  </action>
  <verify>
TypeScript compilation: `npx tsc --noEmit` passes without errors in the new file.
Component exports correctly: `grep -l "export function HoverPrefetchLink" src/components/navigation/hover-prefetch-link.tsx`
  </verify>
  <done>
HoverPrefetchLink component exists with proper types, prefetch={false} default, and hover/touch handlers.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create BottomNav component and safe area CSS</name>
  <files>
src/components/navigation/bottom-nav.tsx
src/app/globals.css
  </files>
  <action>
Create mobile bottom navigation bar following research patterns:

1. Add safe area utility to globals.css:
```css
/* Safe area for mobile bottom navigation */
.safe-area-pb {
  padding-bottom: env(safe-area-inset-bottom, 0);
}
```

2. Create src/components/navigation/bottom-nav.tsx:
- Mark as 'use client' (needs usePathname)
- Use same navItems as existing navigation.tsx: Home, Matches, Leaderboard, Blog
- Import icons from lucide-react: Home, Calendar, Trophy, FileText
- Fixed position at bottom, z-50, hidden on md+ (md:hidden)
- Use HoverPrefetchLink instead of regular Link
- 44px minimum touch targets (min-h-[44px])
- Icons: 20px (h-5 w-5), Labels: text-xs
- Active state: text-primary, Inactive: text-muted-foreground
- Background: bg-background/95 backdrop-blur-md border-t
- Include safe-area-pb class for iOS home indicator

Key differences from header nav:
- Shows on mobile only (md:hidden)
- Icons with labels below (not beside)
- Fixed at bottom of viewport
- Uses HoverPrefetchLink for prefetch optimization

Use aria-current="page" for active item, aria-label on nav element.
  </action>
  <verify>
1. CSS utility exists: `grep "safe-area-pb" src/app/globals.css`
2. Component compiles: `npx tsc --noEmit`
3. Uses HoverPrefetchLink: `grep "HoverPrefetchLink" src/components/navigation/bottom-nav.tsx`
4. Has md:hidden: `grep "md:hidden" src/components/navigation/bottom-nav.tsx`
5. Has min-h-[44px]: `grep "min-h-\[44px\]" src/components/navigation/bottom-nav.tsx`
  </verify>
  <done>
BottomNav component exists with 4 items, proper touch targets, safe area padding, and md:hidden visibility.
  </done>
</task>

</tasks>

<verification>
1. Both components compile without TypeScript errors
2. HoverPrefetchLink has prefetch={false} default with hover/touch enabling
3. BottomNav has 4 navigation items matching header nav
4. BottomNav is hidden on md+ breakpoints
5. Touch targets are 44px minimum
6. Safe area CSS utility is available
</verification>

<success_criteria>
- HoverPrefetchLink wrapper component ready for use in navigation links
- BottomNav component ready for integration in layout.tsx (Plan 04)
- Safe area padding utility available in globals.css
- Both components follow existing codebase patterns (lucide icons, cn utility, OKLCH colors)
</success_criteria>

<output>
After completion, create `.planning/phases/22-navigation-internal-linking/22-01-SUMMARY.md`
</output>
