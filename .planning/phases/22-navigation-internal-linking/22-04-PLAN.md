---
phase: 22-navigation-internal-linking
plan: 04
type: execute
wave: 2
depends_on: ["22-01", "22-02", "22-03"]
files_modified:
  - src/app/layout.tsx
  - src/app/leagues/[competitionSlug]/page.tsx
  - src/app/leagues/[competitionSlug]/[matchSlug]/page.tsx
  - src/app/blog/[slug]/page.tsx
  - src/app/leaderboard/page.tsx
  - src/app/models/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Mobile users see bottom navigation bar on all pages"
    - "All page types show visual breadcrumbs"
    - "Match and blog content contains entity links"
    - "Main content has padding to avoid bottom nav overlap"
  artifacts:
    - path: "src/app/layout.tsx"
      provides: "Root layout with BottomNav and content padding"
      contains: "BottomNav"
    - path: "src/app/leagues/[competitionSlug]/[matchSlug]/page.tsx"
      provides: "Match page with breadcrumbs and entity linking"
      contains: "BreadcrumbsWithSchema"
    - path: "src/app/blog/[slug]/page.tsx"
      provides: "Blog page with breadcrumbs"
      contains: "BreadcrumbsWithSchema"
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/components/navigation/bottom-nav.tsx"
      via: "BottomNav import"
      pattern: "BottomNav"
    - from: "src/app/leagues/[competitionSlug]/[matchSlug]/page.tsx"
      to: "src/lib/navigation/breadcrumb-utils.ts"
      via: "buildMatchBreadcrumbs"
      pattern: "buildMatchBreadcrumbs"
---

<objective>
Integrate all navigation components created in Wave 1 across the codebase: BottomNav in layout, breadcrumbs on all page types, and entity linking in content.

Purpose: Deploy the navigation infrastructure to make it functional for users. This completes NAVL-01 (bottom nav), NAVL-02 (breadcrumbs), and NAVL-04 (entity linking).

Output: All pages have consistent navigation with breadcrumbs and entity-linked content where appropriate.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Plans this depends on
@.planning/phases/22-navigation-internal-linking/22-01-PLAN.md
@.planning/phases/22-navigation-internal-linking/22-02-PLAN.md
@.planning/phases/22-navigation-internal-linking/22-03-PLAN.md

# Files to modify
@src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add BottomNav to root layout</name>
  <files>src/app/layout.tsx</files>
  <action>
Integrate BottomNav into the root layout:

1. Import BottomNav from @/components/navigation/bottom-nav
2. Add BottomNav after Footer, before closing Providers
3. Add pb-20 md:pb-0 to main element to prevent content overlap on mobile

Changes to layout.tsx:
```tsx
// Add import
import { BottomNav } from "@/components/navigation/bottom-nav";

// In the JSX, modify main element:
<main className="flex-1 container mx-auto px-4 py-6 max-w-7xl pb-20 md:pb-0">

// Add BottomNav after Footer:
<Footer />
<BottomNav />
```

The BottomNav will render fixed at bottom on mobile (md:hidden handles desktop).
  </action>
  <verify>
1. Import exists: `grep "import.*BottomNav" src/app/layout.tsx`
2. Component used: `grep "<BottomNav" src/app/layout.tsx`
3. Main has padding: `grep "pb-20 md:pb-0" src/app/layout.tsx`
4. Dev server builds: `npm run build 2>&1 | grep -i error || echo "Build OK"`
  </verify>
  <done>
BottomNav appears on mobile viewport with proper content padding to prevent overlap.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add breadcrumbs to all page types</name>
  <files>
src/app/leagues/[competitionSlug]/page.tsx
src/app/leagues/[competitionSlug]/[matchSlug]/page.tsx
src/app/blog/[slug]/page.tsx
src/app/leaderboard/page.tsx
src/app/models/[id]/page.tsx
  </files>
  <action>
Add BreadcrumbsWithSchema to each page type using the builder utilities:

**1. League page (src/app/leagues/[competitionSlug]/page.tsx):**
```tsx
import { BreadcrumbsWithSchema } from '@/components/navigation/breadcrumbs';
import { buildLeagueBreadcrumbs } from '@/lib/navigation/breadcrumb-utils';

// In component, after getting competition data:
const breadcrumbs = buildLeagueBreadcrumbs(competition.name, competitionSlug);

// In JSX, at top of page content (after any schema):
<BreadcrumbsWithSchema items={breadcrumbs} />
```

**2. Match page (src/app/leagues/[competitionSlug]/[matchSlug]/page.tsx):**
```tsx
import { BreadcrumbsWithSchema } from '@/components/navigation/breadcrumbs';
import { buildMatchBreadcrumbs } from '@/lib/navigation/breadcrumb-utils';

// In component:
const matchTitle = `${match.homeTeam} vs ${match.awayTeam}`;
const breadcrumbs = buildMatchBreadcrumbs(
  competition.name,
  competitionSlug,
  matchTitle,
  matchSlug
);

// In JSX, at top of main content area:
<BreadcrumbsWithSchema items={breadcrumbs} />
```

**3. Blog page (src/app/blog/[slug]/page.tsx):**
```tsx
import { BreadcrumbsWithSchema } from '@/components/navigation/breadcrumbs';
import { buildBlogBreadcrumbs } from '@/lib/navigation/breadcrumb-utils';

// In component:
const breadcrumbs = buildBlogBreadcrumbs(post.title, slug);

// In JSX:
<BreadcrumbsWithSchema items={breadcrumbs} />
```

**4. Leaderboard page (src/app/leaderboard/page.tsx):**
```tsx
import { BreadcrumbsWithSchema } from '@/components/navigation/breadcrumbs';
import { buildLeaderboardBreadcrumbs } from '@/lib/navigation/breadcrumb-utils';

// In component:
const breadcrumbs = buildLeaderboardBreadcrumbs();

// In JSX:
<BreadcrumbsWithSchema items={breadcrumbs} />
```

**5. Model page (src/app/models/[id]/page.tsx):**
```tsx
import { BreadcrumbsWithSchema } from '@/components/navigation/breadcrumbs';
import { buildModelBreadcrumbs } from '@/lib/navigation/breadcrumb-utils';

// In component:
const breadcrumbs = buildModelBreadcrumbs(model.displayName, id);

// In JSX:
<BreadcrumbsWithSchema items={breadcrumbs} />
```

**Placement rule:** Breadcrumbs go at the very top of the page content, before any headings or content sections. If the page already has a BreadcrumbSchema, replace it with BreadcrumbsWithSchema which combines both.
  </action>
  <verify>
For each page file, verify:
1. Import exists: `grep "BreadcrumbsWithSchema" <file>`
2. Builder import: `grep "build.*Breadcrumbs" <file>`
3. Component used: `grep "<BreadcrumbsWithSchema" <file>`

Full check:
```bash
for page in "src/app/leagues/\[competitionSlug\]/page.tsx" "src/app/leagues/\[competitionSlug\]/\[matchSlug\]/page.tsx" "src/app/blog/\[slug\]/page.tsx" "src/app/leaderboard/page.tsx" "src/app/models/\[id\]/page.tsx"; do
  echo "Checking $page..."
  grep -l "BreadcrumbsWithSchema" "$page" || echo "MISSING in $page"
done
```
  </verify>
  <done>
All 5 page types have BreadcrumbsWithSchema with appropriate builder utilities.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add entity linking to match content</name>
  <files>src/app/leagues/[competitionSlug]/[matchSlug]/page.tsx</files>
  <action>
Add entity linking to AI-generated content on match pages:

1. Import EntityLinkedText component:
```tsx
import { EntityLinkedText } from '@/components/content/entity-linked-text';
```

2. Get active models for entity linking:
```tsx
import { getActiveModels } from '@/lib/db/queries';

// In the data fetching section:
const activeModels = await getActiveModels();
```

3. Identify content sections that should have entity linking:
- Match preview/narrative content
- Post-match roundup content
- Any AI-generated analysis text

4. Wrap text content with EntityLinkedText:
```tsx
// Instead of plain text:
<p>{content.preview}</p>

// Use entity linking:
<EntityLinkedText
  text={content.preview}
  teams={[match.homeTeam, match.awayTeam]}
  models={activeModels.map(m => ({ id: m.id, displayName: m.displayName }))}
  maxLinks={5}
/>
```

5. Apply to these content areas (if they exist in the page):
- MatchContentSection preview text
- MatchTLDR content
- Post-match roundup text
- Any narrative content blocks

NOTE: Only apply entity linking to narrative/text content, NOT to:
- Structured data (scores, stats)
- Headings
- Navigation elements
- Button text
  </action>
  <verify>
1. EntityLinkedText imported: `grep "EntityLinkedText" src/app/leagues/\[competitionSlug\]/\[matchSlug\]/page.tsx`
2. getActiveModels used: `grep "getActiveModels" src/app/leagues/\[competitionSlug\]/\[matchSlug\]/page.tsx`
3. Component used in JSX: `grep "<EntityLinkedText" src/app/leagues/\[competitionSlug\]/\[matchSlug\]/page.tsx`
4. Build succeeds: `npm run build 2>&1 | grep -i error || echo "Build OK"`
  </verify>
  <done>
Match page content has automated entity linking for team names, competitions, and models.
  </done>
</task>

</tasks>

<verification>
1. BottomNav visible on mobile, hidden on desktop
2. Breadcrumbs appear at top of all page types
3. Entity links work in match content (team names link to search, competitions link to league pages)
4. Content doesn't overlap with bottom nav on mobile
5. All pages build without errors
</verification>

<success_criteria>
- Mobile users see 4-item bottom navigation bar
- All 5 page types have visual breadcrumbs with schema
- Match content contains automated entity links
- No layout issues from bottom nav on mobile
</success_criteria>

<output>
After completion, create `.planning/phases/22-navigation-internal-linking/22-04-SUMMARY.md`
</output>
