---
phase: 22-navigation-internal-linking
plan: 05
type: execute
wave: 3
depends_on: ["22-04"]
files_modified:
  - src/components/navigation/navigation.tsx
  - src/components/match/related-matches-widget.tsx
  - src/components/model/related-models-widget.tsx
  - src/components/blog/related-articles.tsx
autonomous: false

must_haves:
  truths:
    - "All navigation links use HoverPrefetchLink for optimized prefetching"
    - "Related content widgets use HoverPrefetchLink"
    - "User experiences instant navigation on hover/touch"
  artifacts:
    - path: "src/components/navigation.tsx"
      provides: "Updated header nav with HoverPrefetchLink"
      contains: "HoverPrefetchLink"
    - path: "src/components/match/related-matches-widget.tsx"
      provides: "Related matches with optimized prefetch"
      contains: "HoverPrefetchLink"
  key_links:
    - from: "src/components/navigation.tsx"
      to: "src/components/navigation/hover-prefetch-link.tsx"
      via: "HoverPrefetchLink import"
      pattern: "HoverPrefetchLink"
---

<objective>
Upgrade existing navigation and related content widgets to use HoverPrefetchLink for optimized prefetching, then verify all Phase 22 requirements are met.

Purpose: Completes NAVL-05 (prefetch on hover/touch) by replacing standard Link with HoverPrefetchLink in navigation-heavy areas. Reduces unnecessary prefetch requests while maintaining instant navigation feel.

Output: All navigation uses optimized prefetching; human verification confirms all 5 requirements met.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Components to update
@src/components/navigation.tsx
@src/components/match/related-matches-widget.tsx
@src/components/model/related-models-widget.tsx
@src/components/blog/related-articles.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update header navigation with HoverPrefetchLink</name>
  <files>src/components/navigation.tsx</files>
  <action>
Replace Link with HoverPrefetchLink in the header navigation:

1. Add import for HoverPrefetchLink:
```tsx
import { HoverPrefetchLink } from '@/components/navigation/hover-prefetch-link';
```

2. Replace the Link component in navItems.map with HoverPrefetchLink:
```tsx
// Change from:
<Link
  key={item.href}
  href={item.href}
  ...
>

// To:
<HoverPrefetchLink
  key={item.href}
  href={item.href}
  ...
>
```

3. Keep all existing className, aria-current, aria-label attributes
4. The logo Link can remain as regular Link (single item, always prefetched is fine)
  </action>
  <verify>
1. Import exists: `grep "HoverPrefetchLink" src/components/navigation.tsx`
2. Used in nav: `grep "<HoverPrefetchLink" src/components/navigation.tsx`
3. Compiles: `npx tsc --noEmit`
  </verify>
  <done>
Header navigation uses HoverPrefetchLink for all nav items.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update related content widgets with HoverPrefetchLink</name>
  <files>
src/components/match/related-matches-widget.tsx
src/components/model/related-models-widget.tsx
src/components/blog/related-articles.tsx
  </files>
  <action>
Update all three related content widgets to use HoverPrefetchLink:

**1. related-matches-widget.tsx:**
- Add import: `import { HoverPrefetchLink } from '@/components/navigation/hover-prefetch-link';`
- Replace Link with HoverPrefetchLink in the relatedMatches.map
- Keep all existing styling and structure

**2. related-models-widget.tsx:**
- Add import: `import { HoverPrefetchLink } from '@/components/navigation/hover-prefetch-link';`
- Replace Link with HoverPrefetchLink for model cards
- Keep existing styling

**3. related-articles.tsx:**
- Add import: `import { HoverPrefetchLink } from '@/components/navigation/hover-prefetch-link';`
- Replace Link with HoverPrefetchLink for article cards
- Keep existing styling

These widgets often show 3-5 items each. With multiple widgets on a page, that could be 10-15 prefetch requests on viewport entry. HoverPrefetchLink ensures prefetch only happens when user shows intent.
  </action>
  <verify>
```bash
for widget in "src/components/match/related-matches-widget.tsx" "src/components/model/related-models-widget.tsx" "src/components/blog/related-articles.tsx"; do
  echo "Checking $widget..."
  grep -l "HoverPrefetchLink" "$widget" && echo "OK" || echo "MISSING"
done
```
  </verify>
  <done>
All three related content widgets use HoverPrefetchLink.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Human verification of Phase 22 requirements</name>
  <what-built>
Complete navigation and internal linking system:
- NAVL-01: Mobile bottom navigation bar
- NAVL-02: Visual breadcrumbs on all pages
- NAVL-03: Related content widgets (already existed, now with optimized prefetch)
- NAVL-04: Entity linking in match content
- NAVL-05: HoverPrefetchLink for optimized prefetching
  </what-built>
  <how-to-verify>
Start dev server: `npm run dev`

**NAVL-01 - Bottom Navigation:**
1. Open http://localhost:3000 in Chrome DevTools mobile view (iPhone 14 Pro)
2. Verify bottom nav appears with 4 items: Home, Matches, Leaders, Blog
3. Verify items are tappable (44px+ touch targets)
4. Verify nav is hidden when viewport > 768px (tablet/desktop)
5. Verify safe area padding on iPhone X+ (notch area)

**NAVL-02 - Breadcrumbs:**
1. Navigate to a match page (e.g., /leagues/epl/arsenal-vs-chelsea-2026-02-01)
2. Verify breadcrumbs show: Home > Premier League > Arsenal vs Chelsea
3. Navigate to /leaderboard - verify breadcrumbs: Home > Leaderboard
4. Navigate to /blog/some-post - verify breadcrumbs: Home > Blog > Post Title
5. Verify last item is not a link (current page)

**NAVL-03 - Related Content:**
1. On match page, scroll to Related Matches widget
2. Verify it shows related matches from same competition
3. On model page (/models/[id]), verify Related Models widget appears

**NAVL-04 - Entity Linking:**
1. On a match page with AI content/preview
2. Look for team names, competition names, or model names in the text
3. Verify they are clickable links with appropriate destinations
4. Verify each entity is linked only once (no duplicate links)
5. Verify max ~5 links per content block

**NAVL-05 - Prefetch Optimization:**
1. Open Network tab in DevTools
2. On match list page, hover over a match link
3. Verify prefetch request appears ONLY after hover (not on scroll/viewport entry)
4. Verify touch triggers prefetch on mobile
  </how-to-verify>
  <resume-signal>
Type "approved" if all 5 requirements verified, or describe specific issues found.
  </resume-signal>
</task>

</tasks>

<verification>
1. Header nav uses HoverPrefetchLink
2. All 3 related widgets use HoverPrefetchLink
3. All 5 NAVL requirements pass human verification
4. No TypeScript/build errors
</verification>

<success_criteria>
- NAVL-01: Mobile bottom nav visible and functional
- NAVL-02: Breadcrumbs on all page types
- NAVL-03: Related content widgets working
- NAVL-04: Entity links in content
- NAVL-05: Prefetch only on hover/touch
</success_criteria>

<output>
After completion, create `.planning/phases/22-navigation-internal-linking/22-05-SUMMARY.md`
</output>
