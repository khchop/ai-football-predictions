---
phase: 08-ux-transparency
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/tooltip.tsx
  - src/components/accuracy-display.tsx
  - src/app/layout.tsx
  - package.json
autonomous: true

must_haves:
  truths:
    - "Tooltip component renders on hover/focus with accessible keyboard navigation"
    - "AccuracyDisplay shows format X/Y (Z%) with HelpCircle icon"
    - "TooltipProvider wraps all children in layout.tsx"
  artifacts:
    - path: "src/components/ui/tooltip.tsx"
      provides: "Radix tooltip primitives with Tailwind styling"
      exports: ["Tooltip", "TooltipTrigger", "TooltipContent", "TooltipProvider"]
    - path: "src/components/accuracy-display.tsx"
      provides: "Reusable accuracy display with denominator and methodology tooltip"
      exports: ["AccuracyDisplay"]
    - path: "src/app/layout.tsx"
      provides: "TooltipProvider wrapper for global tooltip configuration"
      contains: "TooltipProvider"
  key_links:
    - from: "src/components/accuracy-display.tsx"
      to: "src/components/ui/tooltip.tsx"
      via: "import { Tooltip, TooltipTrigger, TooltipContent }"
      pattern: "import.*from.*@/components/ui/tooltip"
    - from: "src/app/layout.tsx"
      to: "src/components/ui/tooltip.tsx"
      via: "import { TooltipProvider }"
      pattern: "TooltipProvider"
---

<objective>
Create tooltip infrastructure and reusable AccuracyDisplay component for UX transparency

Purpose: Establishes the foundation for showing accuracy metrics with denominators and explanatory tooltips across the application. Users will see "81/160 (50.6%)" instead of just "50.6%", with a tooltip explaining what the metric means.

Output: Three new/updated files providing tooltip primitives and AccuracyDisplay component ready for integration
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-ux-transparency/08-RESEARCH.md

# Source patterns to follow
@src/components/ui/dialog.tsx
@src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Radix tooltip and create tooltip.tsx component</name>
  <files>
    package.json
    src/components/ui/tooltip.tsx
  </files>
  <action>
1. Run `npm install @radix-ui/react-tooltip` to add the dependency

2. Create `src/components/ui/tooltip.tsx` following the shadcn/ui pattern:
   - "use client" directive at top
   - Import TooltipPrimitive from @radix-ui/react-tooltip
   - Export TooltipProvider, Tooltip, TooltipTrigger, TooltipContent
   - TooltipContent should use forwardRef pattern with these classes:
     - z-50 for layering
     - bg-foreground text-background for inverted color scheme
     - px-3 py-1.5 text-xs rounded-md
     - animate-in/animate-out with fade and zoom transitions
     - data-[side=*] slide-in animations for each direction
   - sideOffset default to 4
   - Use cn() from @/lib/utils for className merging

3. Pattern reference from existing dialog.tsx for consistent styling approach
  </action>
  <verify>
    - `npm ls @radix-ui/react-tooltip` shows version ^1.1.8 or higher
    - File exists at src/components/ui/tooltip.tsx
    - File exports: Tooltip, TooltipTrigger, TooltipContent, TooltipProvider
    - TypeScript compiles without errors: `npx tsc --noEmit 2>&1 | grep -i tooltip || echo "No tooltip errors"`
  </verify>
  <done>
    - @radix-ui/react-tooltip installed in dependencies
    - tooltip.tsx follows shadcn/ui pattern with Tailwind styling
    - All four exports available for import
  </done>
</task>

<task type="auto">
  <name>Task 2: Create AccuracyDisplay component with denominator format</name>
  <files>src/components/accuracy-display.tsx</files>
  <action>
Create `src/components/accuracy-display.tsx` with:

1. "use client" directive

2. Interface AccuracyDisplayProps:
   - correct: number (numerator - correctTendencies)
   - total: number (denominator - scoredPredictions)
   - showBar?: boolean (optional progress bar, default false)
   - size?: 'sm' | 'md' | 'lg' (text sizing, default 'md')
   - className?: string (for additional styling)

3. Component implementation:
   - Calculate accuracy: `total > 0 ? Math.round((correct / total) * 1000) / 10 : 0` (one decimal)
   - Wrap in Tooltip from ui/tooltip
   - TooltipTrigger with asChild containing a span with:
     - cursor-help class
     - Font-mono for numbers: "{correct}/{total}"
     - Muted text for percentage: "({accuracy}%)"
     - HelpCircle icon from lucide-react (h-3 w-3 text-muted-foreground/50)
   - TooltipContent with max-w-xs containing:
     - Bold title: "Tendency Accuracy"
     - Description: "{correct} correct predictions out of {total} scored matches."
     - Link to /methodology with text "Learn how we calculate accuracy" (text-primary hover:underline text-xs)

4. Size variants using sizeClasses object:
   - sm: text-xs
   - md: text-sm
   - lg: text-base

5. Optional showBar prop: when true, render a progress bar below the text (similar to leaderboard pattern)

6. Use cn() for className merging
  </action>
  <verify>
    - File exists at src/components/accuracy-display.tsx
    - Exports AccuracyDisplay component
    - TypeScript compiles: `npx tsc --noEmit 2>&1 | grep -i accuracy || echo "No accuracy errors"`
    - Component handles edge case: total=0 returns 0 accuracy without division error
  </verify>
  <done>
    - AccuracyDisplay component shows "X/Y (Z%)" format
    - HelpCircle icon indicates interactive tooltip
    - Tooltip shows methodology explanation with link to /methodology
    - Size variants work for different UI contexts
  </done>
</task>

<task type="auto">
  <name>Task 3: Add TooltipProvider to root layout</name>
  <files>src/app/layout.tsx</files>
  <action>
Update `src/app/layout.tsx`:

1. Add import at top:
   `import { TooltipProvider } from "@/components/ui/tooltip"`

2. Wrap children in TooltipProvider with configuration:
   - delayDuration={300} (300ms delay before showing tooltip)
   - skipDelayDuration={100} (100ms skip delay when moving between tooltips)

3. Place TooltipProvider inside the body, wrapping the content area:
   - Should wrap: Navigation, main content, Footer
   - Should NOT wrap: script tags, Analytics component
   - Place it after the background gradient div, before Navigation

4. Structure should be:
```tsx
<body>
  {/* Schema scripts */}
  <Analytics />
  {/* Background gradient */}
  <TooltipProvider delayDuration={300} skipDelayDuration={100}>
    <Navigation />
    <main>
      <ErrorBoundaryProvider>
        {children}
      </ErrorBoundaryProvider>
    </main>
    <Footer />
  </TooltipProvider>
</body>
```

Note: Only ONE TooltipProvider at app level. Never nest additional providers in child components.
  </action>
  <verify>
    - Import statement present for TooltipProvider
    - TooltipProvider wraps Navigation, main, and Footer
    - delayDuration and skipDelayDuration props configured
    - App builds without errors: `npm run build 2>&1 | tail -20`
  </verify>
  <done>
    - TooltipProvider in layout.tsx provides global tooltip configuration
    - All tooltips in app will have consistent 300ms delay
    - Quick movements between tooltips skip the delay
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` succeeds without errors
2. `npm run dev` starts successfully
3. Navigate to any page - no console errors about missing providers
4. Tooltip primitives are available for import from @/components/ui/tooltip
5. AccuracyDisplay component is available for import from @/components/accuracy-display
</verification>

<success_criteria>
1. @radix-ui/react-tooltip is installed and in package.json
2. tooltip.tsx exports all four primitives following shadcn/ui pattern
3. AccuracyDisplay shows "X/Y (Z%)" format with tooltip containing methodology link
4. TooltipProvider wraps app content with configured delays
5. Build passes - foundation ready for Plan 02 integration
</success_criteria>

<output>
After completion, create `.planning/phases/08-ux-transparency/08-01-SUMMARY.md`
</output>
