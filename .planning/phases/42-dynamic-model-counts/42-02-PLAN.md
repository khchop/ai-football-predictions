---
phase: 42-dynamic-model-counts
plan: 02
type: execute
wave: 2
depends_on: ["42-01"]
files_modified:
  - src/lib/seo/metadata.ts
  - src/lib/seo/schema/competition.ts
  - src/lib/league/generate-league-faqs.ts
  - src/lib/content/match-content.ts
  - src/components/MatchPageSchema.tsx
  - src/app/matches/page.tsx
  - src/app/leaderboard/page.tsx
  - src/app/about/page.tsx
  - src/app/blog/page.tsx
  - src/app/blog/[slug]/page.tsx
  - src/app/leagues/[slug]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Homepage hero displays actual active model count (not hardcoded 35)"
    - "Match page metadata reflects current model count"
    - "Leaderboard metadata shows dynamic model count"
    - "All pages show consistent model count (0 discrepancies)"
    - "Newly enabled models appear in count without code changes"
  artifacts:
    - path: "src/lib/seo/metadata.ts"
      provides: "Dynamic model count in SEO metadata"
      contains: "getOverallStats\\(\\)|getActiveModelCount\\(\\)"
    - path: "src/app/leaderboard/page.tsx"
      provides: "Dynamic count in leaderboard metadata"
      contains: "activeModels|getActiveModelCount"
  key_links:
    - from: "src/lib/seo/metadata.ts"
      to: "src/lib/db/queries.ts"
      via: "getOverallStats() call"
      pattern: "getOverallStats|activeModels"
    - from: "src/app/leaderboard/page.tsx"
      to: "src/lib/db/queries.ts"
      via: "stats fetch for metadata"
      pattern: "getOverallStats|activeModels"
---

<objective>
Replace all hardcoded "35 models" references with dynamic counts from getOverallStats().activeModels.

Purpose: Ensures model count is always accurate across all pages, eliminating manual updates when models are added/removed/disabled.
Output: All 15+ hardcoded locations updated to use dynamic count
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-dynamic-model-counts/42-RESEARCH.md
@.planning/phases/42-dynamic-model-counts/42-01-SUMMARY.md

# Key source files to modify
@src/lib/seo/metadata.ts
@src/app/leaderboard/page.tsx
@src/app/about/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update SEO metadata files with dynamic counts</name>
  <files>src/lib/seo/metadata.ts, src/lib/seo/schema/competition.ts</files>
  <action>
**In src/lib/seo/metadata.ts:**

1. Add import at top:
```typescript
import { getOverallStats } from '@/lib/db/queries';
```

2. Find and update these hardcoded references:

Line ~45 (generateMatchMetadata or similar):
- Before: `const modelsMsg = \` 35 models compete - see who's most accurate.\`;`
- After: Make function async, fetch stats, use `stats.activeModels`:
```typescript
const stats = await getOverallStats();
const modelsMsg = ` ${stats.activeModels} models compete - see who's most accurate.`;
```

Line ~62:
- Before: `const modelsMsg = \` AI predictions from 35 models with accuracy tracking.\`;`
- After: `const modelsMsg = \` AI predictions from ${stats.activeModels} models with accuracy tracking.\`;`

Line ~276 (generateCompetitionMetadata):
- Before: `const description = \`AI predictions for ${competition.name} from 35 models. ...\`;`
- After: `const description = \`AI predictions for ${competition.name} from ${stats.activeModels} models. ...\`;`

**Important:** If functions are not already async, make them async and update callers to await.

**In src/lib/seo/schema/competition.ts:**

1. Add import:
```typescript
import { getOverallStats } from '@/lib/db/queries';
```

2. Lines ~67-68:
- Before: `AI predictions from 35 models`
- After: Accept `activeModels` as parameter or fetch within function:
```typescript
// If function already receives stats, use stats.activeModels
// If not, add parameter: activeModels: number
`AI predictions from ${activeModels} models`
```
  </action>
  <verify>
Run `grep -n "35 models\|35 AI" src/lib/seo/metadata.ts src/lib/seo/schema/competition.ts` returns no matches.
Run `npx tsc --noEmit` passes without errors.
  </verify>
  <done>
- src/lib/seo/metadata.ts has no hardcoded "35 models" references
- src/lib/seo/schema/competition.ts uses dynamic count
- All metadata functions fetch or receive activeModels dynamically
  </done>
</task>

<task type="auto">
  <name>Task 2: Update page files with dynamic counts</name>
  <files>src/app/matches/page.tsx, src/app/leaderboard/page.tsx, src/app/about/page.tsx, src/app/blog/page.tsx, src/app/blog/[slug]/page.tsx, src/app/leagues/[slug]/page.tsx</files>
  <action>
**For each file, the pattern is:**
1. Import getOverallStats if not already imported
2. Create generateMetadata as async function (if not already)
3. Fetch stats and use stats.activeModels

**src/app/matches/page.tsx (lines 15, 21, 29):**
```typescript
import { getOverallStats } from '@/lib/db/queries';

export async function generateMetadata(): Promise<Metadata> {
  const stats = await getOverallStats();
  return {
    description: `Browse upcoming and recent football matches with AI predictions from ${stats.activeModels} models. ...`,
    openGraph: {
      description: `View upcoming matches with predictions from ${stats.activeModels} AI models`,
    },
    twitter: {
      description: `Browse matches with AI predictions from ${stats.activeModels} models`,
    },
  };
}
```

**src/app/leaderboard/page.tsx (lines 20, 26, 34):**
```typescript
import { getOverallStats } from '@/lib/db/queries';

export async function generateMetadata(): Promise<Metadata> {
  const stats = await getOverallStats();
  return {
    title: `AI Model Leaderboard | Compare ${stats.activeModels} Models | kroam.xyz`,
    openGraph: {
      title: `AI Model Leaderboard | Compare ${stats.activeModels} Models`,
    },
    twitter: {
      title: `AI Model Leaderboard | Compare ${stats.activeModels} Models`,
    },
  };
}
```

**src/app/about/page.tsx (lines 9, 15):**
```typescript
export async function generateMetadata(): Promise<Metadata> {
  const stats = await getOverallStats();
  return {
    description: `Learn how kroam.xyz compares ${stats.activeModels} AI models predicting football matches. ...`,
    openGraph: {
      description: `Discover how ${stats.activeModels} AI models compete to predict football match outcomes...`,
    },
  };
}
```

**src/app/blog/page.tsx (line 21):**
- Update to use dynamic count in description

**src/app/blog/[slug]/page.tsx (line 78):**
- Update OG description to use dynamic count

**src/app/leagues/[slug]/page.tsx (lines 42-43):**
- Update competition metadata to use dynamic count
  </action>
  <verify>
Run `grep -rn "35 models\|35 AI" src/app/` returns no matches (except possibly comments).
Run `npx tsc --noEmit` passes without errors.
  </verify>
  <done>
- All page files use dynamic model count in metadata
- No hardcoded "35 models" in any src/app/ files
- All generateMetadata functions are async where needed
  </done>
</task>

<task type="auto">
  <name>Task 3: Update content generation with dynamic counts</name>
  <files>src/lib/league/generate-league-faqs.ts, src/lib/content/match-content.ts, src/components/MatchPageSchema.tsx</files>
  <action>
**src/lib/league/generate-league-faqs.ts (lines 79, 88):**

Option A (preferred): Accept modelCount as parameter:
```typescript
export interface LeagueFAQData {
  competition: { id: string; name: string };
  stats: { finishedMatches: number; avgGoalsPerMatch: number };
  topModel?: { model: { name: string }; accuracy: number };
  activeModels: number;  // ADD THIS
}

export function generateLeagueFAQs(data: LeagueFAQData): FAQItem[] {
  const { competition, stats, topModel, activeModels } = data;
  // ...
  const tldrAnswer = `Our platform uses ${activeModels} AI models to predict exact scores...`;
  // ...
  const matchCountAnswer = `We have tracked... with AI analysis and exact score predictions from ${activeModels} different models.`;
}
```

Update ALL callers of generateLeagueFAQs to pass activeModels.

**src/lib/content/match-content.ts (line 820):**
- Find: `mention 35+ models`
- Replace with dynamic count parameter or fetch

**src/components/MatchPageSchema.tsx (line 49):**
```typescript
// Before
const pageDescription = `AI predictions for ${matchName} (${competition.name}). Compare forecasts from 35+ AI models.`;

// Option A: Accept as prop
interface MatchPageSchemaProps {
  // ... existing props
  activeModels: number;
}
const pageDescription = `AI predictions for ${matchName} (${competition.name}). Compare forecasts from ${activeModels}+ AI models.`;

// Option B: If this is a server component, fetch directly
const stats = await getOverallStats();
const pageDescription = `AI predictions for ${matchName} (${competition.name}). Compare forecasts from ${stats.activeModels}+ AI models.`;
```
  </action>
  <verify>
Run `grep -rn "35 models\|35 AI\|35\+" src/lib/ src/components/` returns no matches.
Run `npx tsc --noEmit` passes without errors.
  </verify>
  <done>
- generate-league-faqs.ts accepts and uses activeModels parameter
- match-content.ts uses dynamic count in prompts
- MatchPageSchema.tsx uses dynamic count in description
- All callers updated to pass/provide activeModels
  </done>
</task>

</tasks>

<verification>
1. **Zero hardcoded references:**
   ```bash
   grep -rn "35 models\|35 AI" src/ | grep -v node_modules | grep -v ".test."
   ```
   Should return no matches (or only comments explaining the change).

2. **TypeScript compilation:** `npx tsc --noEmit` passes

3. **Consistency check:** Start dev server and verify:
   - Homepage stats bar shows same number as leaderboard count
   - Match page metadata uses same number
   - About page metadata uses same number

4. **Dynamic update test:**
   - Note current count
   - Disable one model in database
   - Clear cache or wait 60s
   - Verify count decreased by 1 on all pages
</verification>

<success_criteria>
- Zero grep matches for "35 models" or "35 AI" in src/
- All metadata functions are async and fetch stats dynamically
- generateLeagueFAQs accepts activeModels parameter
- MatchPageSchema uses dynamic count
- TypeScript compiles without errors
- Dev server shows consistent model count across all pages
</success_criteria>

<output>
After completion, create `.planning/phases/42-dynamic-model-counts/42-02-SUMMARY.md`
</output>
