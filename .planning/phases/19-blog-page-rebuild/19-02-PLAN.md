---
phase: 19-blog-page-rebuild
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/blog/extract-faqs.ts
  - src/components/blog/blog-faq.tsx
autonomous: true

must_haves:
  truths:
    - "User finds FAQ section at bottom of blog posts"
    - "FAQ questions are visible, answers expand on click (accordion)"
    - "FAQPage schema is present in page source for GEO"
  artifacts:
    - path: "src/lib/blog/extract-faqs.ts"
      provides: "FAQ extraction from blog content"
      exports: ["extractFAQs"]
    - path: "src/components/blog/blog-faq.tsx"
      provides: "FAQ accordion with schema injection"
      exports: ["BlogFAQ"]
  key_links:
    - from: "src/components/blog/blog-faq.tsx"
      to: "src/components/FaqSchema.tsx"
      via: "import for schema injection"
      pattern: "import.*FaqSchema"
    - from: "src/components/blog/blog-faq.tsx"
      to: "native details/summary"
      via: "HTML elements"
      pattern: "<details.*<summary"
---

<objective>
Create FAQ extraction and accordion component with FAQPage schema for GEO optimization.

Purpose: BLOG-04 requires FAQ section with FAQPage schema. AI platforms (ChatGPT, Perplexity, Google AI Overviews) prefer FAQPage structured data for citations. Native details/summary provides accessible accordion with zero JavaScript.

Output: extractFAQs utility for auto-generating FAQs from content, BlogFAQ component with native accordion and schema injection.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19-blog-page-rebuild/19-CONTEXT.md
@.planning/phases/19-blog-page-rebuild/19-RESEARCH.md

# Existing patterns to follow
@src/components/match/match-faq.tsx
@src/components/FaqSchema.tsx
@src/lib/seo/schemas.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FAQ extraction utility</name>
  <files>src/lib/blog/extract-faqs.ts</files>
  <action>
Create FAQ extraction utility that auto-generates FAQs from blog content:

```typescript
import type { FAQItem } from '@/lib/seo/schemas';

export function extractFAQs(
  markdown: string,
  options?: {
    maxFaqs?: number;
    includeDefaultTLDR?: boolean;
  }
): FAQItem[]
```

Extraction strategy (per user decision: "extract questions from headings/content programmatically"):

1. **Heading-based extraction** (primary):
   - Find headings ending with "?" (e.g., "## What is the best prediction model?")
   - Extract question from heading
   - Extract answer from content until next heading (trim to ~200 chars for schema)

2. **TL;DR question** (per Phase 18 pattern and GEO research):
   - If includeDefaultTLDR is true, add a "What is this article about?" question with excerpt as answer
   - TL;DR should be FIRST in FAQ list for AI citation priority

3. **Fallback patterns**:
   - Look for "Q:" / "A:" patterns in content
   - Look for **bolded questions** followed by answers

Implementation:
- Default maxFaqs: 5 (reasonable for schema, not overwhelming)
- Truncate answers to 300 characters max (schema best practice)
- Return FAQItem[] compatible with existing FaqSchema component

If no FAQs can be extracted, return empty array (component will handle hiding section).
  </action>
  <verify>
Test with sample markdown containing:
- "## Why use AI predictions?" heading -> extracts as FAQ
- Plain content without questions -> returns empty array or TL;DR only
  </verify>
  <done>
extractFAQs function exists, extracts questions from headings, handles edge cases, returns FAQItem[]
  </done>
</task>

<task type="auto">
  <name>Task 2: Create BlogFAQ component</name>
  <files>src/components/blog/blog-faq.tsx</files>
  <action>
Create BlogFAQ component following match-faq.tsx pattern exactly:

1. **Props interface**:
```typescript
interface BlogFAQProps {
  faqs: FAQItem[];
}
```

2. **Structure** (per user decision: accordion collapsed, after main content):
   - Section with border-t separator
   - H2 "Frequently Asked Questions"
   - Native `<details>` / `<summary>` for each FAQ (NO JavaScript accordion library)
   - FaqSchema component for JSON-LD injection

3. **Styling** (copy from match-faq.tsx):
   - `details` with `group` class for open state targeting
   - `summary` with cursor-pointer, font-medium, hover state
   - Chevron SVG that rotates 180deg on open (`group-open:rotate-180`)
   - Answer content with muted text, leading-relaxed

4. **Empty state**:
   - If faqs.length === 0, return null (don't render section)

5. **Import FaqSchema** from '@/components/FaqSchema' (existing component)

This is a server component (no 'use client') - native details/summary works server-side.

IMPORTANT: Use the EXACT same visual pattern as match-faq.tsx for consistency across the site.
  </action>
  <verify>
- File exists at src/components/blog/blog-faq.tsx
- Uses native details/summary (NOT Radix or custom JS accordion)
- Imports and uses FaqSchema component
- Returns null when faqs array is empty
  </verify>
  <done>
BlogFAQ component renders accessible accordion with FAQ schema, matches match-faq.tsx pattern
  </done>
</task>

<task type="auto">
  <name>Task 3: Test FAQ components standalone</name>
  <files>src/components/blog/blog-faq.tsx, src/lib/blog/extract-faqs.ts</files>
  <action>
Verify the FAQ extraction and component work correctly:

1. Create a simple test by temporarily adding to a test page or using node:
```bash
# Quick verification (if tsx is available)
npx tsx -e "
const { extractFAQs } = require('./src/lib/blog/extract-faqs');
const md = '# Test\n\n## What is AI?\n\nAI is artificial intelligence.\n\n## How does it work?\n\nIt uses neural networks.';
console.log(JSON.stringify(extractFAQs(md), null, 2));
"
```

2. Verify TypeScript compilation:
```bash
npx tsc --noEmit src/lib/blog/extract-faqs.ts src/components/blog/blog-faq.tsx
```

3. Check that FAQItem type is correctly imported from '@/lib/seo/schemas'

No integration into blog page yet (that's Plan 05). This task ensures components are correct standalone.
  </action>
  <verify>
- `npm run build` succeeds (TypeScript compilation)
- extractFAQs returns valid FAQItem[] structure
- BlogFAQ imports compile without errors
  </verify>
  <done>
FAQ extraction utility and component are TypeScript-valid and ready for integration
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds without TypeScript errors
2. extractFAQs correctly parses question headings from sample markdown
3. BlogFAQ component structure matches match-faq.tsx pattern
4. FaqSchema is imported and used for JSON-LD injection
</verification>

<success_criteria>
- BLOG-04 (FAQ section): BlogFAQ component exists with native accordion
- FAQPage schema injected via existing FaqSchema component
- Auto-extraction from content (questions from headings)
- Follows established match-faq.tsx pattern for site consistency
</success_criteria>

<output>
After completion, create `.planning/phases/19-blog-page-rebuild/19-02-SUMMARY.md`
</output>
