---
phase: 19-blog-page-rebuild
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/blog/blog-content.tsx
  - src/lib/blog/extract-headings.ts
  - src/app/blog/[slug]/page.tsx
autonomous: true

must_haves:
  truths:
    - "User reads blog content at comfortable line width (70ch max, not full screen)"
    - "User distinguishes heading hierarchy visually (H1, H2, H3 have clear size/weight)"
    - "Headings have auto-generated IDs for anchor linking"
  artifacts:
    - path: "src/components/blog/blog-content.tsx"
      provides: "Markdown renderer with typography styling and heading IDs"
      exports: ["BlogContent"]
    - path: "src/lib/blog/extract-headings.ts"
      provides: "Heading extraction for TOC generation"
      exports: ["extractHeadings", "Heading"]
  key_links:
    - from: "src/components/blog/blog-content.tsx"
      to: "react-markdown"
      via: "custom components prop"
      pattern: "ReactMarkdown.*components"
    - from: "src/app/blog/[slug]/page.tsx"
      to: "src/components/blog/blog-content.tsx"
      via: "import and render"
      pattern: "import.*BlogContent"
---

<objective>
Create readable blog typography with proper heading hierarchy and heading extraction utility.

Purpose: BLOG-01 and BLOG-02 require readable line width and clear heading hierarchy. The heading extraction utility enables TOC generation (Plan 04) and ensures consistent heading IDs between content and TOC.

Output: BlogContent component with 70ch max-width, typography scale, and auto-generated heading IDs. extractHeadings utility for TOC component.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19-blog-page-rebuild/19-CONTEXT.md
@.planning/phases/19-blog-page-rebuild/19-RESEARCH.md

# Existing patterns
@src/app/blog/[slug]/page.tsx
@src/components/match/match-faq.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create heading extraction utility</name>
  <files>src/lib/blog/extract-headings.ts</files>
  <action>
Create heading extraction utility for TOC generation:

```typescript
export interface Heading {
  id: string;
  text: string;
  level: 2 | 3; // H2 and H3 only per user decision
}

export function extractHeadings(markdown: string): Heading[]
```

Implementation requirements:
- Parse markdown for H2 (##) and H3 (###) headings
- Generate URL-safe IDs using slugification (lowercase, replace non-word chars with hyphens)
- Handle duplicate headings by appending -2, -3 suffix (per research pitfall #6)
- Return array of Heading objects with id, text, level

Use simple regex pattern matching (per research: "remark plugins add complexity without major benefit for dynamic TOCs"):
- H2: `/^##\s+(.+)$/gm`
- H3: `/^###\s+(.+)$/gm`

Do NOT use complex AST parsing - simple regex is sufficient for markdown headings.
  </action>
  <verify>
Create test file or verify with sample markdown:
- "## Hello World" -> { id: "hello-world", text: "Hello World", level: 2 }
- Two "## FAQ" headings -> ids: "faq", "faq-2"
  </verify>
  <done>
extractHeadings function exists, handles duplicate IDs, returns Heading[] with correct structure
  </done>
</task>

<task type="auto">
  <name>Task 2: Create BlogContent component with typography</name>
  <files>src/components/blog/blog-content.tsx</files>
  <action>
Create BlogContent component that renders markdown with:

1. **Container styling** (per user decision: 70-75 chars ~700px):
   - `max-width: 70ch` (NOT pixels - scales with font size per research)
   - `margin: 0 auto` for centering
   - Comfortable reading with proper spacing

2. **Heading components** with auto-generated IDs:
   - H1: `text-3xl font-bold mb-4` (rarely used in content)
   - H2: `text-2xl font-bold mb-3 mt-8 scroll-mt-20` + id attribute
   - H3: `text-xl font-semibold mb-3 mt-6 scroll-mt-20` + id attribute
   - Use same slugification logic as extract-headings.ts for ID generation
   - `scroll-mt-20` provides offset for sticky header when anchor-linking

3. **Body text styling**:
   - Paragraphs: `text-foreground leading-relaxed mb-4`
   - Lists: proper spacing and indentation
   - Blockquotes: left border, italic, muted color
   - Code: inline code with bg-muted/50, code blocks constrained to content width with horizontal scroll

4. **Image handling** (per user decision):
   - `max-width: 100%` (constrain to content width, never wider than text)
   - `height: auto` for aspect ratio

Use 'use client' directive - this is a client component due to React Markdown.

Props interface:
```typescript
interface BlogContentProps {
  content: string;
  className?: string;
}
```

Import from react-markdown (already in package.json).
  </action>
  <verify>
- File exists at src/components/blog/blog-content.tsx
- Exports BlogContent component
- Uses max-width: 70ch (not pixels)
- H2/H3 have id attributes and scroll-mt-20
  </verify>
  <done>
BlogContent component renders markdown with readable width, heading hierarchy, and auto-generated IDs for anchor linking
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate BlogContent into blog post page</name>
  <files>src/app/blog/[slug]/page.tsx</files>
  <action>
Update the blog post page to use BlogContent component:

1. Import BlogContent from '@/components/blog/blog-content'

2. Replace the existing inline ReactMarkdown usage (lines ~266-294) with:
   ```tsx
   <BlogContent content={post.content} />
   ```

3. Keep the existing Card wrapper and header/footer structure - only replace the content rendering section

4. Add reading time display (per Claude's discretion from CONTEXT.md):
   - Calculate reading time: `Math.ceil(post.content.split(/\s+/).length / 265)` (265 WPM is Medium's standard)
   - Display next to publish date: "5 min read"
   - This is optional but standard practice and 1-line implementation

The page structure should remain:
- Back link
- Card with header (badge, title, meta, excerpt)
- Divider
- BlogContent (NEW - replaces inline ReactMarkdown)
- Footer with generation stats
- Related posts link
  </action>
  <verify>
- BlogContent imported and used
- Existing page structure preserved
- `npm run build` succeeds without errors
  </verify>
  <done>
Blog post page uses BlogContent component with proper typography, readable line width, and heading IDs
  </done>
</task>

</tasks>

<verification>
1. Visit /blog/[any-slug] and confirm:
   - Content has comfortable reading width (~700px, not full screen)
   - H2/H3 headings are visually distinct (size and weight differ)
   - Clicking heading anchor link scrolls correctly (if manually testing with #heading-id)
2. Run `npm run build` - no TypeScript or build errors
3. Check that images and code blocks stay within content width
</verification>

<success_criteria>
- BLOG-01: Content max-width is 70ch, not full screen
- BLOG-02: H1/H2/H3 have clear visual hierarchy with consistent sizing
- Heading IDs generated for TOC support (Plan 04 dependency)
- extractHeadings utility ready for Plan 04 TOC component
</success_criteria>

<output>
After completion, create `.planning/phases/19-blog-page-rebuild/19-01-SUMMARY.md`
</output>
