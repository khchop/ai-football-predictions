---
phase: 19-blog-page-rebuild
plan: 05
type: execute
wave: 3
depends_on: ["19-01", "19-02", "19-03", "19-04"]
files_modified:
  - src/app/blog/[slug]/page.tsx
autonomous: false

must_haves:
  truths:
    - "User reads blog content at comfortable line width (70ch)"
    - "User distinguishes heading hierarchy visually"
    - "User jumps to specific sections via table of contents on articles 500+ words"
    - "User finds FAQ section at bottom of relevant posts"
    - "User discovers related articles via widget at post end"
  artifacts:
    - path: "src/app/blog/[slug]/page.tsx"
      provides: "Complete blog post page with all Phase 19 features"
      min_lines: 150
  key_links:
    - from: "src/app/blog/[slug]/page.tsx"
      to: "src/components/blog/blog-content.tsx"
      via: "import BlogContent"
      pattern: "import.*BlogContent"
    - from: "src/app/blog/[slug]/page.tsx"
      to: "src/components/blog/blog-toc.tsx"
      via: "import BlogTOC"
      pattern: "import.*BlogTOC"
    - from: "src/app/blog/[slug]/page.tsx"
      to: "src/components/blog/blog-faq.tsx"
      via: "import BlogFAQ"
      pattern: "import.*BlogFAQ"
    - from: "src/app/blog/[slug]/page.tsx"
      to: "src/components/blog/related-articles.tsx"
      via: "import RelatedArticles"
      pattern: "import.*RelatedArticles"
---

<objective>
Integrate all Phase 19 components into the blog post page and verify complete implementation.

Purpose: Final integration plan wires together typography (Plan 01), FAQ (Plan 02), related articles (Plan 03), and TOC (Plan 04) into the blog post page. Includes human verification checkpoint to confirm visual quality.

Output: Complete blog post page with all BLOG-01 through BLOG-05 requirements implemented.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19-blog-page-rebuild/19-CONTEXT.md
@.planning/phases/19-blog-page-rebuild/19-RESEARCH.md

# Prior plan summaries (for integration context)
@.planning/phases/19-blog-page-rebuild/19-01-SUMMARY.md
@.planning/phases/19-blog-page-rebuild/19-02-SUMMARY.md
@.planning/phases/19-blog-page-rebuild/19-03-SUMMARY.md
@.planning/phases/19-blog-page-rebuild/19-04-SUMMARY.md

# Current implementation
@src/app/blog/[slug]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restructure blog page layout for sidebar TOC</name>
  <files>src/app/blog/[slug]/page.tsx</files>
  <action>
Restructure the blog post page to accommodate sidebar TOC:

1. **New layout structure** (two-column on desktop):
   ```tsx
   <div className="max-w-6xl mx-auto">
     {/* Schemas */}

     {/* Back link */}

     {/* Main grid: TOC sidebar + Content */}
     <div className="lg:grid lg:grid-cols-[1fr_250px] lg:gap-8">
       {/* Main content column */}
       <article>
         <Card>...</Card>
         <BlogFAQ faqs={faqs} />
         <RelatedArticles articles={relatedArticles} />
       </article>

       {/* TOC sidebar (desktop only) */}
       {showTOC && (
         <aside className="hidden lg:block">
           <BlogTOC headings={headings} />
         </aside>
       )}
     </div>
   </div>
   ```

2. **Calculate TOC visibility** (per user decision: 500+ words only):
   ```tsx
   const wordCount = post.content.split(/\s+/).length;
   const showTOC = wordCount >= 500;
   const headings = showTOC ? extractHeadings(post.content) : [];
   ```

3. **Import required components**:
   - `import { BlogContent } from '@/components/blog/blog-content'`
   - `import { BlogTOC } from '@/components/blog/blog-toc'`
   - `import { BlogFAQ } from '@/components/blog/blog-faq'`
   - `import { RelatedArticles } from '@/components/blog/related-articles'`
   - `import { extractHeadings } from '@/lib/blog/extract-headings'`
   - `import { extractFAQs } from '@/lib/blog/extract-faqs'`
   - `import { findRelatedArticles } from '@/lib/blog/related-articles'`

4. **Update max-width**:
   - Change from `max-w-3xl` to `max-w-6xl` to accommodate sidebar
   - The BlogContent component already constrains text to 70ch
  </action>
  <verify>
- Page renders with two-column layout on desktop (lg breakpoint)
- TOC appears in right sidebar on desktop
- Content width remains comfortable (BlogContent's 70ch)
  </verify>
  <done>
Blog page has two-column layout with TOC sidebar on desktop, single column on mobile
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire FAQ and Related Articles data</name>
  <files>src/app/blog/[slug]/page.tsx</files>
  <action>
Add data fetching and wiring for FAQ and Related Articles:

1. **FAQ extraction**:
   ```tsx
   const faqs = extractFAQs(post.content, {
     includeDefaultTLDR: true, // Add TL;DR question for GEO
     maxFaqs: 5
   });
   ```

2. **Related articles fetching**:
   ```tsx
   // Fetch pool of recent posts for similarity calculation
   const recentPosts = await getRecentBlogPosts(20);

   // Calculate related articles
   const relatedArticles = findRelatedArticles(post, recentPosts, 3);
   ```

3. **Add query import**:
   ```tsx
   import { getBlogPostBySlug, getRecentBlogPosts } from '@/lib/db/queries';
   ```

4. **Component placement order** (per user decisions):
   - BlogContent (main article)
   - BlogFAQ (after main content, before related - per CONTEXT.md)
   - RelatedArticles (at the very end)

5. **Handle empty states**:
   - BlogFAQ returns null if no FAQs extracted
   - RelatedArticles returns null if no related found
   - Both components handle this internally, no conditional rendering needed in page
  </action>
  <verify>
- FAQs extracted from content and passed to BlogFAQ
- Related articles fetched and similarity calculated
- Components render in correct order: Content -> FAQ -> Related
  </verify>
  <done>
FAQ and Related Articles data is fetched, calculated, and passed to components
  </done>
</task>

<task type="auto">
  <name>Task 3: Final build verification</name>
  <files>src/app/blog/[slug]/page.tsx</files>
  <action>
Run comprehensive build and verification:

1. **TypeScript compilation**:
   ```bash
   npm run build
   ```

2. **Verify all imports resolve**:
   - All component imports from '@/components/blog/*'
   - All utility imports from '@/lib/blog/*'
   - Query imports from '@/lib/db/queries'

3. **Check page renders at runtime**:
   ```bash
   npm run dev
   # Visit http://localhost:3000/blog/[any-existing-slug]
   ```

4. **Verify schema injection**:
   - FAQPage schema should appear in page source when FAQs exist
   - Article schema still present (existing functionality)

5. **Mobile responsiveness**:
   - TOC hidden on mobile (hidden lg:block)
   - Content readable on mobile (single column)
  </action>
  <verify>
- `npm run build` succeeds without errors
- Page renders without runtime errors
- All Phase 19 components visible and functional
  </verify>
  <done>
Blog post page builds and runs with all Phase 19 features integrated
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete blog post page with:
- Readable typography (70ch max-width)
- Heading hierarchy (H1/H2/H3 styling)
- Table of contents (sidebar on desktop, 500+ word articles)
- FAQ accordion (native details/summary, FAQPage schema)
- Related articles widget (card grid, 1-3 articles)
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`

2. Visit a blog post with 500+ words: http://localhost:3000/blog/[slug]
   - [ ] Content has comfortable reading width (not full screen)
   - [ ] H2/H3 headings are visually distinct
   - [ ] TOC appears in right sidebar on desktop
   - [ ] Clicking TOC link scrolls to section
   - [ ] Active section highlighted in TOC as you scroll

3. Check FAQ section:
   - [ ] FAQ accordions at bottom of content
   - [ ] Click question to expand/collapse answer
   - [ ] View page source: search for "FAQPage" - schema present

4. Check Related Articles:
   - [ ] Card grid appears after FAQ section
   - [ ] Cards link to other blog posts
   - [ ] Clicking card navigates to that post

5. Mobile check (resize browser or use DevTools):
   - [ ] TOC hidden on mobile
   - [ ] Content readable (single column)
   - [ ] FAQ and Related still visible

6. Short article (under 500 words):
   - [ ] TOC does NOT appear (by design)
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe specific issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. All five requirements implemented:
   - BLOG-01: Line width controlled by BlogContent
   - BLOG-02: Typography hierarchy visible
   - BLOG-03: TOC with scroll spy (500+ words)
   - BLOG-04: FAQ with FAQPage schema
   - BLOG-05: Related articles widget
3. Human verification confirms visual quality
</verification>

<success_criteria>
- All Phase 19 components integrated into blog post page
- Layout works on both desktop (sidebar TOC) and mobile (no TOC)
- FAQ schema present in page source for GEO
- Related articles appear with correct similarity ranking
- Human verification approved
</success_criteria>

<output>
After completion, create `.planning/phases/19-blog-page-rebuild/19-05-SUMMARY.md`
</output>
