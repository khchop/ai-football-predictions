---
phase: 46-content-tags-meta-optimization
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/api/og/match/route.tsx
  - src/app/api/og/league/route.tsx
  - src/app/api/og/model/route.tsx
  - src/app/api/og/generic/route.tsx
  - src/app/matches/[id]/opengraph-image.tsx
  - src/app/leagues/[slug]/[match]/opengraph-image.tsx
  - src/lib/seo/og/templates.ts
autonomous: true

must_haves:
  truths:
    - "All OG images use dark navy/charcoal gradient background with light text"
    - "Match pages at /leagues/{slug}/{match} have dynamic OG images with team names"
    - "Every OG image includes Kroam.xyz branding in the footer"
    - "A generic fallback OG image exists for pages without specific templates"
  artifacts:
    - path: "src/app/leagues/[slug]/[match]/opengraph-image.tsx"
      provides: "Dynamic OG image for match pages under /leagues route"
      min_lines: 30
    - path: "src/app/api/og/generic/route.tsx"
      provides: "Generic fallback OG image for homepage, blog, leaderboard, etc."
      min_lines: 20
  key_links:
    - from: "src/app/leagues/[slug]/[match]/opengraph-image.tsx"
      to: "src/lib/db/queries"
      via: "getMatchBySlug import for match data"
      pattern: "getMatchBySlug"
    - from: "src/app/api/og/league/route.tsx"
      to: "none (query params)"
      via: "searchParams for league name"
      pattern: "searchParams.get"
---

<objective>
Retheme all OG images to dark navy/charcoal gradient with light text, add dynamic OG image generation for match pages under /leagues route, and create a generic fallback OG image.

Purpose: All indexable pages must have complete OG tags including og:image. Current OG images use a purple gradient -- user decision requires dark theme (navy/charcoal) with professional data/analytics vibe. Match pages at /leagues/{slug}/{match} need their own opengraph-image.tsx (currently only /matches/[id] has one).

Output: Updated OG API routes with dark theme + new opengraph-image.tsx for match pages + generic fallback OG route.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/46-content-tags-meta-optimization/46-CONTEXT.md
@.planning/phases/46-content-tags-meta-optimization/46-RESEARCH.md
@src/app/api/og/match/route.tsx
@src/app/api/og/league/route.tsx
@src/app/api/og/model/route.tsx
@src/app/matches/[id]/opengraph-image.tsx
@src/lib/seo/og/templates.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Retheme all existing OG image routes to dark gradient</name>
  <files>
    src/app/api/og/match/route.tsx
    src/app/api/og/league/route.tsx
    src/app/api/og/model/route.tsx
    src/app/matches/[id]/opengraph-image.tsx
    src/lib/seo/og/templates.ts
  </files>
  <action>
**Dark gradient theme (user decision):**
- Background: `linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)`
- Primary text: `#e0e0e0` (light gray)
- Accent: `#60a5fa` (blue-400, for Kroam branding and headers)
- Secondary text: `#9ca3af` (gray-400)
- Muted text: `#6b7280` (gray-500)
- Border/divider: `rgba(255,255,255,0.1)`
- Badge background: `rgba(96, 165, 250, 0.2)` (blue tint, replacing purple)

**Update src/app/api/og/match/route.tsx:**
- Replace `background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'` with dark gradient
- Replace purple badge `rgba(168, 85, 247, 0.4)` with blue badge `rgba(96, 165, 250, 0.2)`
- Change footer branding from `kroam.xyz` to `Kroam.xyz`
- Keep all existing functionality (homeTeam, awayTeam, competition params, accuracy badge)
- Accuracy badge color stays green `rgba(34, 197, 94, 0.9)` (works well on dark backgrounds)

**Update src/app/api/og/league/route.tsx:**
- Replace purple gradient with dark gradient
- Replace purple badge with blue badge
- Update branding to `Kroam.xyz`
- Keep all existing functionality (leagueName, matchCount, upcomingCount params)

**Update src/app/api/og/model/route.tsx:**
- Replace purple gradient with dark gradient
- Replace purple badge with blue badge
- Update branding to `Kroam.xyz`
- Add blue accent color for "AI Model Performance" header text
- Keep all existing functionality (modelName, accuracy, rank params)

**Update src/app/matches/[id]/opengraph-image.tsx:**
- This renders dynamic OG images for old /matches/[id] route. Update template colors to dark gradient.
- Update `src/lib/seo/og/templates.ts` to change the gradient colors for all templates (upcoming, live, finished) to use dark navy variants:
  - Upcoming: `linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)`
  - Live: `linear-gradient(135deg, #1a1a2e 0%, #1e2a3a 50%, #0f3460 100%)` (slightly different mid-tone)
  - Finished: `linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)`
- Update footer branding from `BettingSoccer` to `Kroam.xyz`

**For all OG images, ensure consistent structure:**
1. Header: Page type / competition (accent color)
2. Center: Main content (large, bold, primary text color)
3. Footer: `Kroam.xyz` branding (left) + descriptive badge (right), separated by border-top
  </action>
  <verify>
Start dev server and visit each OG route in browser to verify rendering:
- `http://localhost:3000/api/og/match?homeTeam=Arsenal&awayTeam=Chelsea&competition=Premier+League`
- `http://localhost:3000/api/og/league?leagueName=Champions+League&matchCount=50&upcomingCount=8`
- `http://localhost:3000/api/og/model?modelName=Llama-3.3-70B&accuracy=45&rank=3`
  </verify>
  <done>
All three OG API routes use dark navy/charcoal gradient with light text and blue accents. Match opengraph-image uses updated template colors. Branding shows "Kroam.xyz" in footer.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create new OG image routes for missing page types and add match opengraph-image under /leagues</name>
  <files>
    src/app/api/og/generic/route.tsx
    src/app/leagues/[slug]/[match]/opengraph-image.tsx
  </files>
  <action>
**Create src/app/api/og/generic/route.tsx:**

Generic fallback OG image for pages that don't have a specific dynamic template (homepage, blog index, leaderboard, matches index, about, methodology). Uses dark gradient theme.

Accept optional query params: `title` (string), `subtitle` (string).

```typescript
import { ImageResponse } from 'next/og';

export async function GET(request: Request) {
  const { searchParams } = new URL(request.url);
  const title = searchParams.get('title') || 'AI Football Predictions';
  const subtitle = searchParams.get('subtitle') || 'Compare AI models predicting football across 17 leagues';

  return new ImageResponse(
    (
      <div style={{
        display: 'flex',
        flexDirection: 'column',
        width: '100%',
        height: '100%',
        background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)',
        color: '#e0e0e0',
        fontFamily: 'system-ui',
        padding: '60px',
      }}>
        {/* Accent bar */}
        <div style={{ display: 'flex', alignItems: 'center', marginBottom: 40 }}>
          <div style={{ fontSize: 24, fontWeight: 600, color: '#60a5fa' }}>Kroam.xyz</div>
        </div>

        {/* Title */}
        <div style={{ display: 'flex', flexDirection: 'column', flex: 1, justifyContent: 'center' }}>
          <div style={{ fontSize: 64, fontWeight: 800, lineHeight: 1.2, marginBottom: 20 }}>{title}</div>
          <div style={{ fontSize: 28, color: '#9ca3af' }}>{subtitle}</div>
        </div>

        {/* Footer */}
        <div style={{
          display: 'flex',
          justifyContent: 'space-between',
          alignItems: 'center',
          borderTop: '2px solid rgba(255,255,255,0.1)',
          paddingTop: 30,
        }}>
          <div style={{ fontSize: 28, fontWeight: 700, color: '#60a5fa' }}>Kroam.xyz</div>
          <div style={{ fontSize: 20, color: '#6b7280' }}>AI-Powered Predictions</div>
        </div>
      </div>
    ),
    {
      width: 1200,
      height: 630,
      headers: {
        'Cache-Control': 'public, max-age=3600, s-maxage=3600, stale-while-revalidate=86400',
      },
    }
  );
}
```

**Create src/app/leagues/[slug]/[match]/opengraph-image.tsx:**

Dynamic OG image for match pages under the canonical /leagues/[slug]/[match] route. This is the PRIMARY match OG image (the old /matches/[id]/opengraph-image.tsx serves the legacy route).

```typescript
import { ImageResponse } from 'next/og';
import { getMatchBySlug } from '@/lib/db/queries';
import { getCompetitionByIdOrAlias } from '@/lib/football/competitions';

export const alt = 'Match Preview';
export const size = { width: 1200, height: 630 };
export const contentType = 'image/png';

export default async function Image({ params }: { params: Promise<{ slug: string; match: string }> }) {
  const { slug, match } = await params;

  const competitionConfig = getCompetitionByIdOrAlias(slug);
  const competitionSlug = competitionConfig?.id || slug;
  const result = await getMatchBySlug(competitionSlug, match);

  if (!result) {
    // Fallback for missing match
    return new ImageResponse(
      <div style={{
        display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center',
        height: '100%', width: '100%',
        background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)',
        color: '#e0e0e0', fontFamily: 'system-ui',
      }}>
        <div style={{ fontSize: 48, fontWeight: 'bold' }}>Match Not Found</div>
        <div style={{ fontSize: 24, color: '#6b7280', marginTop: 20 }}>Kroam.xyz</div>
      </div>,
      { ...size }
    );
  }

  const { match: matchData, competition } = result;

  return new ImageResponse(
    (
      <div style={{
        display: 'flex', flexDirection: 'column', height: '100%', width: '100%',
        background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)',
        fontFamily: 'system-ui', color: '#e0e0e0',
      }}>
        {/* Header with competition */}
        <div style={{
          display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '40px 60px',
        }}>
          <div style={{ fontSize: 28, fontWeight: 600, color: '#60a5fa' }}>{competition.name}</div>
          {matchData.status === 'finished' && matchData.homeScore !== null && (
            <div style={{
              display: 'flex', padding: '8px 20px', borderRadius: 50,
              background: 'rgba(96, 165, 250, 0.2)', fontSize: 22, fontWeight: 700,
            }}>
              Final Score
            </div>
          )}
        </div>

        {/* Center: Teams and score */}
        <div style={{
          display: 'flex', flex: 1, justifyContent: 'center', alignItems: 'center', padding: '0 60px',
        }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: 40, width: '100%', justifyContent: 'center' }}>
            {/* Home team */}
            <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', flex: 1 }}>
              <div style={{ fontSize: 44, fontWeight: 700, textAlign: 'center', lineHeight: 1.2 }}>
                {matchData.homeTeam}
              </div>
            </div>

            {/* Score or VS */}
            <div style={{
              display: 'flex', alignItems: 'center', gap: 20,
              padding: '20px 40px', borderRadius: 16, background: 'rgba(0,0,0,0.3)',
            }}>
              {matchData.status === 'finished' && matchData.homeScore !== null && matchData.awayScore !== null ? (
                <span style={{ fontSize: 72, fontWeight: 800 }}>
                  {matchData.homeScore} - {matchData.awayScore}
                </span>
              ) : (
                <span style={{ fontSize: 64, fontWeight: 800, color: '#60a5fa' }}>VS</span>
              )}
            </div>

            {/* Away team */}
            <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', flex: 1 }}>
              <div style={{ fontSize: 44, fontWeight: 700, textAlign: 'center', lineHeight: 1.2 }}>
                {matchData.awayTeam}
              </div>
            </div>
          </div>
        </div>

        {/* Footer */}
        <div style={{
          display: 'flex', justifyContent: 'space-between', alignItems: 'center',
          padding: '30px 60px', borderTop: '2px solid rgba(255,255,255,0.1)',
        }}>
          <div style={{ fontSize: 28, fontWeight: 700, color: '#60a5fa' }}>Kroam.xyz</div>
          <div style={{ fontSize: 20, color: '#6b7280' }}>AI-Powered Predictions</div>
        </div>
      </div>
    ),
    { ...size }
  );
}
```

Note: Using `next/og` (built into Next.js 16.1.4, no install needed). Only flexbox CSS (no grid, no calc). `params` awaited per Next.js 16 requirement.

After creating these files, update the metadata in page files that reference static OG images to point to the new generic route:
- Homepage: `openGraph.images` should point to `/api/og/generic?title=AI+Football+Predictions`
- Blog index: point to `/api/og/generic?title=AI+Football+Analysis+Blog`
- Leaderboard: point to `/api/og/generic?title=AI+Model+Leaderboard`
- Matches index: point to `/api/og/generic?title=Football+Match+Predictions`
- About: point to `/api/og/generic?title=About+Kroam`
- Methodology: point to `/api/og/generic?title=Prediction+Methodology`

BUT WAIT -- Plan 01 modifies these page files. Since Plan 01 and Plan 02 run in parallel (Wave 1), we have a file conflict on page files.

**Resolution:** Do NOT modify page.tsx files in this task. Only create/modify OG route files. Plan 03 (Wave 2) or the metadata updates in Plan 01 will wire the OG image URLs. In Plan 01 Task 2, the action already says to update OG URLs -- so Plan 01 owns the page files and will set the correct OG image URLs pointing to these new routes.
  </action>
  <verify>
Start dev server and verify:
- `http://localhost:3000/api/og/generic?title=AI+Football+Predictions&subtitle=42+models+across+17+leagues` renders dark-themed image
- Navigate to a match page, view source, confirm opengraph-image meta tag is present for /leagues/[slug]/[match] route
- All new routes return 200 with `content-type: image/png`
  </verify>
  <done>
New generic OG route exists at `/api/og/generic`. Match pages under /leagues/[slug]/[match] have dynamic opengraph-image.tsx. All OG images use dark gradient theme. No file conflicts with Plan 01.
  </done>
</task>

</tasks>

<verification>
1. All OG API routes (`/api/og/match`, `/api/og/league`, `/api/og/model`, `/api/og/generic`) return images with dark gradient theme
2. Match opengraph-image.tsx at `/leagues/[slug]/[match]/opengraph-image` renders correctly
3. `npx tsc --noEmit` passes
4. No file conflicts with Plan 01 (this plan only modifies OG route files and templates)
</verification>

<success_criteria>
- CTAG-05 (partial): OG images exist for all page types with dark navy/charcoal gradient
- All OG images show team names, league names, or page titles with Kroam.xyz branding
- Generic fallback OG image available for pages without specific templates
- Match pages under canonical /leagues/[slug]/[match] route have dynamic OG images
</success_criteria>

<output>
After completion, create `.planning/phases/46-content-tags-meta-optimization/46-02-SUMMARY.md`
</output>
