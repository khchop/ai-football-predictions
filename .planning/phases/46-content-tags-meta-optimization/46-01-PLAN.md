---
phase: 46-content-tags-meta-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/seo/constants.ts
  - src/lib/seo/metadata.ts
  - src/app/layout.tsx
  - src/app/page.tsx
  - src/app/leagues/page.tsx
  - src/app/leagues/[slug]/page.tsx
  - src/app/leagues/[slug]/[match]/page.tsx
  - src/app/models/page.tsx
  - src/app/models/[id]/page.tsx
  - src/app/leaderboard/page.tsx
  - src/app/blog/page.tsx
  - src/app/blog/[slug]/page.tsx
  - src/app/matches/page.tsx
  - src/app/about/page.tsx
  - src/app/methodology/page.tsx
autonomous: true

must_haves:
  truths:
    - "All match page titles follow '{Home} vs {Away} Prediction | Kroam' pattern (drop suffix if >60 chars)"
    - "All league page titles follow '{League} AI Predictions | Kroam' pattern"
    - "All model page titles follow '{Model} Football Predictions | Kroam' pattern"
    - "Zero title tags exceed 60 characters on any indexable page"
    - "Zero meta descriptions shorter than 100 or longer than 160 characters"
    - "Every indexable page has exactly one H1 tag"
    - "Match page H1 is '{Home} vs {Away} Prediction'"
    - "League page H1 is '{League} Predictions'"
    - "Model page H1 is '{Model} Football Predictions'"
    - "Every page has og:image pointing to the correct OG image route"
  artifacts:
    - path: "src/lib/seo/metadata.ts"
      provides: "Centralized title/description builder functions for all page types"
      exports: ["buildMatchTitle", "buildMatchDescription", "buildLeagueTitle", "buildLeagueDescription", "buildModelTitle", "buildModelDescription"]
    - path: "src/lib/seo/constants.ts"
      provides: "Updated SEO constants including MIN_DESCRIPTION_LENGTH=100, SITE_NAME='Kroam'"
      contains: "MIN_DESCRIPTION_LENGTH"
  key_links:
    - from: "src/app/leagues/[slug]/[match]/page.tsx"
      to: "src/lib/seo/metadata.ts"
      via: "import buildMatchTitle, buildMatchDescription"
      pattern: "buildMatch(Title|Description)"
    - from: "src/app/models/[id]/page.tsx"
      to: "src/lib/seo/metadata.ts"
      via: "import buildModelTitle, buildModelDescription"
      pattern: "buildModel(Title|Description)"
    - from: "src/app/page.tsx"
      to: "/api/og/generic"
      via: "openGraph.images URL"
      pattern: "/api/og/generic"
---

<objective>
Centralize title/description/H1 formulas and update all page metadata to comply with user-specified patterns and SEO length constraints. Wire og:image URLs to point to OG image routes (created in parallel by Plan 02).

Purpose: Fix all title tag, meta description, H1, and og:image violations flagged by Ahrefs audit. Every indexable page must have titles under 60 chars, descriptions 100-160 chars, exactly one H1 following the locked formula patterns, and og:image tags pointing to the correct dynamic OG image routes.

Output: Updated metadata helpers + all page files with compliant metadata, H1 tags, and og:image wiring.
</objective>

<execution_context>
@/Users/pieterbos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pieterbos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/46-content-tags-meta-optimization/46-CONTEXT.md
@.planning/phases/46-content-tags-meta-optimization/46-RESEARCH.md
@src/lib/seo/metadata.ts
@src/lib/seo/constants.ts
@src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update SEO constants and create centralized metadata builder functions</name>
  <files>
    src/lib/seo/constants.ts
    src/lib/seo/metadata.ts
  </files>
  <action>
**constants.ts changes:**
- Change `SITE_NAME` from `'BettingSoccer'` to `'Kroam'` (branding updated)
- Change `MAX_META_DESCRIPTION_LENGTH` from `155` to `160` (per user decision)
- Add `MIN_DESCRIPTION_LENGTH = 100` (new constant)
- Keep `MAX_TITLE_LENGTH = 60` (already correct)
- Keep `MAX_OG_DESCRIPTION_LENGTH = 200` (unchanged)

**metadata.ts changes:**

Add new exported builder functions following user-locked title formulas:

```typescript
// Title builders - all follow pattern: "{Entity} {Keyword} | Kroam"
// Drop " | Kroam" suffix if title exceeds 60 chars (user decision: never abbreviate names)

export function buildMatchTitle(homeTeam: string, awayTeam: string): string {
  const base = `${homeTeam} vs ${awayTeam} Prediction`;
  const withBrand = `${base} | Kroam`;
  return withBrand.length <= MAX_TITLE_LENGTH ? withBrand : base;
}

export function buildLeagueTitle(leagueName: string): string {
  const base = `${leagueName} AI Predictions`;
  const withBrand = `${base} | Kroam`;
  return withBrand.length <= MAX_TITLE_LENGTH ? withBrand : base;
}

export function buildModelTitle(modelName: string): string {
  const base = `${modelName} Football Predictions`;
  const withBrand = `${base} | Kroam`;
  return withBrand.length <= MAX_TITLE_LENGTH ? withBrand : base;
}
```

Add description builders with 100-160 char enforcement:

```typescript
export function buildMatchDescription(
  homeTeam: string, awayTeam: string, league: string, modelCount: number
): string {
  const base = `Get AI predictions for ${homeTeam} vs ${awayTeam} from ${modelCount} models. See scores, analysis, and betting insights for ${league}.`;
  return enforceDescriptionLength(base);
}

export function buildLeagueDescription(leagueName: string, modelCount: number): string {
  const base = `AI predictions for ${leagueName} from ${modelCount} models. Track accuracy, compare predictions, and see which AI performs best.`;
  return enforceDescriptionLength(base);
}

export function buildModelDescription(modelName: string, accuracy: number, modelCount: number): string {
  const base = `${modelName} football predictions with ${accuracy}% accuracy. Compare performance against ${modelCount} AI models across 17 leagues.`;
  return enforceDescriptionLength(base);
}

// Generic builders for other page types
export function buildGenericTitle(text: string): string {
  const withBrand = `${text} | Kroam`;
  return withBrand.length <= MAX_TITLE_LENGTH ? withBrand : text;
}

export function buildGenericDescription(text: string): string {
  return enforceDescriptionLength(text);
}

// Private helper: pad short descriptions, truncate long ones
function enforceDescriptionLength(text: string): string {
  if (text.length > MAX_META_DESCRIPTION_LENGTH) {
    return truncateWithEllipsis(text, MAX_META_DESCRIPTION_LENGTH);
  }
  if (text.length < MIN_DESCRIPTION_LENGTH) {
    const padding = ' Compare forecasts, track accuracy, and explore AI model performance on Kroam.';
    const padded = text + padding;
    return padded.length > MAX_META_DESCRIPTION_LENGTH
      ? padded.substring(0, MAX_META_DESCRIPTION_LENGTH)
      : padded;
  }
  return text;
}
```

Update existing `createTitle()` to use the new `buildMatchTitle()` pattern (for upcoming matches, use `buildMatchTitle`; for finished matches with scores, use `{Home} {score}-{score} {Away} | Kroam` but still respect 60 char limit by dropping suffix).

Update existing `createDescription()` to call `enforceDescriptionLength()` instead of just `truncateWithEllipsis()` to enforce the 100-char minimum.

Update `generateCompetitionMetadata()` to use `buildLeagueTitle()` and `buildLeagueDescription()`.

Update `generateLeaderboardMetadata()` to use `buildGenericTitle()` and enforce description length.

Update `generateHomeMetadata()` to use `buildGenericTitle('AI Football Predictions')` and enforce description length.

Update `generateArticleMetadata()` to enforce description minimum 100 chars.

**Important:** Do NOT remove any existing exported functions that other files import. Refactor them to use the new helpers internally.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors. Grep all usages of old function names to confirm they still work. Check that new functions are exported.
  </verify>
  <done>
All title builder functions return strings under 60 chars (dropping " | Kroam" suffix when needed). All description builders return strings between 100-160 chars. Existing metadata functions updated to use new helpers. No type errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update all page metadata, H1 tags, and og:image URLs across all page types</name>
  <files>
    src/app/layout.tsx
    src/app/page.tsx
    src/app/leagues/page.tsx
    src/app/leagues/[slug]/page.tsx
    src/app/leagues/[slug]/[match]/page.tsx
    src/app/models/page.tsx
    src/app/models/[id]/page.tsx
    src/app/leaderboard/page.tsx
    src/app/blog/page.tsx
    src/app/blog/[slug]/page.tsx
    src/app/matches/page.tsx
    src/app/about/page.tsx
    src/app/methodology/page.tsx
  </files>
  <action>
**Root layout (src/app/layout.tsx):**
- Update static `metadata` title to use `buildGenericTitle('AI Football Predictions')` -- this needs to become a sensible default since child pages override it
- Actually, root layout should keep a simple default: `title: { default: 'AI Football Predictions | Kroam', template: '%s' }` so child pages provide their own titles without appending
- Update description to comply with 100-160 char range using `buildGenericDescription()`
- Update OG title/description to match
- Change `siteName` from `'kroam.xyz'` to `'Kroam'`
- Update Organization schema `name` from `"kroam.xyz"` to `"Kroam"`
- Update hardcoded "29" model references to "42" in schema descriptions (or better, remove model counts from static root metadata since they're dynamic)
- Set default OG image in root layout: `openGraph.images: [{ url: '/api/og/generic?title=AI+Football+Predictions', width: 1200, height: 630 }]` -- child pages will override this with their specific OG image

**Homepage (src/app/page.tsx):**
- H1 already exists: "AI Football Predictions" -- GOOD, keep it (Claude's discretion: matches keyword pattern)
- But the H1 has `<span className="gradient-text">AI Football</span> Predictions` -- this is fine, still one H1 tag
- Homepage needs `generateMetadata` or static `metadata` with compliant title/description. Currently uses root layout default. Add explicit:
  - Title: `AI Football Predictions | Kroam` (under 60 chars)
  - Description: enforce 100-160 chars
- **og:image:** `openGraph.images: [{ url: '/api/og/generic?title=AI+Football+Predictions', width: 1200, height: 630 }]`

**Leagues index (src/app/leagues/page.tsx):**
- H1 exists: "Football Leagues" -- update to "Football Leagues AI Predictions" per keyword pattern? No, user decision says H1 for league pages is `{League} Predictions`. For the INDEX page, use "Football League Predictions" (Claude's discretion for index H1)
- Update static `metadata.title` from `'Football Leagues | AI Predictions | kroam.xyz'` to `buildGenericTitle('Football League AI Predictions')`
- Update description to comply with 100-160 range
- **og:image:** `openGraph.images: [{ url: '/api/og/generic?title=Football+League+AI+Predictions', width: 1200, height: 630 }]`

**League detail (src/app/leagues/[slug]/page.tsx):**
- Already uses `generateMetadata`. Update to use `buildLeagueTitle(competition.name)` and `buildLeagueDescription(competition.name, modelCount)`
- Find the H1 in the page component (it's in `league-hub-content.tsx` or the page itself). Ensure H1 text is `{League} Predictions`
- Check for extra H1s in child components
- **og:image:** `openGraph.images: [{ url: \`/api/og/league?leagueName=\${encodeURIComponent(competition.name)}\`, width: 1200, height: 630 }]`

**Match page (src/app/leagues/[slug]/[match]/page.tsx):**
- Already uses `generateMetadata` with `buildMatchMetadata()`. The updated `createTitle()` in Task 1 handles the formula.
- H1: Check current H1 in `MatchLayout` or `match-data-provider`. The match page H1 should be `{Home} vs {Away} Prediction`. Find and fix it.
- **og:image:** Match pages under /leagues/[slug]/[match]/ will have an `opengraph-image.tsx` file (created by Plan 02) that Next.js auto-discovers. No manual og:image URL wiring needed for this route -- Next.js convention-based OG images take precedence. Do NOT set openGraph.images in generateMetadata for this route, as it would conflict with the opengraph-image.tsx file.

**Models index (src/app/models/page.tsx):**
- H1 exists: "AI Models" -- update to "AI Model Football Predictions" (Claude's discretion for index H1)
- Update `generateMetadata` title from `AI Models | ${modelCount} Models Competing | kroam.xyz` to `buildGenericTitle('AI Model Football Predictions')`
- Update description to comply
- **og:image:** `openGraph.images: [{ url: '/api/og/generic?title=AI+Model+Football+Predictions', width: 1200, height: 630 }]`

**Model detail (src/app/models/[id]/page.tsx):**
- Update `generateMetadata` to use `buildModelTitle(model.displayName)` and `buildModelDescription(model.displayName, accuracy, modelCount)`
- Find H1 in page component. Currently shows model.displayName. Update to `{Model} Football Predictions`
- **og:image:** `openGraph.images: [{ url: \`/api/og/model?modelName=\${encodeURIComponent(model.displayName)}&accuracy=\${Math.round(accuracy)}&rank=\${rank}\`, width: 1200, height: 630 }]`

**Leaderboard (src/app/leaderboard/page.tsx):**
- Update `generateMetadata` to use `buildGenericTitle('AI Model Leaderboard')`
- H1: Find current H1 in page. Should be "AI Model Leaderboard" (Claude's discretion)
- Update description to comply
- **og:image:** `openGraph.images: [{ url: '/api/og/generic?title=AI+Model+Leaderboard', width: 1200, height: 630 }]`

**Blog index (src/app/blog/page.tsx):**
- Update metadata title and description
- H1: Should be clear and singular. "AI Football Analysis Blog" or similar
- **og:image:** `openGraph.images: [{ url: '/api/og/generic?title=AI+Football+Analysis+Blog', width: 1200, height: 630 }]`

**Blog post (src/app/blog/[slug]/page.tsx):**
- Already uses `generateMetadata`. Ensure title stays under 60 chars (existing truncation should work).
- Ensure description is 100-160 chars (may need padding for short excerpts)
- H1: Blog post title should be the only H1. Check that BlogContent component doesn't render another H1.
- **og:image:** `openGraph.images: [{ url: \`/api/og/generic?title=\${encodeURIComponent(article.title)}\`, width: 1200, height: 630 }]`

**Matches index (src/app/matches/page.tsx):**
- Update metadata title/description
- H1: Should exist. "Football Match Predictions" or similar
- **og:image:** `openGraph.images: [{ url: '/api/og/generic?title=Football+Match+Predictions', width: 1200, height: 630 }]`

**About page (src/app/about/page.tsx):**
- Update metadata title/description
- H1: Check for presence
- **og:image:** `openGraph.images: [{ url: '/api/og/generic?title=About+Kroam', width: 1200, height: 630 }]`

**Methodology page (src/app/methodology/page.tsx):**
- Update metadata title/description
- H1: Check for presence
- **og:image:** `openGraph.images: [{ url: '/api/og/generic?title=Prediction+Methodology', width: 1200, height: 630 }]`

**For every page, ensure:**
1. Title follows formula and is under 60 chars
2. Description is 100-160 chars
3. Exactly one H1 tag (demote any extras to H2)
4. OG title = page title, OG description = page description
5. OG url = canonical URL
6. OG image URL set per the specifications above -- hardcode the route pattern that Plan 02 creates (these routes are deterministic: `/api/og/generic`, `/api/og/league`, `/api/og/model`, `/api/og/match`). For match pages under /leagues/[slug]/[match]/, do NOT set openGraph.images since the opengraph-image.tsx convention file handles it automatically.

**OG image URL reference (routes created by Plan 02 in parallel):**
| Page Type | og:image URL Pattern |
|-----------|---------------------|
| Homepage | `/api/og/generic?title=AI+Football+Predictions` |
| Leagues index | `/api/og/generic?title=Football+League+AI+Predictions` |
| League detail | `/api/og/league?leagueName=${encodeURIComponent(name)}` |
| Match page | Auto-discovered via opengraph-image.tsx (no manual URL) |
| Models index | `/api/og/generic?title=AI+Model+Football+Predictions` |
| Model detail | `/api/og/model?modelName=${encodeURIComponent(name)}&accuracy=${acc}&rank=${rank}` |
| Leaderboard | `/api/og/generic?title=AI+Model+Leaderboard` |
| Blog index | `/api/og/generic?title=AI+Football+Analysis+Blog` |
| Blog post | `/api/og/generic?title=${encodeURIComponent(title)}` |
| Matches index | `/api/og/generic?title=Football+Match+Predictions` |
| About | `/api/og/generic?title=About+Kroam` |
| Methodology | `/api/og/generic?title=Prediction+Methodology` |

**IMPORTANT:** For pages that already use `generateMetadata()`, update to use the new helper functions from Task 1. For pages with static `metadata` exports, convert to use the helpers or hardcode compliant values. The OG image routes don't need to exist at build time -- Next.js metadata just sets the URL string, and the routes will be available at runtime (both Plan 01 and Plan 02 deploy together).
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors. Run `npm run build` (or `npx next build --webpack` if turbopack fails) to verify all pages build. Grep for `<h1` across all page files and components to verify exactly one H1 per page type. Grep for `/api/og/` across all page files to verify og:image URLs are set for every page type.
  </verify>
  <done>
All page types have metadata following user-specified title/description formulas. All titles under 60 chars. All descriptions 100-160 chars. Every page has exactly one H1 matching the formula patterns. Every page has og:image URL pointing to the correct OG image route. Build succeeds without errors.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds (or `npx next build --webpack`)
3. Grep `<h1` in all page.tsx and component files confirms one H1 per page type
4. All title builder functions tested with long names (e.g., "Borussia Monchengladbach vs Bayer 04 Leverkusen") to verify suffix dropping works
5. All description builders produce output between 100-160 characters
6. Grep `/api/og/` confirms every page type has an og:image URL wired
</verification>

<success_criteria>
- CTAG-01: Match pages have H1 "{Home} vs {Away} Prediction"
- CTAG-02: Zero meta descriptions shorter than 100 chars
- CTAG-03: Zero meta descriptions longer than 160 chars
- CTAG-04: Zero title tags longer than 60 chars
- CTAG-05 (partial): Every page has og:image URL pointing to correct OG route
- CTAG-06: League and model index pages have H1 tags
- All page metadata uses centralized builder functions
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/46-content-tags-meta-optimization/46-01-SUMMARY.md`
</output>
