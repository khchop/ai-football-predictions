# Milestone v1.3: Match Page Refresh

**Status:** SHIPPED 2026-02-02
**Phases:** 13-16
**Total Plans:** 13

## Overview

Mobile-first match pages with consolidated content and AI search optimization. Fixed LLM content generation pipeline, added tabbed navigation with swipe gestures, enabled ISR caching, and optimized for AI search engines.

## Phases

### Phase 13: Content Pipeline Fixes

**Goal**: LLM-generated content displays correctly on all match pages
**Depends on**: None
**Plans**: 3 plans

Plans:
- [x] 13-01: Create unified content query (getMatchContentUnified) with COALESCE
- [x] 13-02: Create ReadMoreText client component with accessibility
- [x] 13-03: Update MatchContentSection with state logic and ReadMoreText integration

**Details:**
- Created `getMatchContentUnified()` query merging matchContent and matchRoundups tables
- COALESCE prioritizes roundup narrative over short-form post-match content
- ReadMoreText component provides progressive disclosure with 600-char threshold
- State-based visibility logic (pre-match for scheduled, betting+post-match for live/finished)

---

### Phase 14: Mobile Layout Consolidation

**Goal**: Match pages display data exactly once with minimal scrolling on mobile
**Depends on**: Phase 13 (content must render before layout optimization)
**Plans**: 4 plans

Plans:
- [x] 14-01: Install react-swipeable, create sticky header and collapsible section components
- [x] 14-02: Create tabbed navigation with swipe gestures and tab content wrappers
- [x] 14-03: Wire tabbed layout into match page, hide duplicate scores on mobile
- [x] 14-04: Touch target audit and human verification checkpoint

**Details:**
- react-swipeable v7.0.2 for tab swipe gestures
- MatchHeaderSticky component with position:sticky (avoids CLS penalties)
- Four tabs: Summary, Stats, Predictions, Analysis
- 44px minimum touch targets for WCAG 2.5.5 AAA compliance
- Human-verified mobile experience on physical device viewport

---

### Phase 15: Performance Optimization

**Goal**: Match pages load under 400ms TTFB with smart caching
**Depends on**: Phase 14 (caching strategy depends on finalized component structure)
**Plans**: 3 plans

Plans:
- [x] 15-01: Remove force-dynamic and enable ISR with 60s revalidation
- [x] 15-02: Parallelize data fetching with Promise.all (two-stage pattern)
- [x] 15-03: Add cache stats monitoring endpoint

**Details:**
- Removed `export const dynamic = 'force-dynamic'` from match page
- Added `export const revalidate = 60` for ISR caching
- Two-stage parallel fetch (critical path + Promise.all) for match page data
- Individual .catch() per promise for graceful degradation
- /api/admin/cache-stats endpoint for monitoring cache hit rate

---

### Phase 16: AI Search Optimization

**Goal**: Match pages optimized for AI search engines (ChatGPT, Perplexity, Claude)
**Depends on**: Phase 13 (content must be visible for crawlers to index)
**Plans**: 3 plans

Plans:
- [x] 16-01: Add missing AI crawler user-agents to robots.txt and verify llms.txt structure
- [x] 16-02: Create consolidated MatchPageSchema component with @graph array
- [x] 16-03: Integrate consolidated schema into match page and verify SSR content

**Details:**
- Added GPTBot, ClaudeBot, PerplexityBot, Amazonbot to robots.txt
- llms.txt provides structured sitemap with markdown links
- Single consolidated Schema.org JSON-LD @graph (SportsEvent + WebPage + BreadcrumbList)
- @id URL fragment pattern for entity cross-references (url#webpage, url#organization)
- AI-generated content verified as SSR (visible in View Source)

---

## Milestone Summary

**Key Decisions:**
- Content Pipeline fixes before Mobile Layout (can't optimize layout for broken content)
- Unified content query system (`getMatchContentUnified()`) to resolve dual-table writes
- ISR with 60s revalidation replacing force-dynamic
- Consolidated Schema.org JSON-LD @graph for AI search engines
- position:sticky instead of position:fixed for headers (avoids CLS penalties)
- 44px minimum touch targets for WCAG 2.5.5 AAA compliance

**Issues Resolved:**
- LLM content not displaying due to dual-table writes (matchContent vs matchRoundups)
- Duplicate score display on mobile match pages
- force-dynamic blocking ISR caching
- Multiple separate Schema.org JSON-LD scripts causing validation warnings

**Issues Deferred:**
- Real-time WebSocket updates for live matches (v2.0+)
- Database migration to single-table content storage (future pipeline cleanup)
- Multi-language support (separate internationalization milestone)

**Technical Debt Incurred:**
- Single revalidate=60 for all match statuses (Next.js doesn't support conditional static exports)
- Human verification tests require production deployment (not CI/CD automated)

---

*For current project status, see .planning/ROADMAP.md*
