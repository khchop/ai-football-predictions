# Milestone v1.2: Technical SEO Fixes

**Status:** SHIPPED 2026-02-02
**Phases:** 9-12
**Total Plans:** 9

## Overview

Fix ~1,083 SEO issues identified by Ahrefs audit. Critical errors (500s, 404s, redirect chains), page structure (H1 tags, title optimization), redirect optimization (307→308, noindex verification), and internal linking (related content widgets).

## Phases

### Phase 9: Critical SEO Errors

**Goal**: Eliminate 500 errors, 404s in sitemap, and broken redirects
**Depends on**: None
**Plans**: 3 plans

Plans:
- [x] 09-01: Add slug alias system to competition config with canonical redirects
- [x] 09-02: Fix sitemap generation and internal links to use canonical URLs
- [x] 09-03: Fix redirect chains and investigate 500 error

**Details:**

Added competition alias system enabling both short IDs (epl, ucl) and long-form slugs (premier-league, champions-league). Implemented 308 permanent redirects to canonical URLs. Fixed sitemap to use static COMPETITIONS config. Added defensive error handling for match pages (404 instead of 500). Created edge-level redirects in next.config.ts for faster redirect resolution.

**Key decisions:**
- Use 308 Permanent Redirect instead of 301 (Next.js permanentRedirect uses 308)
- Add aliases array to CompetitionConfig instead of separate mapping
- Query both competition.id and competition.slug in database for backward compatibility
- Edge-level redirects in next.config.ts for faster redirects before routing

### Phase 10: Page Structure

**Goal**: All pages have proper H1 tags and titles under character limits
**Depends on**: Phase 9
**Plans**: 2 plans

Plans:
- [x] 10-01: Add MatchH1 component with sr-only accessibility for match pages
- [x] 10-02: Create abbreviation utilities and optimize title templates

**Details:**

Created MatchH1 component with sr-only class for SEO compliance without visual changes. Built centralized abbreviation utilities for team names (25+ mappings) and competition names. Optimized title templates:
- Match (finished): "{home} {score} {away} | kroam.xyz" (~33 chars)
- Match (upcoming): "{home} vs {away} Prediction" (~31 chars)
- League: "{competition} Predictions | kroam.xyz" (~40 chars)

**Key decisions:**
- Use sr-only class for H1 tags to preserve visual design
- Finished matches: "{home} {score}-{score} {away} Match Report" in H1
- Title format removes verbose suffixes to stay under 60 chars
- RoundupViewer h1 changed to h2 to maintain single H1 per page

### Phase 11: Redirect Optimization

**Goal**: Fix 307 temporary redirects to 308 permanent, verify noindex configuration, document orphan page strategy
**Depends on**: Phase 9
**Plans**: 2 plans

Plans:
- [x] 11-01: Replace redirect with permanentRedirect in legacy match page
- [x] 11-02: Verify noindex configuration and document orphan page strategy

**Details:**

Changed legacy /matches/[id] redirect from redirect() with RedirectType.replace (307) to permanentRedirect() (308). Verified all league pages have `robots: { index: true, follow: true }`. Documented that Ahrefs noindex report is stale cache. Identified match pages >30 days intentionally noindexed (correct practice). Created orphan page strategy for Phase 12.

**Key decisions:**
- Use permanentRedirect() (308) for SEO-critical redirects
- Ahrefs noindex report attributed to stale cache, not code issue
- Match pages >30 days old intentionally noindexed

### Phase 12: Internal Linking

**Goal**: Strong internal link structure for crawl depth optimization
**Depends on**: Phase 11
**Plans**: 2 plans

Plans:
- [x] 12-01: Add RelatedMatchesWidget and RelatedModelsWidget to match and model pages
- [x] 12-02: Add RecentPredictionsWidget to competition hub pages

**Details:**

Created three server-rendered widgets for SEO internal linking:
1. **RelatedMatchesWidget**: Shows 3-5 related matches (same competition OR same teams) on match pages
2. **RelatedModelsWidget**: Shows top 5 models by points on model pages
3. **RecentPredictionsWidget**: Shows 5 recent matches on competition hub pages

All widgets use descriptive anchor text (team names, model names) and are server-rendered for crawlability.

**Key decisions:**
- Related match criteria: same competition OR same teams
- No Redis caching for widget queries (fast enough with existing indexes)
- Server Components for SEO crawlability

---

## Milestone Summary

**Key Decisions:**
- 308 permanent redirects via permanentRedirect() for SEO
- sr-only H1 tags to satisfy SEO without visual changes
- Edge-level redirects in next.config.ts for performance
- Server Components for all internal linking widgets

**Issues Resolved:**
- 7 404 errors in sitemap (long-form league URLs)
- 128 broken internal links (match cards using wrong slugs)
- Redirect chains eliminated (legacy match → canonical now single hop)
- 500 errors on match pages (defensive error handling)
- Title tags over 60 characters (abbreviation utilities)
- Missing H1 tags on match pages (MatchH1 component)

**Technical Debt Incurred:**
- RelatedMatchesWidget and RecentPredictionsWidget use `competition.slug || competition.id` instead of canonical ID only (causes extra redirect hop for some internal links)

---

*For current project status, see .planning/ROADMAP.md*
*Archived: 2026-02-02*
