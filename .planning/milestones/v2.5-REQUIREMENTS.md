# Requirements Archive: v2.5 Model Reliability & Dynamic Counts

**Archived:** 2026-02-05
**Status:** SHIPPED

This is the archived requirements specification for v2.5.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

## v2.5 Requirements

Requirements for Model Reliability & Dynamic Counts milestone. Each maps to roadmap phases.

### Model-Specific Prompts

- [x] **PRMT-01**: Model-specific prompt templates exist for failing models (GLM, Kimi, thinking models)
- [x] **PRMT-02**: GLM models receive English enforcement prompt ("Respond in English only")
- [x] **PRMT-03**: Thinking models receive tag suppression prompt ("Output JSON only, no thinking tags")
- [x] **PRMT-04**: DeepSeek R1 uses minimal system prompt (empty or single line)
- [x] **PRMT-05**: Prompt selector falls back to base prompt for unmapped models (don't break working models)
- [x] **PRMT-06**: Models returning natural language receive JSON emphasis prompt

### Structured Output

- [x] **JSON-01**: Models that fail JSON parsing receive structured output enforcement in prompt
- [x] **JSON-02**: qwen3-235b-thinking returns valid JSON after prompt adjustment
- [x] **JSON-03**: deepseek-v3.2 returns valid JSON after prompt adjustment
- [x] **JSON-04**: Integration test validates JSON output for all 36+ models

### Model Timeouts

- [x] **TIME-01**: Model-specific timeout configuration exists (MODEL_TIMEOUT_OVERRIDES map)
- [x] **TIME-02**: Thinking models use 60s timeout (vs 30s default)
- [x] **TIME-03**: Kimi K2.5 uses 60s timeout
- [x] **TIME-04**: GLM models use 60s timeout

### Fallback Chains

- [x] **FALL-01**: Fallback orchestrator wraps callAPI with try-catch + fallback logic
- [x] **FALL-02**: Synthetic model failures trigger automatic fallback to Together.ai
- [x] **FALL-03**: Fallback returns tuple [response, actualProvider] for transparency
- [x] **FALL-04**: kimi-k2.5-syn falls back to equivalent Together.ai model
- [x] **FALL-05**: glm-4.6-syn falls back — N/A, no Together equivalent (by design)
- [x] **FALL-06**: glm-4.7-syn falls back — N/A, no Together equivalent (by design)

### Cycle Detection

- [x] **CYCL-01**: Fallback mapping validated at startup (no cycles)
- [x] **CYCL-02**: Runtime cycle detection tracks attemptedModels Set
- [x] **CYCL-03**: Max fallback depth limit of 3 prevents infinite retries

### Cost Guards

- [x] **COST-01**: Fallback logs warning if fallback provider >2x more expensive
- [x] **COST-02**: Cost metadata tracked in prediction record (originalCost, fallbackCost)
- [x] **COST-03**: Daily fallback cost visible in admin dashboard

### Dynamic Counts

- [x] **DYNM-01**: Homepage hero displays dynamic model count (not hardcoded "35")
- [x] **DYNM-02**: Leaderboard page displays dynamic model count
- [x] **DYNM-03**: Match page SEO metadata uses dynamic model count
- [x] **DYNM-04**: Content generation prompts use dynamic model count
- [x] **DYNM-05**: System prompts use dynamic model count
- [x] **DYNM-06**: Single source of truth (getActiveModelCount function)
- [x] **DYNM-07**: Cache invalidation on model enable/disable

### Leaderboard Auto-Include

- [x] **LEAD-01**: New models appear in leaderboard automatically after first prediction
- [x] **LEAD-02**: Re-enabled models appear in leaderboard without manual intervention
- [x] **LEAD-03**: Leaderboard query uses active models from database (not hardcoded list)

## Future Requirements

Deferred to v2.6+. Tracked but not in current roadmap.

### Advanced Reliability

- **ADRL-01**: Adaptive prompt optimization based on success rates
- **ADRL-02**: A/B testing framework for prompt variants
- **ADRL-03**: Predictive circuit breaking (ML-based failure prediction)
- **ADRL-04**: Model warmup/cooldown (gradual reintroduction)

### Cost Optimization

- **COPT-01**: Cost-aware routing (prefer cheaper models when accuracy equal)
- **COPT-02**: Budget-based model selection during high-volume periods
- **COPT-03**: Per-model cost tracking dashboard

### Observability

- **OBSV-01**: Model performance leaderboard (uptime %, parse success %, latency)
- **OBSV-02**: Model health monitoring API endpoint
- **OBSV-03**: Fallback frequency alerting

## Out of Scope

Explicitly excluded. Documented to prevent scope creep.

| Feature | Reason |
|---------|--------|
| LiteLLM/Portkey gateway | Adds 50-200ms latency, Python dependency |
| LangChain prompt management | 10MB+ bundle for simple string mapping |
| Cross-provider model switching | Complexity not justified, fallback sufficient |
| Real-time prompt A/B testing | Premature for current scale |
| Model fine-tuning | Out of scope for this platform |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| PRMT-01 | Phase 40 | Complete |
| PRMT-02 | Phase 40 | Complete |
| PRMT-03 | Phase 40 | Complete |
| PRMT-04 | Phase 40 | Complete |
| PRMT-05 | Phase 40 | Complete |
| PRMT-06 | Phase 40 | Complete |
| JSON-01 | Phase 40 | Complete |
| JSON-02 | Phase 40 | Complete |
| JSON-03 | Phase 40 | Complete |
| JSON-04 | Phase 43 | Complete |
| TIME-01 | Phase 40 | Complete |
| TIME-02 | Phase 40 | Complete |
| TIME-03 | Phase 40 | Complete |
| TIME-04 | Phase 40 | Complete |
| FALL-01 | Phase 41 | Complete |
| FALL-02 | Phase 41 | Complete |
| FALL-03 | Phase 41 | Complete |
| FALL-04 | Phase 41 | Complete |
| FALL-05 | Phase 41 | Complete |
| FALL-06 | Phase 41 | Complete |
| CYCL-01 | Phase 41 | Complete |
| CYCL-02 | Phase 41 | Complete |
| CYCL-03 | Phase 41 | Complete |
| COST-01 | Phase 41 | Complete |
| COST-02 | Phase 41 | Complete |
| COST-03 | Phase 41 | Complete |
| DYNM-01 | Phase 42 | Complete |
| DYNM-02 | Phase 42 | Complete |
| DYNM-03 | Phase 42 | Complete |
| DYNM-04 | Phase 42 | Complete |
| DYNM-05 | Phase 42 | Complete |
| DYNM-06 | Phase 42 | Complete |
| DYNM-07 | Phase 42 | Complete |
| LEAD-01 | Phase 42 | Complete |
| LEAD-02 | Phase 42 | Complete |
| LEAD-03 | Phase 42 | Complete |

**Coverage:**
- v2.5 requirements: 36 total
- Shipped: 36
- Adjusted: 0
- Dropped: 0

---

## Milestone Summary

**Shipped:** 36 of 36 v2.5 requirements
**Adjusted:** None
**Dropped:** None

---
*Archived: 2026-02-05 as part of v2.5 milestone completion*
